var CS_CONF={"projectId":1795,"status":1,"hostnames":["bestbuy.com"],"crossDomainTracking":0,"crossDomainSingleIframeTracking":0,"consentRequired":1,"allowSubdomains":1,"visitorCookieTimeout":34164000000,"sampleRate":50,"replayRecordingRate":0,"validationRate":10,"lastTrackingDraw":1631902107,"trackerDomain":"c.contentsquare.net","recordingDomain":"r.contentsquare.net","useMalkaPipeline":1,"ed":"l.contentsquare.net/log/web","eMerchandisingEnabled":0,"mouseMoveHeatmapEnabled":1,"autoInsightsEnabled":0,"jsErrorsEnabled":0,"apiErrorsEnabled":0,"customHashIdEnabled":0,"recordingEncryptionEnabled":0,"recordingEncryptionPublicKey":null,"recordingEncryptionPublicKeyId":0,"secureCookiesEnabled":0,"triggerSessionReplayEnabled":0,"triggerSessionReplayRegex":"(.*com\\/site\\/questions\\/.*|.*com\\/site\\/reviews\\/.*)","dynamicIdRegex":"^.+-\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$","whitelistedAttributes":[],"replayRecordingUnmaskedUrlRegex":null,"replayRecordingMaskedUrlRegex":null,"tagDeploymentMode":"CONTENTSQUARE","experimental":null,"iframesTracking":0,"textVisibilityEnabled":0,"cookielessTrackingEnabled":0,"malkaUrlEnabled":0,"malkaEtrEnabled":0,"asyncSerializerEnabled":1,"malkaQuotaServiceDomain":"q-aeu1.contentsquare.net","malkaRecordingDomain":"k-aeu1.contentsquare.net"};!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.ContentSquare="CONTENTSQUARE",t.LoadedByClicktale="LOADED_BY_CLICKTALE",t.LoadClicktalePtc="LOAD_CLICKTALE_PTC",t.DualCollectionReview="DUAL_COLLECTION_REVIEW",t.DualCollection="DUAL_COLLECTION"}(e.TagDeploymentMode||(e.TagDeploymentMode={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=/(@import\s+url\s*\(\s*(["'])?([^"')]+)(\2)\s*\))|(@import\s+(["'])([^"']+)\6)|(url\s*\(\s*(["'])?([^"')]+)(\9)\s*\))/g;function i(t,e){return t.replace(n,(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[3]||t[7],i=t[10],o=(n||i).trim(),s=n?"@import ":"";return s+"url("+e(o)+")"}))}e.replaceIn=i,e.extractFrom=function(t){var e=[];return i(t,(function(t){return e.push(t),t})),e}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"get",(function(){return tt})),r.d(n,"getRequestParameters",(function(){return et}));var i={};r.r(i),r.d(i,"getRequestParameters",(function(){return vi}));var o=["childNodes","hasChildNodes","parentNode","nextSibling"],s=["shadowRoot"],a=["target"],c={Date:"csDate",JSON:"csJSON",Array:"csArray",String:"csString",URL:"csURL",MutationObserver:"csMutationObserver"};function u(t,e){var r=function(t,e){for(var r,n=t;n&&!(r=Object.getOwnPropertyDescriptor(n,e));)n=Object.getPrototypeOf(n);return r}(t,e);return(null==r?void 0:r.get)?r.get:(null==r?void 0:r.value)?r.value:function(){return this[e]}}function p(t){Object.keys(c).forEach((function(e){window[c[e]]=t[e]})),l("csNode",o,t.Node.prototype),l("csElement",s,t.Element.prototype),l("csEvent",a,t.Event.prototype)}function l(t,e,r){e.forEach((function(e){window[""+(t+e)]=u(r,e)}))}try{!function(){p(window);var t=function(){var t=document.createElement("iframe");t.id="cs-native-frame",t.setAttribute("hidden",""),t.setAttribute("title","Intentionally blank");var e=document.createElement("cs-native-frame-holder");return e.setAttribute("hidden",""),document.body.appendChild(e),e.innerHTML=t.outerHTML,e.firstElementChild.contentWindow}();t&&(window.CSPureWindow=t,p(window.CSPureWindow))}()}catch(t){window.CSProtectnativeFunctionsErrors=JSON.stringify(t)}function h(t){return csString.prototype.replace.call(t,/([#;&,.+*~':"!^$[\]()<=>|/%?@`{}\\ ])/g,"\\$1")}function f(t){return t.nodeType===Node.ELEMENT_NODE}function d(t){return t.nodeType===Node.TEXT_NODE}function y(t){return function(t){return f(t)&&"link"===t.localName}(t)&&"stylesheet"===t.rel}function v(t){return f(t)&&"img"===t.localName}function g(t){return f(t)&&"style"===t.localName}function m(t){return f(t)&&"input"===t.localName}function S(t){return f(t)&&"script"===t.localName}function E(t){switch(t.nodeType){case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:return!0;default:return!1}}function b(t){for(var e=t,r=[e];null!==csNodeparentNode.apply(e);)e=csNodeparentNode.apply(e),csArray.prototype.push.call(r,e);return w(e)&&csArray.prototype.push.call(r,"detached"),{ancestors:r,selectionRoot:e}}function w(t){return O.isValidElement(t)}function C(t){return csArray.prototype.slice.call(t)}function T(){return Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector}var R=T();function A(t,e,r){if("detached"===t||9===t.nodeType)return 0;var n=csArray.prototype.filter.call(C(csNodechildNodes.apply(t)),(function(t){return 1===t.nodeType&&!function(t,e){return!!e&&csArray.prototype.some.call(e,(function(e){return R.call(t,e)}))}(t,r.reliableSelectors)&&csString.prototype.toLowerCase.call(t.localName)===csString.prototype.toLowerCase.call(e.localName)}));return csArray.prototype.indexOf.call(n,e)}var k=[/\d{4}/,/^ember\d+$/];function I(t,e,r,n){var i=n.dynamicIdRegex||null,o=function(t){return h(csString.prototype.toLowerCase.call(t.localName))}(t);if(function(t,e){var r=P(t);return r&&csString.prototype.match.call(r,/^[\w-]+$/)&&_("data-cs-override-id",r,e)}(t,r))return{hasUniqueIdentifier:!0,elementSelector:o+'[data-cs-override-id="'+P(t)+'"]'};var s=function(t){var e=t.getAttribute("id");return e?h(e):e}(t);if(function(t,e,r,n){return e&&!function(t){return null!==P(t)}(t)&&!function(t,e,r){return t.hasAttribute("data-cs-dynamic-id")||function(t,e){var r=!1;t&&e&&(r=e.test(t));return t&&(csArray.prototype.some.call(k,(function(e){return e.test(t)}))||r)}(e,r)}(t,e,n)&&function(t,e){return t&&_("id",t,e)}(e,r)}(t,s,r,i))return{hasUniqueIdentifier:!0,elementSelector:o+"#"+s};var a=function(t,e){var r;return null===(r=e.reliableSelectors)||void 0===r?void 0:r.find((function(e){return R.call(t,e)}))}(t,n);return a?{hasUniqueIdentifier:!1,elementSelector:o+"["+a+"]("+function(t,e,r){if("detached"===t||9===t.nodeType)return 0;var n=csArray.prototype.filter.call(C(csNodechildNodes.apply(t)),(function(t){return 1===t.nodeType&&R.call(t,r)}));return csArray.prototype.indexOf.call(n,e)}(e,t,a)+")"}:{hasUniqueIdentifier:!1,elementSelector:o+":eq("+A(e,t,n)+")"}}function P(t){return t.getAttribute("data-cs-override-id")}function _(t,e,r){try{return 1===r.querySelectorAll("["+t+'="'+e+'"]').length}catch(t){if("SyntaxError"!==t.name)throw t}return!1}var O;function N(t,e,r){var n=csArray.prototype.shift.call(t);if(0===t.length)return x(n,r);var i=I(n,t[0],e,r),o=i.elementSelector,s=i.hasUniqueIdentifier;if(!r.fullPath&&s)return""+x(t[t.length-1],r)+o;var a=N(t,e,r);return(a?a+">":"")+o}function x(t,e){if("detached"===t)return"|detached|";if(t.host){var r=b(t.host);return N(r.ancestors,r.selectionRoot,e)+"|shadow-root|"}return 11===t.nodeType?"|fragment|":""}!function(t){function e(t){return!!t&&"localName"in t&&"getAttribute"in t&&"hasAttribute"in t&&"parentNode"in t}function r(t){return t&&"jquery"in t&&1===t.length?t[0]:t}t.INVALID_ELEMENT="INVALID_ELEMENT",t.isValidElement=e,t.getElementPath=function(n,i){void 0===i&&(i={fullPath:!1,dynamicIdRegex:null});var o=r(n);if(o===document)return"";if(!e(o))return t.INVALID_ELEMENT;var s=b(o);return N(s.ancestors,s.selectionRoot,i)},t.getElementPathAndFirstAnchorParent=function(n,i){void 0===i&&(i={fullPath:!1,dynamicIdRegex:null});var o=r(n);if(o===document)return{path:"",firstAnchorParent:null};if(!e(o))return{path:t.INVALID_ELEMENT,firstAnchorParent:null};var s=function(t){for(var e,r=t,n=[r],i=null;null!==csNodeparentNode.apply(r);)null===i&&(f(e=r)&&"a"===e.localName)&&(i=r),csArray.prototype.push.call(n,csNodeparentNode.apply(r)),r=csNodeparentNode.apply(r);return w(r)&&csArray.prototype.push.call(n,"detached"),{firstAnchorParent:i,ancestors:n,selectionRoot:r}}(o),a=s.firstAnchorParent;return{path:N(s.ancestors,s.selectionRoot,i),firstAnchorParent:a}}}(O||(O={})),window.CSPathComputation=window.CSPathComputation||O;var M=Number.MAX_SAFE_INTEGER||9007199254740991;function L(){return Math.floor(B.now()/1e3)}function D(){}function V(t,e){return 0===csString.prototype.lastIndexOf.call(t,e,0)}function q(t,e){return-1!==csString.prototype.indexOf.call(t,e,t.length-e.length)}var U,z,j={percentage:function(){return Math.floor(1e4*Math.random())/100},boolean:function(t){return this.percentage()<t},integer:function(t){return void 0===t&&(t=M),Math.floor(Math.random()*t)}},B={now:function(){return"undefined"!=typeof performance&&performance.now?performance.timing.navigationStart+Math.round(performance.now()):csDate.now()}},H=function(){function t(t){this.trackerDomain=t.trackerDomain,this.loggerDomain=t.ed,this.minLogLevel=t.logLevel,this.projectId=t.projectId,this.status=t.status,this.hostnames=t.hostnames,this.iframesTracking=!!t.iframesTracking,this.crossDomainTracking=!!t.crossDomainTracking,this.crossDomainSingleIframeTracking=!!t.crossDomainSingleIframeTracking,this.consentRequired=!!t.consentRequired,this.allowSubdomains=!!t.allowSubdomains,this.visitorCookieTimeout=t.visitorCookieTimeout||34164e6,this.sampleRate=t.sampleRate,this.replayRecordingRate=t.replayRecordingRate,this.validationRate=t.validationRate,this.lastTrackingDraw=t.lastTrackingDraw||1,this.useHttps=!0,this.recordingDomain=t.recordingDomain,this.eMerchandisingEnabled=t.eMerchandisingEnabled,this.mouseMoveHeatmapEnabled=t.mouseMoveHeatmapEnabled,this.jsErrorsEnabled=t.jsErrorsEnabled,this.apiErrorsEnabled=t.apiErrorsEnabled,this.triggerSessionReplayEnabled=t.triggerSessionReplayEnabled,this.triggerSessionReplayRegex=this.buildRegexFromConfiguration(t.triggerSessionReplayRegex),this.metricRate=void 0===t.metricRate?0:t.metricRate,this.dynamicIdRegex=t.dynamicIdRegex?new RegExp(t.dynamicIdRegex):null,this.whitelistedAttributes=t.whitelistedAttributes||[],this.replayRecordingUnmaskedUrlRegex=this.buildRegexFromConfiguration(t.replayRecordingUnmaskedUrlRegex),this.replayRecordingMaskedUrlRegex=this.buildRegexFromConfiguration(t.replayRecordingMaskedUrlRegex),this.tagDeploymentMode=t.tagDeploymentMode,this.dualCollectionTagDomain=t.dualCollectionTagDomain||null,this.ptcDomain=t.ptcDomain||null,this.ptcGuid=t.ptcGuid||null,this.secureCookiesEnabled=!!t.secureCookiesEnabled,this.ptcSha512=t.ptcSha512||null,this.ptcSnapshotPath=t.ptcSnapshotPath||null,this.emitDebugEvents=!1,this.useMalkaPipeline=t.useMalkaPipeline,this.malkaQuotaServiceDomain=t.malkaQuotaServiceDomain||null,this.malkaRecordingDomain=t.malkaRecordingDomain||null,this.textVisibilityEnabled=t.textVisibilityEnabled,this.experimental=t.experimental||{},this.malkaEtrEnabled=!!t.malkaEtrEnabled,this.malkaUrlEnabled=!!t.malkaUrlEnabled,this.cookielessTrackingEnabled=t.cookielessTrackingEnabled,this.customHashIdEnabled=!!t.customHashIdEnabled,this.recordingEncryptionEnabled=!!t.recordingEncryptionEnabled,this.recordingEncryptionPublicKey=t.recordingEncryptionPublicKey||null,this.asyncSerializerEnabled=!!t.asyncSerializerEnabled,this.recordingEncryptionPublicKeyId=t.recordingEncryptionPublicKeyId}return t.prototype.getTrackerUri=function(){return this.protocol()+"://"+this.trackerDomain},t.prototype.getRecordingUri=function(){return this.protocol()+"://"+(this.useMalkaPipeline&&this.malkaRecordingDomain?this.malkaRecordingDomain:this.recordingDomain)},t.prototype.getQuotaServiceUri=function(){return this.protocol()+"://"+this.malkaQuotaServiceDomain},t.prototype.getLoggerUri=function(){return this.protocol()+"://"+this.loggerDomain},t.prototype.protocol=function(){return this.useHttps?"https":"http"},t.prototype.isProjectActive=function(){return 1===this.status},t.prototype.processOptionOverrides=function(t){var e=this;t&&t.forEach&&t.forEach((function(t){var r=t[0],n=t.slice(1);if("setOption"===r){var i=n[0],o=n[1];e.setOverridableField(i,o)}}))},t.prototype.setOverridableField=function(t,e){"trackerDomain"===t&&(this.trackerDomain=e),"recordingDomain"===t&&(this.recordingDomain=e),"loggerDomain"===t&&(this.loggerDomain=e),"minLogLevel"===t&&(this.minLogLevel=e),"useHttps"===t&&(this.useHttps=!!e)},t.prototype.buildRegexFromConfiguration=function(t){return t?new RegExp("^"+t+"$"):null},t.prototype.getRequestParameters=function(){return{pid:""+this.projectId}},t.prototype.updateDynamicFields=function(t,e){"emitDebugEvents"===t&&(this.emitDebugEvents=e),"minLogLevel"===t&&(this.minLogLevel=e)},t}(),F=function(){function t(t,e){this.window=t,this.conf=e}return t.prototype.init=function(){this.inIframeContext=this.window.self!==this.window.top,this.conf.iframesTracking&&this.inIframeContext?this.topWindowTracker=!1:this.topWindowTracker=!0},t.prototype.isInIframeContext=function(){return this.inIframeContext},t.prototype.isTopWindowTracker=function(){return this.topWindowTracker},t}();!function(t){t.debug="debug",t.warn="warn",t.error="error",t.critical="critical"}(U||(U={})),function(t){t.toQuery=function(t){return csArray.prototype.join.call(csArray.prototype.map.call(Object.keys(t),(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})),"&")}}(z||(z={}));var G,W=function(){return(W=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},X=function(){function t(t,e){this.domainUri=t,this.path=e,this.beforeRequestCallbacks=[],this.afterRequestCallbacks=[]}return t.prototype.setRequestParametersProviders=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.requestParametersProviders=t},t.prototype.before=function(t){csArray.prototype.push.call(this.beforeRequestCallbacks,t)},t.prototype.after=function(t){csArray.prototype.push.call(this.afterRequestCallbacks,t)},t.prototype.retrieveParameters=function(){return this.requestParametersProviders?csArray.prototype.reduce.call(csArray.prototype.map.call(this.requestParametersProviders,(function(t){return t.getRequestParameters()})),(function(t,e){return W(W({},t),e)})):{}},t}(),K=(G=function(t,e){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}G(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),Y=function(t){function e(e,r){return t.call(this,e,r)||this}return K(e,t),e.prototype.send=function(){csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var t=this.retrieveParameters();this.addCacheBusting(t);var e=z.toQuery(t);this.generatePixel(e),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(t){return t()}))},e.prototype.generatePixel=function(t){var e=new window.Image(1,1);e.onload=D,e.onerror=D,e.src=this.domainUri+(this.path?"/"+this.path:"")+"?"+t},e.prototype.addCacheBusting=function(t){t.r=csString.prototype.slice.call(""+Math.random(),2,8)},e}(X),J=function(){function t(t,e){this.projectConfiguration=t,this.basicLogRequestParameter=e}return t.prototype.init=function(){this.request=new Y(this.projectConfiguration.getLoggerUri()),this.request.setRequestParametersProviders(this,this.basicLogRequestParameter)},t.prototype.send=function(t){this.log=t,this.request.send()},t.prototype.getRequestParameters=function(){return{a:this.log.app,l:this.log.level,m:this.log.message,s:this.log.stacktrace}},t}(),Q=/[a-zA-Z0-9._%+-]+(?:@|%40)[a-zA-Z0-9.%-_]+((?:\.|%2[eE])[a-zA-Z0-9-]+)+/g,Z=/[a-zA-Z0-9+_-](?:@|%40)/,$=function(){function t(){}return t.prototype.anonymize=function(t){return"string"==typeof t&&Z.test(t)?csString.prototype.replace.call(t,Q,"CS_ANONYMIZED_EMAIL"):t},t.prototype.anonymizeFields=function(t,e){var r=this;return csArray.prototype.forEach.call(e,(function(e){t[e]=r.anonymize(t[e])})),t},t}();function tt(){return"11.3.0"}function et(){return{v:"11.3.0"}}var rt,nt=function(){return(nt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},it=function(){function t(t,e){this.configuration=t,this.pii=e}return t.prototype.getRequestParameters=function(){return nt(nt({d:""+B.now(),p:this.pii.anonymize(window.location.href),u:navigator.userAgent},this.configuration.getRequestParameters()),{v:"11.3.0"})},t}();!function(t){t[t.debug=0]="debug",t[t.warn=1]="warn",t[t.error=2]="error",t[t.critical=3]="critical"}(rt||(rt={}));var ot=function(){function t(t,e,r){var n;this.parentLogContext=e,this.pii=new $,this.minLogLevel=rt[U.warn],this.isLoggingActive=!1,this.minLogLevel=rt[t.minLogLevel||U.warn];var i=t.validationRate>=0?t.validationRate:10;this.isLoggingActive=j.boolean(i),this.request=r||new J(t,new it(t,this.pii)),this.logTrack=((n={})[U.debug]=[],n[U.warn]=[],n[U.error]=[],n[U.critical]=[],n),this.snippetLogCounter={},this.request.init()}return t.prototype.send=function(t,e,r){if(void 0===e&&(e=""),void 0===r&&(r=U.warn),this.isLoggingAllowed(r,e)){csArray.prototype.push.call(this.logTrack[r],e||"");var n={message:this.getMessage(t,e),stacktrace:this.getStacktrace(t),app:"uxa",level:r};this.request.send(n)}},t.prototype.getMessage=function(t,e){var r=t instanceof Error?this.pii.anonymize(t.message||t.toString()):t;return e&&(r+=" ErrorCode: "+e),r},t.prototype.getStacktrace=function(t){return t instanceof Error?(t.stack||"No stacktrace")+" "+this.getContext():this.getContext()},t.prototype.getContext=function(){var t=this.parentLogContext.getVisitorService(),e=null==t?void 0:t.getVisitor();if(!e)return"No context";var r=this.parentLogContext.getSessionService(),n=r&&r.getSession(),i={userId:e.id,sessionNumber:e.visitsCount,pageNumber:n&&n.pageNumber};return csJSON.stringify(i)},t.prototype.isLoggingAllowed=function(t,e){if(!this.isLoggingActive||rt[t]<this.minLogLevel)return!1;if(0===(null==e?void 0:e.indexOf("snippet-",0)))return this.isLoggingAllowedForSnippets(e);var r=this.logTrack[t];return!(r.length>=5)&&(!e||!csArray.prototype.some.call(r,(function(t){return t===e})))},t.prototype.isLoggingAllowedForSnippets=function(t){return t in this.snippetLogCounter?!(this.snippetLogCounter[t]>=5)&&(this.snippetLogCounter[t]+=1,!0):(this.snippetLogCounter[t]=1,!0)},t}(),st=document.createElement("a");function at(t){return st.href=t,st.href}function ct(t){if(!V(t,"http://")&&!V(t,"https://"))return"";var e=document.createElement("a");return e.href=t,decodeURIComponent(e.hostname)}function ut(t,e){return csArray.prototype.some.call(e,(function(e){return q(t,"."+e)||t===e||""===e}))}var pt,lt,ht,ft,dt;!function(t){t.AfterPageView="afterPageView",t.GetSessionKey="getSessionKey"}(pt||(pt={})),function(t){t.Parent="parent",t.Child="child"}(lt||(lt={})),function(t){t.Discovery="discovery",t.Stop="stop",t.ChildLogMessage="childLogMessage",t.AnalysisEvent="analysisEvent",t.JavascriptError="javascriptError",t.ApiError="apiError",t.EmerchandisingMessage="emerchandisingMessage",t.Commands="commands",t.IntegrationCallback="integrationCallback"}(ht||(ht={})),(dt=ft||(ft={})).buildBaseMessage=function(t,e,r,n){var i={type:t,from:e,pid:r,signature:"CS_IFRAME_MESSAGE"};return void 0!==n&&n>=0&&(i.id=n),i},dt.isMessageValid=function(t,e,r,n){var i=ct(t.origin);return!!t.data&&!!t.data.type&&"CS_IFRAME_MESSAGE"===t.data.signature&&t.data.from===e&&t.data.pid===r&&ut(i,n)},dt.sendMessage=function(t,e,r){t.postMessage(r,e)};var yt=function(){function t(t){this.configuration=t}return t.prototype.send=function(t,e,r){void 0===e&&(e=""),void 0===r&&(r=U.warn);var n={message:t,errorCode:e,level:r},i=ft.buildBaseMessage(ht.ChildLogMessage,lt.Child,this.configuration.projectId);i.content=n,ft.sendMessage(window.parent,"*",i)},t}(),vt=function(){function t(){}return t.prototype.setContext=function(t,e){this.visitorService=t,this.sessionService=e},t.prototype.getVisitorService=function(){return this.visitorService},t.prototype.getSessionService=function(){return this.sessionService},t}();function gt(t){return bt(t)&&("number"==typeof t||t instanceof Number)&&!isNaN(t)}function mt(t){return t===parseInt(t,10)}function St(t){return bt(t)&&("string"==typeof t||t instanceof csString)}function Et(t){return"object"==typeof t}function bt(t){return void 0!==t}function wt(t){return bt(t)&&null!==t}function Ct(t){return"function"==typeof t}function Tt(t){return t instanceof Element}var Rt,At,kt,It,Pt=function(){function t(){}return t.setStrategy=function(e){t.strategy=e},t.getStrategy=function(){return t.strategy},t.debug=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,U.debug)},t.warn=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,U.warn)},t.error=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,U.error)},t.critical=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,U.critical)},t.tryToExecute=function(t,e){var r=this;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];try{var o=e.apply(void 0,n);return bt(window.Promise)&&o instanceof window.Promise?o.then((function(t){return t}),(function(e){return r.error(e,t)})):o}catch(e){try{r.error(e,t)}catch(t){}}}},t}(),_t=function(t){return function(e,r,n){var i=r.toString(),o=t||(e.constructor&&e.constructor.name)+"."+i,s=n.value;n.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Pt.tryToExecute(o,s.bind(this)).apply(void 0,t)}}};!function(t){function e(t){var e=new RegExp("(^|;)[ ]*"+t+"=([^;]*)").exec(document.cookie);return e?decodeURIComponent(e[2]):null}function r(e,r,i,o,s,a){var c=encodeURIComponent(""+r),u=i===t.CURRENT_DOMAIN?void 0:i,p=n(o),l=e+"="+c+(p?";expires="+p.toUTCString():"")+";path=/"+(wt(u)?";domain="+u:"");return bt(s)&&s!==kt.NotSet&&(l=l+";SameSite="+s),bt(a)&&a===It.Yes&&(l+=";Secure"),document.cookie=l,!0}function n(t){return gt(t)?new csDate(B.now()+t):t}function i(t,n){e(t)&&r(t,"",n,new csDate(0)),e(t)&&r(t,"",n,new csDate(0),kt.None,It.Yes)}t.CURRENT_DOMAIN="CURRENT_DOMAIN",t.get=e,t.set=r,t.toExpireDate=n,t.remove=i,t.isCookiePresent=function(){return document.cookie.length>0},t.getRootDomain=function(t,n){var o=e("_cs_root-domain");if(null!==o&&"1"!==o)return o;for(var s=csString.prototype.split.call(window.location.hostname,"."),a=csArray.prototype.pop.call(s);s.length&&(null===o||"1"===o);)r("_cs_root-domain",a=csArray.prototype.join.call([csArray.prototype.pop.call(s),a],"."),a,void 0,t,n),o=e("_cs_root-domain");return i("_cs_root-domain",a),a}}(Rt||(Rt={})),function(t){t.browserIsSafariV12=function(){return window.navigator.vendor&&csString.prototype.indexOf.call(window.navigator.vendor,"Apple")>-1&&window.navigator.appVersion&&csString.prototype.indexOf.call(window.navigator.appVersion,"Version/12.")>-1}}(At||(At={})),function(t){t.None="None",t.Lax="Lax",t.NotSet="X"}(kt||(kt={})),function(t){t[t.Yes=1]="Yes",t[t.No=0]="No"}(It||(It={}));var Ot=function(){function t(t,e,r){this.configuration=t,this.urlService=e,this.cookieChecker=r,this.supportsSameSite=!1,this.sameSiteFlag=kt.NotSet,this.secureFlag=It.No}return t.prototype.getSameSiteFlag=function(){return this.sameSiteFlag},t.prototype.getSecureFlag=function(){return this.secureFlag},t.prototype.getDomain=function(){return this.domain},t.prototype.getRootDomain=function(){return this.rootDomain},t.prototype.init=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.computeSameSiteFlag(),e=this.computeSecureFlag();this.supportsSameSite=this.checkSameSiteFromContext(t,e),this.supportsSameSite?(this.sameSiteFlag=t,this.secureFlag=e):this.configuration.secureCookiesEnabled&&"https:"===this.urlService.getUrlProtocol()&&(this.secureFlag=It.Yes),this.rootDomain=this.computeRootDomain(),this.domain=this.computeDomain(this.rootDomain)}},t.prototype.checkSameSiteFromContext=function(e,r){return!At.browserIsSafariV12()&&(Rt.set(t.COOKIE_TEST_FOR_SAME_SITE,"Test same site",t.CURRENT_DOMAIN,void 0,e,r),!!Rt.get(t.COOKIE_TEST_FOR_SAME_SITE)&&(Rt.remove(t.COOKIE_TEST_FOR_SAME_SITE,t.CURRENT_DOMAIN),!0))},t.prototype.computeSameSiteFlag=function(){return"http:"===this.urlService.getUrlProtocol()?kt.Lax:this.cookieChecker.isSameSiteNoneSecureNeeded()||this.configuration.crossDomainTracking?kt.None:kt.Lax},t.prototype.computeSecureFlag=function(){return"http:"===this.urlService.getUrlProtocol()?It.No:this.configuration.secureCookiesEnabled||this.configuration.crossDomainTracking||this.cookieChecker.isSameSiteNoneSecureNeeded()?It.Yes:It.No},t.prototype.isSameSiteSupported=function(){return this.supportsSameSite},t.prototype.set=function(t,e,r){var n=Rt.toExpireDate(r);Rt.set(t,e,this.domain,n,this.getSameSiteFlag(),this.getSecureFlag())},t.prototype.get=function(t){var e=new RegExp("(^|;)[ ]*"+t+"=([^;]*)").exec(document.cookie);return e?decodeURIComponent(e[2]):null},t.prototype.delete=function(t,e){var r=e||this.domain;Rt.remove(t,r)},t.prototype.computeRootDomain=function(){var t=this.cookieChecker.isSameSiteNoneSecureNeeded()&&this.isSameSiteSupported(),e=t?kt.None:void 0,r=t?It.Yes:void 0;return Rt.getRootDomain(e,r)},t.prototype.computeDomain=function(t){return this.configuration.allowSubdomains?t:Rt.CURRENT_DOMAIN},t.CURRENT_DOMAIN="CURRENT_DOMAIN",t.COOKIE_TEST_FOR_SAME_SITE="_cs_same_site",t}(),Nt=function(){function t(t,e){this.iframeContext=t,this.configuration=e,this.cookieEnabled=!1,this.useSameSiteNoneSecureCookie=!1}return t.prototype.init=function(){if(!this.configuration.cookielessTrackingEnabled&&this.iframeContext.isTopWindowTracker()&&"cookie"in document){if(!this.iframeContext.isInIframeContext()&&Rt.isCookiePresent())return this.cookieEnabled=!0,void(this.useSameSiteNoneSecureCookie=!1);if(Rt.set("_cs_t","1",Rt.CURRENT_DOMAIN),null!==Rt.get("_cs_t"))return this.cookieEnabled=!0,this.useSameSiteNoneSecureCookie=!1,void Rt.remove("_cs_t",Rt.CURRENT_DOMAIN);Rt.set("_cs_t","1",Rt.CURRENT_DOMAIN,void 0,kt.None,It.Yes),null!==Rt.get("_cs_t")&&(this.cookieEnabled=!0,this.useSameSiteNoneSecureCookie=!0,Rt.remove("_cs_t",Rt.CURRENT_DOMAIN))}},t.prototype.areCookiesEnabled=function(){return this.cookieEnabled},t.prototype.isSameSiteNoneSecureNeeded=function(){return this.useSameSiteNoneSecureCookie},t}();function xt(){var t="CSLocalStorageTest";try{return localStorage.setItem(t,t),localStorage.getItem(t)!==t?!1:(localStorage.removeItem(t),!0)}catch(t){return!1}}var Mt=function(){function t(){}return t.check=function(){return void 0===Object.assign||this.tryObjectAssign()},t.tryObjectAssign=function(){try{var t={},e=Object.assign(t,{a:1},{b:2,c:{d:4}}),r={a:1,b:2,c:{d:4}};return csJSON.stringify(e)===csJSON.stringify(r)&&csJSON.stringify(t)===csJSON.stringify(r)}catch(t){return!1}},t}();var Lt,Dt,Vt,qt,Ut=function(){function t(t,e){this.configuration=t,this.cookieChecker=e}return t.prototype.canTrack=function(){return this.isBrowsingContextSupported()&&this.canTrackProject()&&this.canUseStorage()},t.prototype.canTrackInIframe=function(){return this.isBrowsingContextSupported()&&this.canTrackProject()},t.prototype.canUseStorage=function(){return this.configuration.cookielessTrackingEnabled?function(){var t="CSSessionStorageTest";try{return sessionStorage.setItem(t,t),sessionStorage.getItem(t)!==t?!1:(sessionStorage.removeItem(t),!0)}catch(t){return!1}}()&&xt():this.cookieChecker.areCookiesEnabled()&&xt()},t.prototype.canTrackProject=function(){return this.configuration.isProjectActive()&&ut(window.location.hostname,this.configuration.hostnames)},t.prototype.isBrowsingContextSupported=function(){return!this.isDocPrerendered()&&this.isBrowserSupported()&&Mt.check()},t.prototype.isDocPrerendered=function(){return"visibilityState"in document&&"prerender"===document.visibilityState},t.prototype.isBrowserSupported=function(){return"pageXOffset"in window&&"pageYOffset"in window&&"onpagehide"in window&&"JSON"in window&&"parse"in window.JSON&&"stringify"in window.JSON&&"addEventListener"in window&&"removeEventListener"in window&&"Node"in window&&"filter"in csArray.prototype&&"forEach"in csArray.prototype&&"querySelectorAll"in document&&"now"in Date&&"keys"in Object&&"performance"in window},t}(),zt=function(){function t(t,e,r,n,i){this.visitorService=t,this.sessionService=e,this.exclusionService=r,this.customVariablesService=n,this.configuration=i}return t.prototype.get=function(){return{exclusion:this.exclusionService.getAppliedTrackingDraw(),visitor:this.visitorService.getVisitor(),session:this.sessionService.getSession(),cvars:this.customVariablesService.getCustomVariablesSession()}},t.prototype.apply=function(t){t&&(t.exclusion?this.exclude():this.include(t))},t.prototype.exclude=function(){this.exclusionService.exclude(this.configuration),this.visitorService.removeVisitor(),this.sessionService.removeSession(),this.customVariablesService.removeCustomVariablesSession()},t.prototype.include=function(t){this.exclusionService.removeExclusion(),this.visitorService.setVisitor(t.visitor),t.session?this.sessionService.setSession(t.session):this.sessionService.removeSession(),t.cvars?this.customVariablesService.setCustomVariableSession(t.cvars):this.customVariablesService.removeCustomVariablesSession()},t}(),jt=/^(([a-z0-9\-])+(\.[0-9]+){6})(\.(None|Lax|X)\.(0|1))?$/,Bt=function(){function t(t,e,r,n){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=n}return t.prototype.get=function(){var e;return(e=this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.getItem("_cs_id"):this.cookieService.get("_cs_id"))?t.fromString(e):null},t.prototype.set=function(e){var r=t.toString(e);if(this.configuration.cookielessTrackingEnabled)this.browserSessionStorage.setItem("_cs_id",r);else{var n=new csDate(e.expires);this.cookieService.set("_cs_id",r,n),this.crossDomainSingleIframeService.setCookie("_cs_id",r,n)}},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_id"):(this.cookieService.delete("_cs_id"),this.crossDomainSingleIframeService.removeCookie("_cs_id"))},t.prototype.handleSubdomainChange=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.get();t&&(this.configuration.allowSubdomains?this.cookieService.delete("_cs_id",Ot.CURRENT_DOMAIN):this.cookieService.delete("_cs_id",this.cookieService.getRootDomain()),this.set(t))}},t.fromString=function(t){var e=csString.prototype.split.call(t,"."),r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6];return{id:r,creationTimestamp:Number(n),visitsCount:Number(i),hitTimestamp:Number(o),lastVisitTimestamp:Number(s),appliedTrackingDraw:Number(a),expires:Number(c)}},t.toString=function(t){return csArray.prototype.join.call([t.id,t.creationTimestamp,t.visitsCount,t.hitTimestamp,t.lastVisitTimestamp,t.appliedTrackingDraw,t.expires],".")},t.isValidVisitorString=function(t){return jt.test(t)},t}();!function(t){t.REPLAY_RECORDING_DISABLED="1",t.REPLAY_RECORDING_ENABLED="3",t.TRIGGER_REPLAY_RECORDING_ENABLED="5"}(Lt||(Lt={})),function(t){t.NOT_RECORDED="0",t.TEMPORARILY_RECORDED="T",t.GLOBAL_SAMPLING="5",t.URL_SAMPLING="6",t.ETR_SAMPLING="7"}(Dt||(Dt={})),function(t){t.ETR_OFF="0",t.ETR_ON="1"}(Vt||(Vt={})),function(t){t.ETR_LEGACY="0",t.ETR_SESSION="1",t.ETR_PAGE="2"}(qt||(qt={}));var Ht,Ft=/^\d+\.[013567T](\.[01])?(\.\d+)?$/;!function(t){t[t.NOT_FOUND=0]="NOT_FOUND",t[t.EXPIRED=1]="EXPIRED",t[t.FOUND=2]="FOUND"}(Ht||(Ht={}));var Gt,Wt=function(){function t(t,e,r,n){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=n,this.cache=null}return t.prototype.get=function(e){var r=this.getRawSession(e);return this.isValid(r)?t.fromString(r):null},t.prototype.getRawSession=function(e){if(e){var r=this.getRawValueFromStorage();return t.removeSessionTimestamp(r)}var n=this.getFromCache(),i=n.sessionString,o=n.status,s=t.removeSessionTimestamp(i);if(o!==Ht.EXPIRED)return s;if(this.configuration.cookielessTrackingEnabled)return null;var a=this.getRawValueFromStorage();if(!a)return null;var c=csString.prototype.split.call(a,".");if(!t.isSessionWithTimestampValue(c))return a;var u=c[c.length-1],p=parseInt(u,10);return isNaN(p)||this.refreshCache(p),s},t.prototype.set=function(t,e){void 0===e&&(e=18e5);var r=B.now()+e,n=this.toString(t);n+="."+r,this.setInCache(n,r),this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_s",n):(this.cookieService.set("_cs_s",n,e),this.crossDomainSingleIframeService.setCookie("_cs_s",n,e))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_s"):(this.cookieService.delete("_cs_s"),this.crossDomainSingleIframeService.removeCookie("_cs_s")),this.clearCache()},t.prototype.handleSubdomainChange=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.get(!0);t&&(this.configuration.allowSubdomains?this.cookieService.delete("_cs_s",Ot.CURRENT_DOMAIN):this.cookieService.delete("_cs_s",this.cookieService.getRootDomain()),this.set(t))}},t.prototype.isValid=function(e){return null!==e&&t.isValidSessionString(e)},t.prototype.toString=function(t){return csArray.prototype.join.call([t.pageNumber,t.recordingState,t.etrState],".")},t.prototype.setInCache=function(t,e){this.cache={sessionString:t,expires:e}},t.prototype.getFromCache=function(){return this.cache?this.cache&&B.now()<=this.cache.expires?{sessionString:this.cache.sessionString,status:Ht.FOUND}:{sessionString:this.cache.sessionString,status:Ht.EXPIRED}:{sessionString:this.getRawValueFromStorage(),status:Ht.NOT_FOUND}},t.prototype.clearCache=function(){this.cache=null},t.prototype.refreshCache=function(t){this.cache&&(this.cache.expires=t)},t.prototype.getRawValueFromStorage=function(){if(this.configuration.cookielessTrackingEnabled){var t=this.browserSessionStorage.getItem("_cs_s");return!t||this.hasExpired(t)?null:t}return this.cookieService.get("_cs_s")},t.prototype.hasExpired=function(t){var e=csString.prototype.split.call(t,"."),r=parseInt(e[e.length-1],10);return!isNaN(r)&&B.now()>r},t.isSessionWithTimestampValue=function(t){return 13===t[t.length-1].length},t.removeSessionTimestamp=function(e){if(!e)return null;var r=csString.prototype.split.call(e,".");return t.isSessionWithTimestampValue(r)?csArray.prototype.join.call(csArray.prototype.slice.call(r,0,-1),"."):e},t.fromRawString=function(e){var r=t.removeSessionTimestamp(e);return null!==r?t.fromString(r):null},t.fromString=function(t){var e=csString.prototype.split.call(t,"."),r=e[0],n=e[1],i=e[2];return{recordingState:n,etrState:null!=i?i:Vt.ETR_OFF,pageNumber:parseInt(r,10)}},t.isValidSessionString=function(t){return Ft.test(t)},t}();(Gt||(Gt={})).fromRaw=function(t){return{exclusion:Number(t._cs_ex)||0,visitor:t._cs_id?Bt.fromString(t._cs_id):null,session:t._cs_s?Wt.fromRawString(t._cs_s):null,cvars:t._cs_cvars?window.JSON.parse(t._cs_cvars):null}};var Xt,Kt=/^[0-9]+$/,Yt=function(){function t(t,e,r,n){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=n}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?Number(this.browserSessionStorage.getItem("_cs_ex")):Number(this.cookieService.get("_cs_ex"))},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_ex",t):(this.cookieService.set("_cs_ex",t,2592e6),this.crossDomainSingleIframeService.setCookie("_cs_ex",t,2592e6))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_ex"):(this.cookieService.delete("_cs_ex"),this.crossDomainSingleIframeService.removeCookie("_cs_ex"))},t.isValidExclusionString=function(t){return Kt.test(t)},t}(),Jt=function(){function t(t,e,r,n){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=n}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.getItem("_cs_cvars"):this.cookieService.get("_cs_cvars")},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_cvars",t):(this.cookieService.set("_cs_cvars",t),this.crossDomainSingleIframeService.setCookie("_cs_cvars",t))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_cvars"):(this.cookieService.delete("_cs_cvars"),this.crossDomainSingleIframeService.removeCookie("_cs_cvars"))},t.isValidCustomVarString=function(t){return"string"==typeof t},t}();!function(t){function e(t){var e=["_cs_ex","_cs_id","_cs_s","_cs_cvars"];return csArray.prototype.every.call(Object.keys(t),(function(t){return csArray.prototype.indexOf.call(e,t)>=0}))}t.isRawDomainState=e,t.isValid=function(t){return!!e(t)&&((!t._cs_id||Bt.isValidVisitorString(t._cs_id))&&(!t._cs_s||Wt.isValidSessionString(t._cs_s))&&(!t._cs_ex||Yt.isValidExclusionString(t._cs_ex))&&(!t._cs_cvars||Jt.isValidCustomVarString(t._cs_cvars)))}}(Xt||(Xt={}));var Qt,Zt=function(){function t(t,e){this.xdframeOpener=t,this.location=e}return t.prototype.retrieve=function(e,r){var n=this;this.callback=r,this.retrievedStates=[],this.xdframeOrigins=csArray.prototype.map.call(csArray.prototype.filter.call(e,(function(t){return n.isNotCurrentHostname(t)})),t.getXdframeOrigin),this.xdframeOpener.onMessage((function(t){n.handleXdframeMessage(t)})),this.xdframeOpener.onTimeout((function(){n.handleTimeout()})),this.xdframeOpener.start(),csArray.prototype.forEach.call(csArray.prototype.map.call(this.xdframeOrigins,t.getXdframeUrl),(function(t){return n.xdframeOpener.open(t)}))},t.prototype.handleXdframeMessage=function(t){if(this.isXdframeMessage(t)){var e=t.data;if(!Xt.isValid(e))throw this.xdframeOpener.stop(),"Invalid domain state: "+csJSON.stringify(t.data)+" from "+t.origin;csArray.prototype.push.call(this.retrievedStates,e)}this.allMessagesAreIn()&&(this.xdframeOpener.stop(),this.callback(csArray.prototype.map.call(this.retrievedStates,Gt.fromRaw)))},t.prototype.handleTimeout=function(){Pt.warn("xdframe: all messages not received")},t.prototype.isXdframeMessage=function(t){return csArray.prototype.indexOf.call(this.xdframeOrigins,t.origin)>-1},t.prototype.allMessagesAreIn=function(){return this.retrievedStates.length===this.xdframeOrigins.length},t.prototype.isNotCurrentHostname=function(t){return!q(this.location.hostname,t)},t.getXdframeOrigin=function(t){return"https://csxd."+t},t.getXdframeUrl=function(t){return t+"/xdframe-1.0.0.html"},t}(),$t=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},te=function(){function t(){var t=this;this.ALL_MESSAGES_RECEIVED_TIMEOUT=3e3,this.scopedHandleMessage=function(e){t.handleMessage(e)}}return t.prototype.onMessage=function(t){this.onMessageCallback=t},t.prototype.onTimeout=function(t){this.onTimeoutCallback=t},t.prototype.start=function(){var t=this;window.addEventListener("message",this.scopedHandleMessage),this.timeoutId=window.setTimeout((function(){t.onTimeoutCallback()}),this.ALL_MESSAGES_RECEIVED_TIMEOUT)},t.prototype.open=function(t){var e=document.createElement("iframe");return e.src=t,e.setAttribute("hidden",""),e.setAttribute("title","Intentionally blank"),document.body.appendChild(e),e},t.prototype.stop=function(){window.removeEventListener("message",this.scopedHandleMessage),window.clearTimeout(this.timeoutId),this.onMessageCallback=D,this.onTimeoutCallback=D},t.prototype.handleMessage=function(t){this.onMessageCallback(t)},$t([_t("XdframeMessage")],t.prototype,"handleMessage",null),t}(),ee=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),re=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},ne=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.afterRequestDataRetrievedCallbacks=[],n.requestHeaders=[],n.timeout=0,n}return ee(e,t),e.prototype.setCompressionOptions=function(t,e){this.compressor=t,this.compressionOutputType=e},e.prototype.setRequestPayloadProvider=function(t){this.requestPayloadProvider=t},e.prototype.setRequestHeader=function(t){csArray.prototype.push.call(this.requestHeaders,t)},e.prototype.afterProvidersCalled=function(t){csArray.prototype.push.call(this.afterRequestDataRetrievedCallbacks,t)},e.prototype.onLoad=function(t){this.onLoadCallback=t},e.prototype.onError=function(t){this.onErrorCallback=t},e.prototype.onTimeout=function(t,e){this.timeout=t,this.onTimeoutCallback=e},e.prototype.send=function(){var t=this;csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var e=this.retrieveParameters(),r=z.toQuery(e),n=this.retrievePayload();csArray.prototype.forEach.call(this.afterRequestDataRetrievedCallbacks,(function(t){return t()})),this.compressor&&this.compressionOutputType?this.compressor.compress(this.compressionOutputType,n,(function(e){t.doSend(r,e)})):this.doSend(r,n)},e.prototype.retrievePayload=function(){return this.requestPayloadProvider?this.requestPayloadProvider.getRequestPayload():""},e.prototype.doSend=function(t,e){this.sendXMLHttpRequest(t,e),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(t){return t()}))},e.prototype.sendXMLHttpRequest=function(t,e){var r=this;if(null!==window.XMLHttpRequest){var n=new XMLHttpRequest;n.open("POST",this.domainUri+"/"+this.path+"?"+t,!0);for(var i=0,o=this.requestHeaders;i<o.length;i++){var s=o[i];n.setRequestHeader(s.name,s.value)}this.onLoadCallback&&(n.onload=function(){r.onLoadCallback(n)}),this.onErrorCallback&&(n.onerror=function(){r.onErrorCallback()}),this.timeout&&this.onTimeoutCallback&&(n.timeout=this.timeout,n.ontimeout=function(){r.onTimeoutCallback()}),n.send(e)}},re([_t("POST request")],e.prototype,"doSend",null),e}(X);!function(t){t[t.MUTATION_INSERT=1]="MUTATION_INSERT",t[t.MUTATION_REMOVE=2]="MUTATION_REMOVE",t[t.MUTATION_ATTRIBUTE=3]="MUTATION_ATTRIBUTE",t[t.MUTATION_CHARACTER_DATA=4]="MUTATION_CHARACTER_DATA",t[t.INITIAL_DOM=5]="INITIAL_DOM",t[t.SCROLL=6]="SCROLL",t[t.MOUSE_MOVE=7]="MOUSE_MOVE",t[t.CLICK=8]="CLICK",t[t.RESIZE=9]="RESIZE",t[t.INPUT_CHECKABLE=10]="INPUT_CHECKABLE",t[t.INPUT_SELECT=11]="INPUT_SELECT",t[t.INPUT_TEXT=12]="INPUT_TEXT",t[t.HASH_CHANGE=13]="HASH_CHANGE",t[t.CONSENT_GRANTED=14]="CONSENT_GRANTED",t[t.CONSENT_WITHDRAWN=15]="CONSENT_WITHDRAWN",t[t.MOUSE_OVER=16]="MOUSE_OVER",t[t.VISIBILITY_CHANGE=17]="VISIBILITY_CHANGE",t[t.STYLESHEET_RULE_INSERT=18]="STYLESHEET_RULE_INSERT",t[t.STATIC_RESOURCE_URL=19]="STATIC_RESOURCE_URL",t[t.PERFORMANCE_TIMINGS=20]="PERFORMANCE_TIMINGS",t[t.ATTACH_SHADOW=22]="ATTACH_SHADOW",t[t.STYLESHEET_CSS_TEXT_UPDATE=23]="STYLESHEET_CSS_TEXT_UPDATE",t[t.MOUSE_DOWN=24]="MOUSE_DOWN",t[t.MOUSE_UP=25]="MOUSE_UP",t[t.JAVASCRIPT_ERROR=26]="JAVASCRIPT_ERROR",t[t.PAGE_EVENT=27]="PAGE_EVENT",t[t.API_ERROR=28]="API_ERROR",t[t.TEXT_VISIBILITY=29]="TEXT_VISIBILITY",t[t.MUTATION_ENCRYPTED_CHARACTER_DATA=30]="MUTATION_ENCRYPTED_CHARACTER_DATA",t[t.INPUT_ENCRYPTED_TEXT=31]="INPUT_ENCRYPTED_TEXT"}(Qt||(Qt={}));function ie(t,e){void 0===e&&(e=!0),t.boundElement.addEventListener(t.type,t.listener,e)}function oe(t,e){void 0===e&&(e=!0),t.boundElement.removeEventListener(t.type,t.listener,e)}var se=function(){return(se=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ae=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},ce=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},ue=function(){function t(t,e,r,n,i,o){this.nodeIdentifier=t,this.projectConfiguration=e,this.encryption=r,this.textNodesBuffer=n,this.textNodesMutationsBuffer=i,this.inputNodesBuffer=o,this.publicKey=null,this.importKeyDone=!1}return t.prototype.onTextNodeToEncrypt=function(t){this.onTextNodeToEncryptCallback=t},t.prototype.onInputNodeToEncrypt=function(t){this.onInputNodeToEncryptCallback=t},t.prototype.init=function(){var t=this;this.isFeatureSupported()&&(this.textNodesBuffer.onSerializeNode((function(e){return t.serializeTextNodeToEncrypt(e)})),this.textNodesMutationsBuffer.onSerializeNode((function(e){return t.serializeTextNodeMutationToEncrypt(e)})),this.inputNodesBuffer.onSerializeNode((function(e){return t.serializeInputNodeToEncrypt(e)})),this.importPublicKey(this.projectConfiguration.recordingEncryptionPublicKey))},t.prototype.importPublicKey=function(t){return ae(this,void 0,void 0,(function(){var e;return ce(this,(function(r){switch(r.label){case 0:return[4,this.encryption.importKey(t)];case 1:return e=r.sent(),this.importKeyDone=!0,e?(this.publicKey=e,this.textNodesBuffer.serializeNodesFromBuffer()):(this.textNodesBuffer.clear(),Pt.warn("Fail to import public key '"+t+"'")),this.textNodesMutationsBuffer.serializeNodesFromBuffer(),this.inputNodesBuffer.serializeNodesFromBuffer(),[2]}}))}))},t.prototype.registerTextNodeToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeTextNodeToEncrypt(t):this.textNodesBuffer.addNewNode(t))},t.prototype.registerTextNodeMutationToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeTextNodeMutationToEncrypt(t):this.textNodesMutationsBuffer.addNewNode(t))},t.prototype.registerInputNodeToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeInputNodeToEncrypt(t):this.inputNodesBuffer.addNewNode(t))},t.prototype.isFeatureSupported=function(){return this.projectConfiguration.recordingEncryptionEnabled&&!!this.projectConfiguration.recordingEncryptionPublicKey&&this.projectConfiguration.recordingEncryptionPublicKeyId>0&&this.encryption.isSupported()},t.prototype.serializeTextNodeToEncrypt=function(t){var e=this,r=t.textNode;this.nodeIdentifier.ifIdentified(r,(function(r){if(e.publicKey){var n=se(se({},t),{targetId:r,date:B.now()});e.encryptAndProcessEvent(n,(function(t){return t.textNode.data}),(function(){return Pt.warn("Fail to encrypt text node data")}),(function(t,r){return e.processEncryptedTextMutation(t,r)}))}}))},t.prototype.serializeTextNodeMutationToEncrypt=function(t){var e=this;if(!this.publicKey)return this.fallbackToCharacterData(t);this.encryptAndProcessEvent(t,(function(t){return t.textNode.data}),(function(){Pt.warn("Fail to encrypt text node data - Text node processed as MUTATION_CHARACTER_DATA"),e.fallbackToCharacterData(t)}),(function(t,r){return e.processEncryptedTextMutation(t,r)}))},t.prototype.serializeInputNodeToEncrypt=function(t){var e=this;if(!this.publicKey)return this.fallbackToInputText(t);this.encryptAndProcessEvent(t,(function(t){return t.targetValue}),(function(){Pt.warn("Fail to encrypt input data - Input node processed as INPUT_TEXT"),e.fallbackToInputText(t)}),(function(t,r){return e.processEncryptedInputText(t,r)}))},t.prototype.encryptAndProcessEvent=function(t,e,r,n){return ae(this,void 0,void 0,(function(){var i,o;return ce(this,(function(s){switch(s.label){case 0:return i=e(t),[4,this.encryption.encrypt(this.publicKey,i)];case 1:return(o=s.sent())?(n(t,o),[2]):(r(t),[2])}}))}))},t.prototype.fallbackToCharacterData=function(t){var e=t.targetId,r=t.serializedTextData,n=t.date;this.onTextNodeToEncryptCallback({date:n,args:[e,r],type:Qt.MUTATION_CHARACTER_DATA})},t.prototype.fallbackToInputText=function(t){var e=t.targetId,r=t.targetValue,n=t.date;this.onInputNodeToEncryptCallback({date:n,args:[e,csString.prototype.replace.call(r,/\S/g,"")],type:Qt.INPUT_TEXT})},t.prototype.processEncryptedTextMutation=function(t,e){var r=t.targetId,n=t.serializedTextData,i=t.date;this.onTextNodeToEncryptCallback({date:i,args:[r,n,e,this.projectConfiguration.recordingEncryptionPublicKeyId],type:Qt.MUTATION_ENCRYPTED_CHARACTER_DATA})},t.prototype.processEncryptedInputText=function(t,e){var r=t.targetId,n=t.targetValue,i=t.date;this.onInputNodeToEncryptCallback({date:i,args:[r,csString.prototype.replace.call(n,/\S/g,""),e,this.projectConfiguration.recordingEncryptionPublicKeyId],type:Qt.INPUT_ENCRYPTED_TEXT})},t}(),pe=function(){return(pe=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},le=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},he=function(){function t(e,r,n,i){var o=this;this.selector=e,this.nodeIdentifier=r,this.sensitiveContent=n,this.encryptionService=i,this.documents=[],this.onEventCallbacks=[],this.eventHandlers=[{type:"change",listener:this.selector.on(t.whiteListedCheckableInputsSelector,(function(t){return o.inputCheckableListener(csEventtarget.apply(t))}))},{type:"change",listener:this.selector.on("select",(function(t){return o.inputSelectListener(csEventtarget.apply(t))}))},{type:"keyup",listener:this.selector.on(t.whiteListedTextInputSelector,(function(t){return o.inputTextListener(csEventtarget.apply(t))}))},{type:"scroll",listener:function(t){return o.scrollListener(csEventtarget.apply(t))}},{type:"mouseover",listener:function(t){return o.mouseOverListener(t)}},{type:"click",listener:function(t){return o.clickListener(t)}},{type:"mousedown",listener:function(t){return o.mouseDownListener(t)}},{type:"mouseup",listener:function(t){return o.mouseUpListener(t)}}]}return t.prototype.init=function(){var t=this;this.initSubscribers(),this.encryptionService.onInputNodeToEncrypt((function(e){return t.triggerCallbacks(e)}))},t.prototype.initSubscribers=function(){var t=this;this.nodeIdentifier.onIdentifierAdded((function(e){E(e)&&t.bindHandlers(e)})),this.nodeIdentifier.onIdentifierRemoved((function(e){E(e)&&t.unbindHandlers(e)}))},t.prototype.onEvent=function(t){csArray.prototype.push.call(this.onEventCallbacks,(function(e){e.date=B.now(),t(e)}))},t.prototype.triggerCallbacks=function(t){csArray.prototype.forEach.call(this.onEventCallbacks,(function(e){return e(t)}))},t.prototype.start=function(){this.triggerInitialEvents()},t.prototype.stop=function(){this.unbindAllHandlers()},t.prototype.bindHandlers=function(t){-1===csArray.prototype.indexOf.call(this.documents,t)&&(csArray.prototype.push.call(this.documents,t),csArray.prototype.forEach.call(this.eventHandlers,(function(e){return ie(pe({boundElement:t},e))})))},t.prototype.unbindHandlers=function(t){this.documents=csArray.prototype.filter.call(this.documents,(function(e){return e!==t})),csArray.prototype.forEach.call(this.eventHandlers,(function(e){return oe(pe({boundElement:t},e))}))},t.prototype.unbindAllHandlers=function(){var t=this;csArray.prototype.forEach.call(this.documents,(function(e){return t.unbindHandlers(e)}))},t.prototype.triggerInitialEvents=function(){this.initialTextInputListener(),this.initialScrollListener(),this.initialSelectListener(),this.initialCheckableListener()},t.prototype.initialTextInputListener=function(){for(var e=document.querySelectorAll(t.whiteListedTextInputSelector),r=0;r<e.length;r+=1){var n=e.item(r);n.value.length>0&&this.inputTextListener(n)}},t.prototype.initialScrollListener=function(){for(var t=document.getElementsByTagName("*"),e=0;e<t.length;e+=1){var r=t[e],n=this.getScrollPosition(r),i=n.top,o=n.left;0===i&&0===o||this.scrollListener(r)}},t.prototype.initialSelectListener=function(){for(var t=document.getElementsByTagName("select"),e=0;e<t.length;e+=1)this.inputSelectListener(t[e])},t.prototype.initialCheckableListener=function(){for(var e=document.querySelectorAll(t.whiteListedCheckableInputsSelector),r=0;r<e.length;r+=1)this.inputCheckableListener(e[r])},t.prototype.getScrollPosition=function(t){return t===document?{top:window.pageYOffset,left:window.pageXOffset}:{top:t.scrollTop,left:t.scrollLeft}},t.prototype.scrollListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t,(function(r){if(!e.sensitiveContent.isSensitiveElementNode(t)){var n=e.getScrollPosition(t);e.triggerCallbacks({type:Qt.SCROLL,args:[r,n.left,n.top]})}}))},t.prototype.mouseOverListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t.target,(function(t){e.triggerCallbacks({type:Qt.MOUSE_OVER,args:[t]})}))},t.prototype.clickListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t.target,(function(t){e.triggerCallbacks({type:Qt.CLICK,args:[t]})}))},t.prototype.mouseDownListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(csEventtarget.apply(t),(function(r){e.triggerCallbacks({type:Qt.MOUSE_DOWN,args:[r,t.button]})}))},t.prototype.mouseUpListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(csEventtarget.apply(t),(function(r){e.triggerCallbacks({type:Qt.MOUSE_UP,args:[r,t.button]})}))},t.prototype.inputCheckableListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t,(function(r){e.sensitiveContent.isSensitiveElementNode(t)||e.triggerCallbacks({type:Qt.INPUT_CHECKABLE,args:[r,t.checked]})}))},t.prototype.inputSelectListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t,(function(r){e.sensitiveContent.isSensitiveElementNode(t)||e.triggerCallbacks({type:Qt.INPUT_SELECT,args:[r,t.selectedIndex]})}))},t.prototype.inputTextListener=function(t){var e=this;this.nodeIdentifier.ifIdentified(t,(function(r){e.sensitiveContent.isSensitiveElementNode(t)||(t.hasAttribute("data-cs-encrypt")?e.encryptionService.registerInputNodeToEncrypt({targetId:r,targetValue:t.value,date:B.now()}):e.triggerCallbacks({type:Qt.INPUT_TEXT,args:[r,csString.prototype.replace.call(t.value,/\S/g,"")]}))}))},t.whiteListedTextInputSelector=csArray.prototype.join.call(["textarea","input:not([type])",'input[type="text"]','input[type="email"]','input[type="search"]','input[type="tel"]','input[type="url"]'],","),t.whiteListedCheckableInputsSelector=csArray.prototype.join.call(['input[type="checkbox"]','input[type="radio"]'],","),le([_t("scroll")],t.prototype,"scrollListener",null),le([_t("mouseOver")],t.prototype,"mouseOverListener",null),le([_t("click")],t.prototype,"clickListener",null),le([_t("mousedown")],t.prototype,"mouseDownListener",null),le([_t("mouseup")],t.prototype,"mouseUpListener",null),le([_t("checkable")],t.prototype,"inputCheckableListener",null),le([_t("select")],t.prototype,"inputSelectListener",null),le([_t("text")],t.prototype,"inputTextListener",null),t}(),fe=function(){function t(t,e,r,n,i){var o=this;this.mutationSerializer=t,this.mutationObserver=e,this.staticResourceUrlTracker=r,this.lifeCycleEventsEmitter=n,this.configuration=i,this.mutationObserver.onCharacterDataMutation((function(t){o.mutationSerializer.isSerializationInProgress()?o.mutationSerializer.updateNodeMapCharacterData(t):o.characterDataMutation(t)})),this.mutationObserver.onAttributesMutation((function(t){o.mutationSerializer.isSerializationInProgress()?o.mutationSerializer.updateNodeMapAttributesMutation(t):o.attributesMutation(t)})),this.mutationObserver.onChildListMutation((function(t){o.mutationSerializer.isSerializationInProgress()?o.mutationSerializer.updateNodeMapChildList(t):o.childListMutation(t)})),this.mutationObserver.onAttachShadowMutation((function(t){o.mutationSerializer.isSerializationInProgress(),o.attachShadowEvent(t)}))}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.mutationObserver.start(),this.recordInitialDom()},t.prototype.stop=function(){this.mutationObserver.stop()},t.prototype.getDocument=function(){return document},t.prototype.shouldSerializeAsync=function(){return"Promise"in window&&"findIndex"in csArray.prototype&&"Map"in window&&this.configuration.asyncSerializerEnabled},t.prototype.recordInitialDom=function(){var t=this,e=this.getDocument();if(this.shouldSerializeAsync())this.mutationSerializer.serializeDocumentAsync(e).then((function(e){t.onEventCallback({args:e,date:B.now(),type:Qt.INITIAL_DOM}),t.lifeCycleEventsEmitter.emitInitialDomDone(e)})).catch((function(t){Pt.error(t)}));else{var r=this.mutationSerializer.serializeDocumentSync(e);this.onEventCallback({args:r,date:B.now(),type:Qt.INITIAL_DOM}),this.lifeCycleEventsEmitter.emitInitialDomDone(r)}},t.prototype.attachShadowEvent=function(t){var e=this.mutationSerializer.serializeAttachShadowEvent(t);e&&this.onEventCallback({args:e,date:t.date,type:Qt.ATTACH_SHADOW})},t.prototype.attributesMutation=function(t){var e=this.mutationSerializer.serializeMutationAttribute(t);e&&(this.onEventCallback({args:e,date:t.date,type:Qt.MUTATION_ATTRIBUTE}),this.staticResourceUrlTracker.scanAttribute(t.target,t.attributeName))},t.prototype.characterDataMutation=function(t){var e=this.mutationSerializer.serializeMutationCharacterData(t);e&&(this.onEventCallback({args:e,date:t.date,type:Qt.MUTATION_CHARACTER_DATA}),this.staticResourceUrlTracker.scanText(t.target))},t.prototype.childListMutation=function(t){var e=this,r=this.mutationSerializer.serializeMutationChildList(t);if(r){var n=r.removedNodes,i=r.addedNodes;csArray.prototype.forEach.call(n,(function(r){e.onEventCallback({args:r,date:t.date,type:Qt.MUTATION_REMOVE})})),csArray.prototype.forEach.call(i,(function(r){e.onEventCallback({args:r,date:t.date,type:Qt.MUTATION_INSERT})}))}},t}(),de=function(){function t(t){this.storageCharsUsed=0,this.maxStoredChars=0,this.maxStoredChars=t/2}return t.prototype.add=function(t){this.storageCharsUsed+=t.length},t.prototype.isThresholdReached=function(){return this.storageCharsUsed>this.maxStoredChars},t.prototype.reset=function(){this.storageCharsUsed=0},t}(),ye=function(){function t(t,e,r){void 0===t&&(t=[]),void 0===e&&(e={}),void 0===r&&(r=512e3),this.events=t,this.requestParameters=e,this.sizeCounter=new de(r)}return t.prototype.addEvent=function(t){this.sizeCounter.add(csJSON.stringify(t)),csArray.prototype.push.call(this.events,t)},t.prototype.eventsCount=function(){return this.events.length},t.prototype.clearEvents=function(){this.sizeCounter.reset(),this.events=[]},t.prototype.isFull=function(){return this.sizeCounter.isThresholdReached()||this.eventsCount()>=100},t.prototype.setRequestParametersFromProvider=function(t){var e=t.getRequestParameters();for(var r in e)e.hasOwnProperty(r)&&(this.requestParameters[r]=e[r])},t.prototype.removeRequestParameter=function(t){this.requestParameters.hasOwnProperty(t)&&delete this.requestParameters[t]},t.prototype.getEvents=function(){return this.events},t.prototype.getRequestPayload=function(){return csJSON.stringify(this.events)},t.prototype.getRequestParameters=function(){return this.requestParameters},t}(),ve=function(){function t(){this.index=1}return t.prototype.increment=function(){this.index+=1},t.prototype.reset=function(){this.index=1},t.prototype.getRequestParameters=function(){return{ri:""+this.index}},t}(),ge=function(){function t(){}return t.prototype.emit=function(e,r){var n=t.prefix+"."+e,i=t.createEvent(n,{detail:r});null!==i&&document.dispatchEvent(i)},t.createEvent=function(t,e){if(void 0===e&&(e={}),"function"==typeof CustomEvent)return new CustomEvent(t,e);var r=this.tryToCreateCustomEvent();if(null===r)return null;var n=e.bubbles,i=void 0!==n&&n,o=e.cancelable,s=void 0!==o&&o,a=e.detail;return r.initCustomEvent(t,i,s,a),r},t.tryToCreateCustomEvent=function(){try{return document.createEvent("CustomEvent")}catch(t){return null}},t.prefix="cs.tracking",t}(),me=function(){function t(){this.isStarted=!1}return t.prototype.start=function(){this.isStarted||(this.isStarted=!0,this.onStart())},t.prototype.stop=function(){this.isStarted&&(this.isStarted=!1,this.onStop())},t.prototype.restart=function(){this.stop(),this.start()},t}(),Se=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ee=function(){return(Ee=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},be=function(t){function e(e,r,n,i,o,s,a,c,u,p,l,h,f,d,y,v,g,m){var S=t.call(this)||this;return S.configuration=e,S.recordingRequest=r,S.recordingBatch=n,S.requestParameters=i,S.requestIndex=o,S.styleSheetRuleTracker=s,S.recordingMutationsTracker=a,S.recordingPageEventsTracker=c,S.recordingBrowserEventsTracker=u,S.sessionRenewer=p,S.staticResourceUrlTracker=l,S.recordingPerformanceTimingsTracker=h,S.javaScriptErrorsTracker=f,S.javaScriptErrorsAnonymizer=d,S.apiErrorsTracker=y,S.textVisibilityTracker=v,S.apiErrorsAnonymizer=g,S.encryptionService=m,S.javaScriptErrorsCount=0,S.apiErrorsCount=0,S.eventEmitter=new ge,S.canSendEvents=!0,S.onEvent=function(t){return S.processEvent(t)},S}return Se(e,t),e.prototype.init=function(){this.bindRecordingRequest(),this.bindTrackers()},e.prototype.bindRecordingRequest=function(){var t=this;this.recordingRequest.setRequestPayloadProvider(this.recordingBatch),this.recordingRequest.setRequestParametersProviders(this.recordingBatch),this.recordingRequest.afterProvidersCalled((function(){t.recordingBatch.clearEvents(),t.requestIndex.increment(),t.recordingBatch.setRequestParametersFromProvider(t.requestParameters)}))},e.prototype.bindTrackers=function(){var t=this;this.styleSheetRuleTracker.onEvent(this.onEvent),this.recordingMutationsTracker.onEvent(this.onEvent),this.recordingBrowserEventsTracker.onEvent(this.onEvent),this.recordingPageEventsTracker.onEvent(this.onEvent),this.staticResourceUrlTracker.onEvent(this.onEvent),this.recordingPerformanceTimingsTracker.onEvent(this.onEvent),this.textVisibilityTracker.onEvent(this.onEvent),this.javaScriptErrorsTracker.onEvent((function(e){return t.processJavascriptError(e)})),this.apiErrorsTracker.onEvent((function(e){return t.processApiError(e)})),this.encryptionService.onTextNodeToEncrypt(this.onEvent)},e.prototype.blockSendingEvents=function(){this.canSendEvents=!1},e.prototype.allowSendingEvents=function(){this.canSendEvents=!0},e.prototype.processEvent=function(t){this.sessionRenewer.isSessionValid()&&(this.recordingBatch.addEvent(t),this.recordingBatch.isFull()&&this.pushEvents(),this.configuration.emitDebugEvents&&this.eventEmitter.emit("recordingEvent",Ee(Ee({},t),{typeName:Qt[t.type]})))},e.prototype.onStart=function(){this.recordingBatch.setRequestParametersFromProvider(this.requestParameters),this.recordingPerformanceTimingsTracker.start(),this.styleSheetRuleTracker.start(),this.textVisibilityTracker.start(),this.recordingMutationsTracker.start(),this.recordingBrowserEventsTracker.start(),this.configuration.jsErrorsEnabled&&this.javaScriptErrorsTracker.start(),this.configuration.apiErrorsEnabled&&this.apiErrorsTracker.start(),this.configuration.emitDebugEvents&&this.eventEmitter.emit("replayRecordingStarted")},e.prototype.onStop=function(){this.styleSheetRuleTracker.stop(),this.recordingMutationsTracker.stop(),this.recordingBrowserEventsTracker.stop(),this.recordingPageEventsTracker.stop(),this.javaScriptErrorsTracker.stop(),this.apiErrorsTracker.stop(),this.textVisibilityTracker.stop()},e.prototype.clearStates=function(){this.pushEvents(),this.requestIndex.reset(),this.removeEtrRequestParameters(),this.recordingBatch.setRequestParametersFromProvider(this.requestParameters),this.javaScriptErrorsCount=0,this.apiErrorsCount=0},e.prototype.pushEvents=function(){this.textVisibilityTracker.flushEvents(),this.recordingBatch.eventsCount()>0&&this.canSendEvents&&(this.isStarted?this.recordingRequest.send():this.recordingBatch.clearEvents())},e.prototype.processApiError=function(t){this.apiErrorsCount<e.MAX_API_ERROR_COUNT&&(this.onEvent({type:Qt.API_ERROR,date:B.now(),args:[this.apiErrorsAnonymizer.anonymize(t)]}),this.apiErrorsCount=this.apiErrorsCount+1)},e.prototype.processJavascriptError=function(t){this.javaScriptErrorsCount<e.MAX_JAVASCRIPT_ERROR_COUNT&&(this.onEvent({type:Qt.JAVASCRIPT_ERROR,date:B.now(),args:[this.javaScriptErrorsAnonymizer.anonymize(t)]}),this.javaScriptErrorsCount=this.javaScriptErrorsCount+1)},e.prototype.setEtrRequestParameters=function(t){this.isStarted&&(t===qt.ETR_SESSION?this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){var t;return(t={})[e.ETRS_PARAMETER]=e.ETR_ACTIVE,t}}):t===qt.ETR_PAGE&&this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){var t;return(t={})[e.ETRP_PARAMETER]=e.ETR_ACTIVE,t}}))},e.prototype.removeEtrRequestParameters=function(){this.recordingBatch.removeRequestParameter(e.ETRP_PARAMETER),this.recordingBatch.removeRequestParameter(e.ETRS_PARAMETER)},e.prototype.clearEvents=function(){this.recordingBatch.clearEvents()},e.prototype.onCustomErrorEvent=function(t){this.processJavascriptError(t)},e.prototype.onPageEvent=function(t){this.triggerPageEvent(t)},e.prototype.onEventTriggerRecording=function(t,e){this.setEtrRequestParameters(e),this.triggerPageEvent(t)},e.prototype.triggerPageEvent=function(t){this.recordingBatch.addEvent({type:Qt.PAGE_EVENT,date:B.now(),args:[{eventName:csString.prototype.slice.call(t,0,e.MAX_PAGE_EVENT_LENGTH)}]})},e.prototype.triggerConsentGranted=function(){this.recordingBatch.addEvent({date:B.now(),type:Qt.CONSENT_GRANTED})},e.prototype.triggerConsentWithdrawn=function(){this.recordingBatch.addEvent({date:B.now(),type:Qt.CONSENT_WITHDRAWN})},e.MAX_PAGE_EVENT_LENGTH=255,e.MAX_JAVASCRIPT_ERROR_COUNT=20,e.MAX_API_ERROR_COUNT=20,e.ETRP_PARAMETER="etrp",e.ETRS_PARAMETER="etrs",e.ETR_ACTIVE="1",e}(me),we=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ce=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.recordingRecoveryRequest=e,o.recordingBatch=r,o.recoveryStorage=n,o.configuration=i,o.pageChangeHandler=function(){try{var t=o.recordingBatch.getRequestParameters();if(!o.hasValidRecordingType(t.rt)||0===o.recordingBatch.eventsCount())return;o.recoveryStorage.save({metadata:t,events:o.recordingBatch.getEvents()})}catch(t){}},o}return we(e,t),e.prototype.onStart=function(){this.addPageChangeListener()},e.prototype.onStop=function(){this.removePageChangeListener()},e.prototype.recover=function(){this.sendPersistedRecordings()},e.prototype.sendPersistedRecordings=function(){var t=this,e=this.recoveryStorage.recover(),r=e.rawBatches,n=e.recoveredSize;if(0!==r.length){var i=csArray.prototype.map.call(csArray.prototype.filter.call(r,(function(e){var r=e.metadata;return t.hasValidRecordingType(r.rt)})),(function(e){var r=e,n=r.metadata,i=r.events,o=new ye(i,n);return t.recordingRecoveryRequest.setRequestPayloadProvider(o),t.recordingRecoveryRequest.setRequestParametersProviders(o),t.recordingRecoveryRequest.send(),e}));n>1048576&&Pt.warn("\n        Size of data retrieved from local storage "+n+" exceeds 1048576.\n        Number of tabs saved in local storage: "+i.length+"\n      ")}},e.prototype.addPageChangeListener=function(){window.addEventListener("pagehide",this.pageChangeHandler)},e.prototype.removePageChangeListener=function(){window.removeEventListener("pagehide",this.pageChangeHandler)},e.prototype.hasValidRecordingType=function(t){return!this.configuration.useMalkaPipeline||!!t&&t!==Dt.TEMPORARILY_RECORDED},e}(me),Te=/[^\s]/g;function Re(t){return csString.prototype.replace.call(t,Te,"a")}var Ae,ke,Ie=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Pe=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},_e=function(){function t(t,e,r,n,i,o,s,a){this.consentService=t,this.domSerializer=e,this.nodeIdentifier=r,this.sensitiveContent=n,this.anonymization=i,this.encryptionService=o,this.configuration=s,this.urlService=a,this.serializationInProgress=!1}return t.prototype.init=function(){this.resetAnonymization()},t.prototype.isSerializationInProgress=function(){return this.serializationInProgress},t.prototype.updateNodeMapCharacterData=function(t){var e=this.serializeMutationCharacterData(t);this.domSerializer.updateTextNode(e)},t.prototype.updateNodeMapAttributesMutation=function(t){var e=this.serializeMutationAttribute(t);this.domSerializer.updateAttribute(e,this.useAnonymization)},t.prototype.updateNodeMapChildList=function(t){var e=this;this.nodeIdentifier.ifIdentified(t.target,(function(r){var n=e.serializeMutationChildList(t);n&&e.domSerializer.updateChildren(r,n)}))},t.prototype.serializeDocumentSync=function(t){return this.nodeIdentifier.setAsyncSerializationMode(!1),[this.domSerializer.serialize(t,{forceChildrenSerialization:!0,withAnonymization:this.useAnonymization})]},t.prototype.serializeDocumentAsync=function(t){return Ie(this,void 0,void 0,(function(){return Pe(this,(function(e){switch(e.label){case 0:this.serializationInProgress=!0,e.label=1;case 1:return e.trys.push([1,,3,4]),[4,this.domSerializer.startSerializeAsync(t,{withAnonymization:this.useAnonymization})];case 2:return[2,[e.sent()]];case 3:return this.serializationInProgress=!1,[7];case 4:return[2]}}))}))},t.prototype.serializeMutationCharacterData=function(t){var e=this;return this.nodeIdentifier.ifIdentified(t.target,(function(r){var n=t.target;if(n.data!==t.oldValue){var i=t.target.parentElement;if(!d(n)||!(null==i?void 0:i.hasAttribute("data-cs-encrypt")))return[r,e.useAnonymization?e.anonymization.anonymizeTextIfNeeded(n):n.data];e.encryptionService.registerTextNodeMutationToEncrypt({targetId:r,textNode:n,serializedTextData:Re(n.data),date:t.date})}}))},t.prototype.serializeAttachShadowEvent=function(t){var e=t.target,r=t.shadowRoot;if(this.nodeIdentifier.hasIdentifier(e)&&!this.nodeIdentifier.hasIdentifier(r))return[this.nodeIdentifier.getId(e),this.domSerializer.serialize(r)]},t.prototype.serializeMutationAttribute=function(t){var e=this,r=t.target,n=t.attributeName,i=t.attributeNamespace;return this.nodeIdentifier.ifIdentified(t.target,(function(o){if(!e.sensitiveContent.isSensitiveAttributeName(r,n)){var s=t.target.getAttributeNS(i,n);if(s!==t.oldValue)return s=e.anonymization.anonymizeAttributeIfNeeded(e.useAnonymization,n,s),[o,i,n,s]}}))},t.prototype.serializeMutationChildList=function(t){var e=this;return this.nodeIdentifier.ifIdentified(t.target,(function(r){if(!e.sensitiveContent.isSensitiveElementNode(t.target))return{removedNodes:e.serializeRemovedNodes(t),addedNodes:e.serializeAddedNodes(t,r)}}))},t.prototype.serializeRemovedNodes=function(t){for(var e=[],r=0;r<t.removedNodes.length;r+=1){var n=this.nodeIdentifier.popId(t.removedNodes[r]);n&&csArray.prototype.push.call(e,[n])}return e},t.prototype.serializeAddedNodes=function(t,e){for(var r=[],n=t.nextSibling?this.nodeIdentifier.ifIdentified(t.nextSibling,(function(t){return t})):null,i=0;i<t.addedNodes.length;i+=1){var o=t.addedNodes[i];if(!this.nodeIdentifier.hasIdentifier(o)){var s=this.domSerializer.serialize(o,{withAnonymization:this.useAnonymization});csArray.prototype.push.call(r,[e,n,s])}}return r},t.prototype.resetAnonymization=function(){this.useAnonymization=!this.consentService.isAllowedByConsent(),this.useAnonymization?this.configuration.replayRecordingUnmaskedUrlRegex&&this.configuration.replayRecordingUnmaskedUrlRegex.test(this.urlService.getUrl())&&(this.useAnonymization=!1):this.configuration.replayRecordingMaskedUrlRegex&&this.configuration.replayRecordingMaskedUrlRegex.test(this.urlService.getUrl())&&(this.useAnonymization=!0)},t}(),Oe=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Ne=function(){function t(t,e,r){var n=this;this.monkeyPatcher=t,this.nodeIdentifier=e,this.staticResourceUrlTracker=r,this.canTrackRuleInsertions()&&(this.insertRuleInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:window.CSSStyleSheet.prototype,methodName:"insertRule",hook:function(t){var e=t.context,r=t.args;return n.sendInsertion(e,r)}})),this.canTrackStyleDeclarationChanges()&&(this.cssTextInterceptor=this.monkeyPatcher.createDescriptorInterceptor(window.CSSStyleDeclaration.prototype,"cssText",(function(t,e){return n.setStyleDeclarationCssText(t,e)})))}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.insertRuleInterceptor&&this.insertRuleInterceptor.activate(),this.cssTextInterceptor&&this.cssTextInterceptor.activate()},t.prototype.stop=function(){this.insertRuleInterceptor&&this.insertRuleInterceptor.deactivate(),this.cssTextInterceptor&&this.cssTextInterceptor.deactivate()},t.prototype.setStyleDeclarationCssText=function(t,e){var r=this,n=this.getSyleSheet(t);n&&n.ownerNode&&this.nodeIdentifier.ifIdentified(n.ownerNode,(function(i){var o=r.indexOfRule(n.cssRules,t.parentRule);r.onEventCallback({date:B.now(),type:Qt.STYLESHEET_CSS_TEXT_UPDATE,args:[i,o,e]}),r.staticResourceUrlTracker.scanCssString(e)}))},t.prototype.getSyleSheet=function(t){var e=t.parentRule;return e&&e.parentStyleSheet},t.prototype.indexOfRule=function(t,e){return csArray.prototype.indexOf.call(csArray.from(t),e)},t.prototype.canTrackRuleInsertions=function(){return window.CSSStyleSheet&&window.CSSStyleSheet.prototype&&"function"==typeof window.CSSStyleSheet.prototype.insertRule},t.prototype.canTrackStyleDeclarationChanges=function(){return window.CSSStyleDeclaration&&window.CSSStyleDeclaration.prototype&&Object.getOwnPropertyDescriptor(window.CSSStyleDeclaration.prototype,"cssText")},t.prototype.sendInsertion=function(t,e){var r=this,n=e[0],i=e[1];this.nodeIdentifier.ifIdentified(t.ownerNode,(function(t){r.onEventCallback({date:B.now(),type:Qt.STYLESHEET_RULE_INSERT,args:bt(i)?[t,n,i]:[t,n]}),r.staticResourceUrlTracker.scanCssString(n)}))},Oe([_t("styleSheetRuleTracker.setStyleDeclarationCssText")],t.prototype,"setStyleDeclarationCssText",null),Oe([_t("styleSheetRuleTracker.sendInsertion")],t.prototype,"sendInsertion",null),t}(),xe=function(){function t(){}return t.prototype.beforeSerialize=function(t,e){return t},t.prototype.beforeSerializeChildren=function(t,e,r){return e},t.prototype.beforeSerializeAttributes=function(t,e,r){return e},t.prototype.serializeNode=function(t,e,r){return e},t.prototype.afterSerialize=function(t,e,r){return e},t.prototype.afterSerializeShadowRoot=function(t,e,r){return e},t.prototype.serializeElementNode=function(t,e,r){return e},t.prototype.serializeAttribute=function(t,e,r,n){return r},t.prototype.serializeTextNode=function(t,e,r){return e},t.prototype.serializeCDATASectionNode=function(t,e,r){return e},t.prototype.serializeCommentNode=function(t,e,r){return e},t.prototype.serializeDoctypeNode=function(t,e,r){return e},t.prototype.serializeDocumentNode=function(t,e,r){return e},t.prototype.serializeShadowRootNode=function(t,e,r){return e},t}(),Me=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};(ke=Ae||(Ae={})).getShadowRoot=function(t){return Tt(t)?csElementshadowRoot.apply(t):null},ke.findNestedShadowHosts=function t(e){for(var r,n=[],i=0,o=function(t){var e=C(t.querySelectorAll("*"));return csArray.prototype.filter.call(e,(function(t){return csElementshadowRoot.apply(t)}))}(e);i<o.length;i++){var s=o[i];(r=csArray.prototype.push).call.apply(r,Me([n,s],t(csElementshadowRoot.apply(s))))}return n};var Le,De=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ve=function(t){function e(){var e=t.call(this)||this;return e.identifierAddedHandlers=[],e.identifierRemovedHandlers=[],e.currentCsId=1,e.serializationMap=new Map,e.defaultOptions={},e.asyncSerialization=!0,e}return De(e,t),e.prototype.setAsyncSerializationMode=function(t){this.asyncSerialization=t},e.prototype.registerNodeInMap=function(t,e){var r=t.csId;this.serializationMap.set(r,{serializedNode:t,options:e})},e.prototype.clearMap=function(){this.serializationMap.clear()},e.prototype.deleteNode=function(t){this.serializationMap.delete(t)},e.prototype.setDefaultSerializationOptions=function(t){this.defaultOptions=t},e.prototype.getNodeFromMap=function(t){var e;return null===(e=this.serializationMap.get(t))||void 0===e?void 0:e.serializedNode},e.prototype.getOptionsFromMap=function(t){var e,r=this.getId(t);return r&&(null===(e=this.serializationMap.get(r))||void 0===e?void 0:e.options)||this.defaultOptions},e.prototype.getNodeFromMapByNode=function(t){var e=this.getId(t);if(e)return this.getNodeFromMap(e)},e.prototype.beforeSerialize=function(t,e){return e.forceChildrenSerialization&&this.popId(t),t},e.prototype.beforeSerializeChildren=function(t,e){var r=this;return csArray.prototype.filter.call(e,(function(t){return!r.hasIdentifier(t)}))},e.prototype.serializeNode=function(t,e){var r=this.currentCsId;return this.currentCsId+=1,t.__contentsquare_identifier=r,e.csId=r,this.notifySubscribers(this.identifierAddedHandlers,t),e},e.prototype.afterSerialize=function(t,e,r){return this.asyncSerialization&&this.registerNodeInMap(e,r),e},e.prototype.afterSerializeShadowRoot=function(t,e,r){return this.asyncSerialization&&this.registerNodeInMap(e,r),e},e.prototype.ifIdentified=function(t,e){if(this.hasIdentifier(t))return e(this.getId(t))},e.prototype.getId=function(t){return t.__contentsquare_identifier},e.prototype.onIdentifierAdded=function(t){csArray.prototype.push.call(this.identifierAddedHandlers,t)},e.prototype.onIdentifierRemoved=function(t){csArray.prototype.push.call(this.identifierRemovedHandlers,t)},e.prototype.popId=function(t){var e=this.getId(t);delete t.__contentsquare_identifier,this.notifySubscribers(this.identifierRemovedHandlers,t);for(var r=t.firstChild;null!==r;r=csNodenextSibling.apply(r))this.popId(r);var n=Ae.getShadowRoot(t);return n&&this.popId(n),e},e.prototype.hasIdentifier=function(t){return"__contentsquare_identifier"in t},e.prototype.notifySubscribers=function(t,e){for(var r=0,n=t;r<n.length;r++){(0,n[r])(e)}},e}(xe),qe=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ue=["value","checked","src","data","alt"],ze=function(t){function e(e){var r=t.call(this)||this;return r.piiMaskingService=e,r}return qe(e,t),e.prototype.beforeSerializeChildren=function(t,e){return this.isSensitiveElementNode(t)?[]:e},e.prototype.beforeSerializeAttributes=function(t,e){var r=this;return this.isSensitiveElementNode(t)&&(csArray.prototype.push.call(e,this.createSensitiveElementDimensionsAttribute(t)),this.isDataCSMaskNeeded(t)&&csArray.prototype.push.call(e,document.createAttribute("data-cs-mask"))),csArray.prototype.filter.call(e,(function(e){return!r.isSensitiveAttributeName(t,e.name)}))},e.prototype.isSensitiveElementNode=function(t){return f(t)&&(this.piiMaskingService.checkNodeMatch(t)||S(t)||this.isSensitiveImageElement(t))},e.prototype.isSensitiveAttributeName=function(t,e){return this.piiMaskingService.checkAttributeMatch(t,e)||this.isSensitiveElementNode(t)&&-1!==csArray.prototype.indexOf.call(Ue,e)||this.isSensitiveInputValue(t,e)},e.prototype.isSensitiveImageElement=function(t){return!!v(t)&&V(t.src,"data:")},e.prototype.isSensitiveInputValue=function(t,e){return m(t)&&"value"===e&&"button"!==t.getAttribute("type")},e.prototype.isDataCSMaskNeeded=function(t){return!S(t)&&!t.hasAttribute("data-cs-mask")},e.prototype.createSensitiveElementDimensionsAttribute=function(t){var e=t.getBoundingClientRect(),r=document.createAttribute("style");return r.value="width: "+e.width+"px; height: "+e.height+"px;",r},e}(xe),je=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Be=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},He=["id","class","style","src","srcset","sizes","href","rel","type","width","height","media","align","dir","bgcolor","color","border","colspan","rowspan","cols","rows","size","start","data-cs-override-id"],Fe=function(t){function e(e,r){var n=t.call(this)||this;return n.pii=e,n.configuration=r,n.allWhitelistedAttributes=[],n}return je(e,t),e.prototype.init=function(){this.allWhitelistedAttributes=Be(He,this.configuration.whitelistedAttributes)},e.prototype.beforeSerializeChildren=function(t,e,r){return this.isStyleOrWhitelistedElement(t)&&(r.withAnonymization=!1),e},e.prototype.serializeNode=function(t,e,r){return e.anonymized=r.withAnonymization,e},e.prototype.serializeAttribute=function(t,e,r,n){r.anonymized=n.withAnonymization;var i=this.anonymizeAttributeIfNeeded(n.withAnonymization,e.name,e.value);return r.value=this.piiAnonymizeAttributeIfNeeded(e.name,i),r},e.prototype.serializeTextNode=function(t,e,r){var n=r.withAnonymization?this.anonymizeTextIfNeeded(t):t.data;return e.data=this.pii.anonymize(n),e},e.prototype.serializeCDATASectionNode=function(t,e,r){var n=t.data,i=r.withAnonymization?Re(n):n;return e.data=this.pii.anonymize(i),e},e.prototype.anonymizeTextIfNeeded=function(t){var e=t.data,r=csNodeparentNode.apply(t);return r&&this.isStyleOrWhitelistedElement(r)?e:Re(e)},e.prototype.anonymizeAttributeIfNeeded=function(t,e,r){return t&&null!==r?this.isWhitelistedAttribute(e)?r:"":r},e.prototype.piiAnonymizeAttributeIfNeeded=function(t,e){return this.isWhitelistedAttribute(t)?e:this.pii.anonymize(e)},e.prototype.setWhitelistedElementsSelector=function(t){this.whitelistedElementsSelector=t},e.prototype.isWhitelistedAttribute=function(t){return-1!==csArray.prototype.indexOf.call(this.allWhitelistedAttributes,t)},e.prototype.isWhitelistedElement=function(t){return f(t)&&(t.hasAttribute("data-cs-capture")||this.elementMatchesWhitelistedSelectors(t))},e.prototype.isStyleOrWhitelistedElement=function(t){return g(t)||this.isWhitelistedElement(t)},e.prototype.elementMatchesWhitelistedSelectors=function(t){return!!this.whitelistedElementsSelector&&T().call(t,this.whitelistedElementsSelector)},e}(xe),Ge=function(){function t(t){this.prefixStorageName=t;var e=csString.prototype.slice.call(""+Math.random(),2,8);this.storageName=""+this.prefixStorageName+e}return t.prototype.save=function(t){localStorage.setItem(this.storageName,csJSON.stringify(t))},t.prototype.recover=function(){var t=this,e=0,r=[];return csArray.prototype.forEach.call(this.getStorageKeys(),(function(n){var i=localStorage.getItem(n);if(null!==i){e+=i.length;var o=t.parseStoredItem(i,n);o&&csArray.prototype.push.call(r,o),t.removeItem(n)}})),{rawBatches:r,recoveredSize:e}},t.prototype.getStorageKeys=function(){for(var t=[],e=0;e<localStorage.length;e+=1){var r=localStorage.key(e);r&&V(r,this.prefixStorageName)&&csArray.prototype.push.call(t,r)}return t},t.prototype.removeItem=function(t){localStorage.removeItem(t)},t.prototype.parseStoredItem=function(t,e){try{return csJSON.parse(t)}catch(r){return Pt.error("Invalid item in localStorage.(key:"+e+"; value:"+t+")"),null}},t}(),We=function(){return(We=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Xe=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.requestParametersProviders=t}return t.prototype.addProvider=function(t){csArray.prototype.push.call(this.requestParametersProviders,t)},t.prototype.getRequestParameters=function(){return csArray.prototype.reduce.call(this.requestParametersProviders,(function(t,e){return We(We({},e.getRequestParameters()),t)}),{})},t}(),Ke=function(){function t(t){this.asyncTaskFactory=t,this.userActive=!1,this.pendingInactivity=null}return t.prototype.start=function(){this.userActive=!0,this.createPendingInactivity()},t.prototype.stop=function(){this.userActive=!1,this.clearPendingInactivity()},t.prototype.trackActivity=function(){this.userActive||(this.userActive=!0,this.onActivityResumedCallback()),this.clearPendingInactivity(),this.createPendingInactivity()},t.prototype.createPendingInactivity=function(){var t=this;this.pendingInactivity=this.asyncTaskFactory.create("recorded user inactive",(function(){t.userActive=!1,t.clearPendingInactivity(),t.onActivityStoppedCallback()}),5e3)},t.prototype.clearPendingInactivity=function(){null!==this.pendingInactivity&&(this.pendingInactivity.cancel(),this.pendingInactivity=null)},t.prototype.isUserActive=function(){return this.userActive},t.prototype.onActivityStopped=function(t){this.onActivityStoppedCallback=t},t.prototype.onActivityResumed=function(t){this.onActivityResumedCallback=t},t}(),Ye=function(){function t(t,e,r){var n=this;this.taskName=t,this.task=e,this.timeout=r,this.timeoutId=setTimeout((function(){n.execute()}),this.timeout)}return t.prototype.execute=function(){var t=this;Pt.tryToExecute(this.taskName,(function(){t.task()}))()},t.prototype.cancel=function(){clearTimeout(this.timeoutId)},t}(),Je=function(){function t(){}return t.prototype.create=function(t,e,r){return new Ye(t,e,r)},t}();!function(t){function e(){var t=[n()];return document.documentElement&&csArray.prototype.push.call(t,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),document.body&&csArray.prototype.push.call(t,document.body.scrollHeight,document.body.offsetHeight),Math.max.apply(Math,t)}function r(){return document.documentElement.scrollWidth}function n(){return window.innerHeight}function i(){return window.innerWidth}function o(){return screen.width}function s(){return screen.height}t.documentHeight=e,t.documentWidth=r,t.windowHeight=n,t.windowWidth=i,t.screenWidth=o,t.screenHeight=s,t.windowOffsetX=function(){return window.pageXOffset},t.windowOffsetY=function(){return window.pageYOffset},t.getRequestParameters=function(){return{dw:""+r(),dh:""+e(),ww:""+i(),wh:""+n(),sw:""+o(),sh:""+s()}}}(Le||(Le={}));var Qe=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Ze=function(){function t(t,e){var r=this;this.location=t,this.pii=e,this.eventHandlers=[{boundElement:window,type:"resize",listener:function(){return r.resizeListener()}},{boundElement:window,type:"hashchange",listener:function(){return r.hashChangeListener()}},{boundElement:window,type:"mousemove",listener:function(t){return r.mouseMoveListener(t)}},{boundElement:document,type:"visibilitychange",listener:function(){return r.visibilityChangeListener()}}]}return t.prototype.onEvent=function(t){this.onEventCallback=function(e){e.date=B.now(),t(e)}},t.prototype.start=function(){this.bindHandlers(),this.triggerInitialEvents()},t.prototype.stop=function(){this.unbindHandlers()},t.prototype.bindHandlers=function(){csArray.prototype.forEach.call(this.eventHandlers,(function(t){return ie(t)}))},t.prototype.unbindHandlers=function(){csArray.prototype.forEach.call(this.eventHandlers,(function(t){return oe(t)}))},t.prototype.triggerInitialEvents=function(){this.resizeListener(),this.hashChangeListener()},t.prototype.resizeListener=function(){this.onEventCallback({type:Qt.RESIZE,args:[Le.windowWidth(),Le.windowHeight()]})},t.prototype.hashChangeListener=function(){this.onEventCallback({type:Qt.HASH_CHANGE,args:[this.pii.anonymize(this.location.href)]})},t.prototype.visibilityChangeListener=function(){this.onEventCallback({type:Qt.VISIBILITY_CHANGE,args:[document.visibilityState]})},t.prototype.mouseMoveListener=function(t){this.onEventCallback({type:Qt.MOUSE_MOVE,args:[t.clientX,t.clientY]})},Qe([_t("resize")],t.prototype,"resizeListener",null),Qe([_t("hashChange")],t.prototype,"hashChangeListener",null),Qe([_t("visibilityChange")],t.prototype,"visibilityChangeListener",null),Qe([_t("mouseMove")],t.prototype,"mouseMoveListener",null),t}(),$e=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tr=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.recordingPageEventsTracker=e,s.recordingMutationsTracker=r,s.recordingActivityTracker=n,s.recordingRequest=i,s.mutationSerializer=o,s.recordingRequestDuringInactivityCount=0,s.isMutationTrackerStopped=!1,s}return $e(e,t),e.prototype.init=function(){var t=this;this.recordingPageEventsTracker.onEvent((function(){t.recordingActivityTracker.trackActivity(),t.recordingRequestDuringInactivityCount=0})),this.recordingRequest.after((function(){t.recordingRequestDuringInactivityCount+=1,t.stopMutationTrackerIfNeeded()})),this.recordingActivityTracker.onActivityStopped((function(){t.stopMutationTrackerIfNeeded()})),this.recordingActivityTracker.onActivityResumed((function(){t.isMutationTrackerStopped&&(t.recordingMutationsTracker.start(),t.isMutationTrackerStopped=!1)}))},e.prototype.onStart=function(){this.recordingActivityTracker.start()},e.prototype.onStop=function(){this.recordingActivityTracker.stop()},e.prototype.stopMutationTrackerIfNeeded=function(){!this.isMutationTrackerStopped&&!this.mutationSerializer.isSerializationInProgress()&&!this.recordingActivityTracker.isUserActive()&&this.recordingRequestDuringInactivityCount>=2&&(this.recordingMutationsTracker.stop(),this.isMutationTrackerStopped=!0)},e}(me),er=r(1),rr=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};function nr(t){var e=csString.prototype.trim.call(t);if(""===t)return[];var r,n=(r=e,csString.prototype.split.call(r,/\s(.+)/)),i=n[0],o=n[1];return o?(q(i,",")||(o=function(t){return csString.prototype.split.call(t,/,(.+)/)[1]||""}(o)),rr([ir(i)],nr(o))):[ir(i)]}function ir(t){return csString.prototype.split.call(t,/,$/)[0]}var or,sr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return sr(e,t),e.prototype.onEvent=function(t){this.onEventCallback=t},e.prototype.serializeElementNode=function(t,e,r){return this.scanElement(t),e},e.prototype.beforeSerializeChildren=function(t,e,r){return this.scanStyleElement(t,e),e},e.prototype.scanElement=function(t){this.scanElementAttributes(t)},e.prototype.scanAttribute=function(t,e){this.scanElementAttributes(t,e)},e.prototype.scanText=function(t){d(t)&&csNodeparentNode.apply(t)&&g(csNodeparentNode.apply(t))&&this.scanCssString(t.data)},e.prototype.scanStyleElement=function(t,e){if(g(t))for(var r=0,n=e;r<n.length;r++){var i=n[r];d(i)&&this.scanCssString(i.data)}},e.prototype.scanElementAttributes=function(t,e){this.scanCssLink(t,e),this.scanImage(t,e),this.scanStyleAttribute(t,e)},e.prototype.scanCssLink=function(t,e){!y(t)||e&&"href"!==e||!t.href||this.onStaticResourceUrl(t.href)},e.prototype.scanImage=function(t,e){v(t)&&(e&&"src"!==e||!t.src||this.isDataUrl(t.src)||null===t.getAttribute("src")||this.isHashStartUrl(t.getAttribute("src"))||this.onStaticResourceUrl(t.src),e&&"srcset"!==e||!t.srcset||this.scanSrcset(t.srcset))},e.prototype.scanStyleAttribute=function(t,e){if((!e||"style"===e)&&t.hasAttribute("style")){var r=t.getAttribute("style");if("string"!=typeof r)throw new Error("Unexpected style: "+t.outerHTML);this.scanCssString(r)}},e.prototype.isHashStartUrl=function(t){return V(t,"#")},e.prototype.isDataUrl=function(t){return V(t,"data:")},e.prototype.scanCssString=function(t){this.processRawUrls(Object(er.extractFrom)(t))},e.prototype.scanSrcset=function(t){this.processRawUrls(nr(t))},e.prototype.processRawUrls=function(t){var e=this;return csArray.prototype.forEach.call(csArray.prototype.map.call(csArray.prototype.filter.call(csArray.prototype.filter.call(t,(function(t){return!e.isDataUrl(t)})),(function(t){return!e.isHashStartUrl(t)})),(function(t){return at(t)})),(function(t){return e.onStaticResourceUrl(t)}))},e.prototype.onStaticResourceUrl=function(t){this.onEventCallback({date:B.now(),type:Qt.STATIC_RESOURCE_URL,args:[t]})},e}(xe);!function(t){t.REQUEST_START="requestStart",t.DOM_INTERACTIVE="domInteractive"}(or||(or={}));var cr,ur=function(){function t(t){this.windowPerformance=t.performance}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.areTimingsAvailable()&&this.recordPerformanceTimings()},t.prototype.recordPerformanceTimings=function(){var t=this.getPerformanceTimings();this.onEventCallback({args:t,date:B.now(),type:Qt.PERFORMANCE_TIMINGS})},t.prototype.areTimingsAvailable=function(){return!(!this.windowPerformance||!this.windowPerformance.timing)},t.prototype.getPerformanceTimings=function(){return[{performanceTiming:or.REQUEST_START,timestamp:this.windowPerformance.timing.requestStart},{performanceTiming:or.DOM_INTERACTIVE,timestamp:this.windowPerformance.timing.domInteractive}]},t}(),pr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lr=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},hr=function(t){function e(e,r){var n=t.call(this)||this;return n.monkeyPatcher=e,n.nodeIdentifier=r,n}return pr(e,t),e.prototype.init=function(){this.initInterceptors(),this.initSubscribers(),this.initMutationObserver()},e.prototype.initMutationObserver=function(){var t=this;this.observer=new csMutationObserver((function(e){t.handleMutations(e)}))},e.prototype.initInterceptors=function(){var t=this;this.supportAttachShadow()&&(this.attachShadowInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:Element.prototype,methodName:"attachShadow",hook:function(e){var r=e.context,n=e.result;return t.handleAttachShadow(r,n)}})),this.supportCreateShadowRoot()&&(this.createShadowRootInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:Element.prototype,methodName:"createShadowRoot",hook:function(e){var r=e.context,n=e.result;return t.handleAttachShadow(r,n)}}))},e.prototype.initSubscribers=function(){var t=this;this.nodeIdentifier.onIdentifierAdded((function(e){E(e)&&t.observe(e)}))},e.prototype.onChildListMutation=function(t){this.childListMutationCallback=t},e.prototype.onCharacterDataMutation=function(t){this.characterDataMutationCallback=t},e.prototype.onAttributesMutation=function(t){this.attributesMutationCallback=t},e.prototype.onAttachShadowMutation=function(t){this.attachShadowMutationCallback=t},e.prototype.observe=function(t){this.isStarted&&this.observer.observe(t,{subtree:!0,attributes:!0,childList:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0})},e.prototype.onStart=function(){this.attachShadowInterceptor&&this.attachShadowInterceptor.activate(),this.createShadowRootInterceptor&&this.createShadowRootInterceptor.activate()},e.prototype.onStop=function(){this.attachShadowInterceptor&&this.attachShadowInterceptor.deactivate(),this.createShadowRootInterceptor&&this.createShadowRootInterceptor.deactivate(),this.observer.disconnect()},e.prototype.supportAttachShadow=function(){return window.Element&&window.Element.prototype&&"function"==typeof window.Element.prototype.attachShadow},e.prototype.supportCreateShadowRoot=function(){return window.Element&&window.Element.prototype&&"function"==typeof window.Element.prototype.createShadowRoot},e.prototype.handleMutations=function(t){for(var e=B.now(),r=0;r<t.length;r+=1){var n=t[r];switch(n.date=e,n.type){case"attributes":this.attributesMutationCallback(n);break;case"characterData":this.characterDataMutationCallback(n);break;case"childList":this.childListMutationCallback(n);break;default:throw new Error("mutation type is not supported")}}},e.prototype.handleAttachShadow=function(t,e){this.attachShadowMutationCallback({shadowRoot:e,date:B.now(),target:t})},lr([_t("mutations")],e.prototype,"handleMutations",null),e}(me),fr=function(){return(fr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},dr=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};!function(t){t[t.WebElement=0]="WebElement",t[t.MobileView=1]="MobileView",t[t.WebViewContainer=2]="WebViewContainer"}(cr||(cr={}));var yr=function(){function t(t){this.processors=t}return t.prototype.serialize=function(t,e){void 0===e&&(e={});var r,n=fr({},e),i=t.nodeType,o=csArray.prototype.reduce.call(this.processors,(function(t,e){return e.beforeSerialize(t,n)}),t);switch(i){case Node.ELEMENT_NODE:r=this.serializeElementNode(o,n);break;case Node.TEXT_NODE:r=this.serializeTextNode(o,n);break;case Node.CDATA_SECTION_NODE:r=this.serializeCDATASectionNode(o,n);break;case Node.COMMENT_NODE:r=this.serializeCommentNode(o,n);break;case Node.DOCUMENT_TYPE_NODE:r=this.serializeDoctypeNode(o,n);break;case Node.DOCUMENT_NODE:r=this.serializeDocumentNode(o,n);break;case Node.DOCUMENT_FRAGMENT_NODE:r=this.serializeDocumentFragmentNode(o,n);break;default:throw new Error("serialization is not supported (nodeType: "+i+")")}return r=csArray.prototype.reduce.call(this.processors,(function(t,e){return e.afterSerialize(o,t,n)}),r)},t.prototype.serializeElementNode=function(t,e){var r,n=csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeElementNode(t,i,e)}),{attributes:[]});(r=csArray.prototype.push).call.apply(r,dr([n.attributes],this.serializeAttributes(t,e)));var i=csElementshadowRoot.apply(t);return i&&(n.shadowRoot=this.serializeShadowRootNode(i,e)),n.children=this.serializeChildren(t,e),n},t.prototype.serializeAttributes=function(t,e){var r=this,n=C(t.attributes);return csArray.prototype.map.call(csArray.prototype.reduce.call(this.processors,(function(r,n){return n.beforeSerializeAttributes(t,r,e)}),n),(function(n){return r.serializeAttribute(t,n,e)}))},t.prototype.serializeAttribute=function(t,e,r){return csArray.prototype.reduce.call(this.processors,(function(n,i){return i.serializeAttribute(t,e,n,r)}),{})},t.prototype.runBeforeSerializeChildrenHook=function(t,e){var r=C(csNodechildNodes.apply(t));return csArray.prototype.reduce.call(this.processors,(function(r,n){return n.beforeSerializeChildren(t,r,e)}),r)},t.prototype.serializeChildren=function(t,e){var r=this;if(e.skipChildrenSerialization)return[];var n=this.runBeforeSerializeChildrenHook(t,e);return csArray.prototype.map.call(n,(function(t){return r.serialize(t,e)}))},t.prototype.serializeTextNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeTextNode(t,i,e)}),{})},t.prototype.serializeCDATASectionNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeCDATASectionNode(t,i,e)}),{})},t.prototype.serializeCommentNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeCommentNode(t,i,e)}),{})},t.prototype.serializeDoctypeNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeDoctypeNode(t,i,e)}),{})},t.prototype.serializeDocumentNode=function(t,e){var r=csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeDocumentNode(t,i,e)}),{});return r.children=this.serializeChildren(t,e),r},t.prototype.serializeShadowRootNode=function(t,e){var r=csArray.prototype.reduce.call(this.processors,(function(r,n){var i=n.serializeNode(t,r,e);return n.serializeShadowRootNode(t,i,e)}),{});return r.children=this.serializeChildren(t,e),r=csArray.prototype.reduce.call(this.processors,(function(r,n){return n.afterSerializeShadowRoot(t,r,e)}),r)},t.prototype.serializeDocumentFragmentNode=function(t,e){if(t.mode)return this.serializeShadowRootNode(t,e);throw new Error("Not implemented yet.")},t}(),vr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return vr(e,t),e.prototype.beforeSerializeChildren=function(t,e){if(g(t)){var r=this.cssRules(t);this.isEmptyStyleElementWithRules(t,r)&&csArray.prototype.push.call(e,this.createTextNodeFromRules(r))}return e},e.prototype.cssRules=function(t){try{var e=t.sheet;if(!e)return;return e.cssRules||e.rules}catch(t){if("SecurityError"!==t.name&&"InvalidAccessError"!==t.name)throw t;return}},e.prototype.isEmptyStyleElementWithRules=function(t,e){var r=t.textContent||"";return/^\s*$/.test(r)&&void 0!==e&&0!==e.length},e.prototype.createTextNodeFromRules=function(t){var e=csArray.prototype.join.call(csArray.prototype.map.call(C(t),(function(t){return t.cssText})),"");return document.createTextNode(e)},e.prototype.serializeNode=function(t,e){return e.nodeType=t.nodeType,e.format=cr.WebElement,e},e.prototype.serializeElementNode=function(t,e){return e.localName=t.localName,e.namespaceURI=t.namespaceURI,e},e.prototype.serializeAttribute=function(t,e,r){return r.name=e.name,r.value=e.value,r.namespaceURI=null!==e.namespaceURI?e.namespaceURI:"",r},e.prototype.serializeTextNode=function(t,e){return e.data=t.data,e},e.prototype.serializeCDATASectionNode=function(t,e){return e.data=t.data,e},e.prototype.serializeCommentNode=function(t,e){return e.data=t.data,e},e.prototype.serializeDoctypeNode=function(t,e){return e.name=t.name,e.publicId=t.publicId,e.systemId=t.systemId,e},e.prototype.serializeDocumentNode=function(t,r){return r.baseURI=e.getBaseURI(t),r},e.prototype.serializeShadowRootNode=function(t,e){return e.mode=t.mode,e},e.getBaseURI=function(t){var e=t.baseURI;if(null==e){var r=t.getElementsByTagName("base");e=0!==r.length?r[0].href:t.URL}return e},e}(xe);function mr(t){return"csId"in t}function Sr(t){return mr(t)&&"children"in t}function Er(t){return Sr(t)&&"attributes"in t&&"localName"in t&&"namespaceURI"in t}var br=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},wr=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};function Cr(){return br(this,void 0,void 0,(function(){return wr(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){setTimeout((function(){t()}),0)}))];case 1:return t.sent(),[2]}}))}))}var Tr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rr=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Ar=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},kr=function(t){function e(e,r,n){var i=t.call(this,r)||this;return i.nodeIdentifierService=e,i.asyncSerializerOptions=n,i.init(),i}return Tr(e,t),e.prototype.init=function(){this.taskTime=this.asyncSerializerOptions.taskTime},e.prototype.getTaskTime=function(){return this.taskTime},e.prototype.updateAttribute=function(t,e){if(t){var r=t[0],n=t[1],i=t[2],o=t[3],s=this.nodeIdentifierService.getNodeFromMap(r);if(s&&Er(s)){s.attributes||(s.attributes=[]);var a=csArray.prototype.findIndex.call(s.attributes,(function(t){return t.name===i}));a>-1?s.attributes[a].value=o:csArray.prototype.push.call(s.attributes,{anonymized:e,namespaceURI:n,name:i,value:o})}}},e.prototype.updateTextNode=function(t){if(t){var e,r=t[0],n=t[1],i=this.nodeIdentifierService.getNodeFromMap(r);i&&(mr(e=i)&&"data"in e)&&(i.data=n)}},e.prototype.updateChildren=function(t,e){var r=this,n=e.addedNodes,i=e.removedNodes,o=this.nodeIdentifierService.getNodeFromMap(t);o&&Er(o)&&(o.children||(o.children=[]),csArray.prototype.forEach.call(n,(function(t){var e=t[1],r=t[2],n=csArray.prototype.findIndex.call(o.children,(function(t){return t.csId===e}));n>-1?csArray.prototype.splice.call(o.children,n,0,r):csArray.prototype.push.call(o.children,r)})),csArray.prototype.forEach.call(i,(function(t){t.forEach((function(t){return r.removeNodeFromMap(o,t)}))})))},e.prototype.removeNodeFromMap=function(t,e){if(null==t?void 0:t.children){var r=csArray.prototype.findIndex.call(t.children,(function(t){return t.csId===e}));-1!==r&&csArray.prototype.splice.call(t.children,r,1)}this.nodeIdentifierService.deleteNode(e)},e.prototype.startSerializeAsync=function(t,e){return void 0===e&&(e={}),Rr(this,void 0,void 0,(function(){return Ar(this,(function(r){return this.nodeIdentifierService.clearMap(),this.nodeIdentifierService.setDefaultSerializationOptions(e),this.nodeIdentifierService.popId(t),[2,this.traverseAndSerialize(t,e)]}))}))},e.prototype.indexInParent=function(t,e){return e?csArray.prototype.indexOf.call(csNodechildNodes.apply(e),t):-1},e.prototype.serializeAndAddToParent=function(t,e,r){var n=this.nodeIdentifierService.getNodeFromMapByNode(e),i=this.serialize(t,r),o=this.indexInParent(t,e);n&&Sr(n)&&mr(i)&&(o>=0?csArray.prototype.splice.call(n.children,o,0,i):csArray.prototype.push.call(n.children,i))},e.prototype.traverseAndSerialize=function(t,e){return void 0===e&&(e={}),Rr(this,void 0,void 0,(function(){var r,n,i,o,s,a,c;return Ar(this,(function(u){switch(u.label){case 0:return e.skipChildrenSerialization=!0,r=[t],n=this.getTaskTime(),[4,Cr()];case 1:u.sent(),this.timer=csDate.now(),this.serialize(t,e),u.label=2;case 2:if(!(r.length>0))return[3,7];i=csArray.prototype.pop.call(r),o=this.nodeIdentifierService.getOptionsFromMap(i),s=this.runBeforeSerializeChildrenHook(i,o),a=csArray.prototype.shift.call(s),u.label=3;case 3:return a?csDate.now()-this.timer>n?[4,Cr()]:[3,5]:[3,6];case 4:u.sent(),this.timer=csDate.now(),u.label=5;case 5:return this.nodeIdentifierService.getId(a)?(a=csArray.prototype.shift.call(s),[3,3]):(csArray.prototype.push.call(r,a),this.serializeAndAddToParent(a,i,o),f(a)&&csElementshadowRoot.apply(a)&&(c=csElementshadowRoot.apply(a),csArray.prototype.push.call(r,c)),a=csArray.prototype.shift.call(s),[3,3]);case 6:return[3,2];case 7:return[2,this.nodeIdentifierService.getNodeFromMapByNode(t)]}}))}))},e}(yr),Ir=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pr=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},_r=function(t){function e(e,r){return t.call(this,e,Pr([new gr,e],r),{taskTime:25})||this}return Ir(e,t),e}(kr);function Or(){var t,e=(t=new Error).stack?csArray.prototype.filter.call(csString.prototype.split.call(t.stack,"\n"),(function(t){return"Error"!==t&&-1===csString.prototype.indexOf.call(csString.prototype.toLowerCase.call(t),"promise ")&&-1===csString.prototype.indexOf.call(t,"[native code]")})):[];if(0===e.length)return"";var r=function(t){return t.length>0?Nr(t[0]):""}(e);return""===r||0===(e=function(t,e){return csArray.prototype.filter.call(t,(function(t){return-1===csString.prototype.indexOf.call(t,e)}))}(e,r)).length?"":Nr(e[0])}function Nr(t){var e,r="";e=t;var n=(-1!==csString.prototype.indexOf.call(e,"@")?new RegExp("@(.+):(\\d+):(\\d+)$"):new RegExp("\\((.+):(\\d+):(\\d+)\\)")).exec(t);return n&&(r=n[1]),r}var xr,Mr=function(){return(Mr=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Lr=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Dr=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Vr=function(){function t(){this.defaultHookPrepareArgs=function(t,e){return{context:t,args:e}}}return t.prototype.copyFunctionSignature=function(t,e){t.prototype=e.prototype,Object.defineProperty(t,"toString",{value:function(){return e.toString()}})},t.prototype.createSyncFunctionInterceptor=function(t){var e,r=t.target,n=t.methodName,i=t.hook,o=t.hookPrepareArgs,s=void 0===o?this.defaultHookPrepareArgs:o,a=t.options;if(!(null===(e=Object.getOwnPropertyDescriptor(r,n))||void 0===e?void 0:e.writable))return Pt.warn("Cannot intercept read only function '"+n+"' of object '"+r+"'"),null;var c=!1,u=r[n];if("function"==typeof u){var p=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,n=s(this,t),o=u.apply(this,t);c&&(a&&a.withCallerName&&(r=Or()),Pt.tryToExecute("SyncFunctionInterceptor",(function(){i(Mr(Mr({result:o},n),{callerName:r}))}))());return o};this.copyFunctionSignature(p,u),r[n]=p}return{activate:function(){return c=!0},deactivate:function(){return c=!1}}},t.prototype.createAsyncFunctionInterceptor=function(t){var e,r=t.target,n=t.methodName,i=t.hook,o=t.hookPrepareArgs,s=void 0===o?this.defaultHookPrepareArgs:o,a=t.options;if(!(null===(e=Object.getOwnPropertyDescriptor(r,n))||void 0===e?void 0:e.writable))return Pt.warn("Cannot intercept read only function '"+n+"' of object '"+r+"'"),null;var c=!1,u=r[n];if("function"==typeof u){var p=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Lr(this,void 0,void 0,(function(){var e,r,n;return Dr(this,(function(o){return e=s(this,t),r=u.apply(this,t),c&&(a&&a.withCallerName&&(n=Or()),Pt.tryToExecute("AsyncFunctionInterceptor",(function(){i(Mr(Mr({result:r},e),{callerName:n}))}))()),[2,r]}))}))};this.copyFunctionSignature(p,u),r[n]=p}return{activate:function(){return c=!0},deactivate:function(){return c=!1}}},t.prototype.createDescriptorInterceptor=function(t,e,r){var n=!1,i=Object.getOwnPropertyDescriptor(t,e);if(i){if(!i.configurable)return Pt.warn("Cannot intercept read only property '"+e+"' of object '"+t+"'"),null;Object.defineProperty(t,e,Mr(Mr({},i.get?{get:function(){return i.get.apply(this,arguments)}}:{}),i.set?{set:function(){var t=this,e=arguments,o=i.set.apply(this,e);return n&&Pt.tryToExecute("DescriptorInterceptor",(function(){r(t,e[0])}))(),o}}:{}))}return{activate:function(){return n=!0},deactivate:function(){return n=!1}}},t}(),qr=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};!function(t){function e(t){var e=t.getBoundingClientRect(),r=e.left+.5*e.width,n=e.top+.5*e.height,i=document.elementFromPoint(r,n);return Ae.getShadowRoot(i)?t.getRootNode().elementFromPoint(r,n):i}t.findAllElements=function(t,e){var r;void 0===e&&(e=document);for(var n=C(e.querySelectorAll(t)),i=0,o=Ae.findNestedShadowHosts(e);i<o.length;i++){var s=o[i],a=C(csElementshadowRoot.apply(s).querySelectorAll(t));(r=csArray.prototype.push).call.apply(r,qr([n],a))}return n},t.getTopElement=e,t.isVisibleInDocument=function(t){return!function(t){var e=t.getBoundingClientRect();return e.right+Le.windowOffsetX()<0||e.bottom+Le.windowOffsetY()<0}(t)&&!function(t){var e,r=window.getComputedStyle(t);return 0===t.getClientRects().length||"hidden"===r.visibility||"collapse"===r.visibility||"0"===r.opacity||"opacity(0)"===r.filter||(e=r.color,/^rgba\(\d+, \d+, \d+, 0\)$/.test(e))}(t)&&!function(t){var r=e(t);return!t.contains(r)&&null!==r}(t)},t.isInViewPort=function(t){return null!==e(t)}}(xr||(xr={}));var Ur=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zr=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},jr=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.configuration=e,o.nodeIdentifier=r,o.textVisibilityBatch=n,o.textVisibilityDelay=i,o.isStarted=!1,o.seenInViewPort=new Set,o.seenGlobally=new Set,o}return Ur(e,t),e.prototype.onEvent=function(t){this.onEventCallback=t},e.prototype.start=function(){var t=this;this.isStarted||this.configuration.textVisibilityEnabled&&window.IntersectionObserver&&(this.intersectionObserver=new IntersectionObserver((function(e,r){t.handleIntersection(e,r)}),e.INTERSECTION_OPTIONS),this.mutationObserver=new csMutationObserver((function(e){t.handleMutations(e)})),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(this.textVisibilityBatch.clear(),this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.seenInViewPort.clear(),this.seenGlobally.clear(),this.isStarted=!1)},e.prototype.flushEvents=function(){this.isStarted&&this.onTextVisibility()},e.prototype.serializeTextNode=function(t,e,r){if(!this.isStarted||r.withAnonymization)return e;var n=csString.prototype.trim.call(t.data),i=t.parentElement;if(""!==n&&i&&!g(i)&&!S(i)){if(!xr.isVisibleInDocument(i))return this.observeMutation(i),this.observeIntersection(i),e;var o=xr.isInViewPort(i);o||this.observeIntersection(i),this.processTextVisibilityFromSerialization(i,o)}return e},e.prototype.observeIntersection=function(t){this.intersectionObserver.observe(t)},e.prototype.observeMutation=function(t){this.mutationObserver.observe(t,{attributeFilter:e.MUTATION_ATTRIBUTE_FILTER})},e.prototype.processTextVisibilityAfterDelay=function(t,e,r){xr.isVisibleInDocument(t)&&(this.pushIdSeenGlobally(e),xr.isInViewPort(t)&&r&&(this.pushIdSeenInViewPort(e),this.intersectionObserver.unobserve(t)),this.textVisibilityBatch.isFull()&&this.onTextVisibility())},e.prototype.processTextVisibilityFromSerialization=function(t,e){var r=this;this.nodeIdentifier.ifIdentified(t,(function(n){r.seenInViewPort.has(n)||setTimeout((function(){r.processTextVisibilityAfterDelay(t,n,e),r.seenGlobally.has(n)||r.observeMutation(t),!r.seenInViewPort.has(n)&&e&&r.observeIntersection(t)}),r.textVisibilityDelay)}))},e.prototype.processTextVisibilityFromMutation=function(t){var e=this;this.nodeIdentifier.ifIdentified(t,(function(r){e.seenInViewPort.has(r)||e.processTextVisibility(t,r)}))},e.prototype.processTextVisibilityFromIntersection=function(t,e){var r=this;this.nodeIdentifier.ifIdentified(t,(function(n){r.seenInViewPort.has(n)?e.unobserve(t):r.processTextVisibility(t,n)}))},e.prototype.processTextVisibility=function(t,e){var r=this,n=this.isVisibleInViewPort(t);setTimeout((function(){return r.processTextVisibilityAfterDelay(t,e,n)}),this.textVisibilityDelay)},e.prototype.handleMutations=function(t){var r=this;csArray.prototype.forEach.call(t,(function(t){var n=t.attributeName;n&&-1!==csArray.prototype.indexOf.call(e.MUTATION_ATTRIBUTE_FILTER,n)&&r.processTextVisibilityFromMutation(t.target)}))},e.prototype.handleIntersection=function(t,e){var r=this;csArray.prototype.forEach.call(t,(function(t){t.isIntersecting&&r.processTextVisibilityFromIntersection(t.target,e)}))},e.prototype.isVisibleInViewPort=function(t){return xr.isVisibleInDocument(t)&&xr.isInViewPort(t)},e.prototype.pushIdSeenInViewPort=function(t){this.seenInViewPort.has(t)||(this.seenInViewPort.add(t),this.textVisibilityBatch.addIdInViewPort(t))},e.prototype.pushIdSeenGlobally=function(t){this.seenGlobally.has(t)||(this.seenGlobally.add(t),this.textVisibilityBatch.addIdInGlobally(t))},e.prototype.onTextVisibility=function(){if(!this.textVisibilityBatch.isEmpty()){var t={visibleGlobally:this.textVisibilityBatch.flushIdsSeenGlobally(),visibleInViewPort:this.textVisibilityBatch.flushIdsSeenInViewport()};this.onEventCallback({type:Qt.TEXT_VISIBILITY,date:B.now(),args:[t]})}},e.INTERSECTION_OPTIONS={root:null,rootMargin:"0px",threshold:.5},e.MUTATION_ATTRIBUTE_FILTER=["style","class","hidden"],zr([_t("TextVisibilityTracker.processTextVisibilityAfterDelay")],e.prototype,"processTextVisibilityAfterDelay",null),zr([_t("TextVisibilityTracker.processTextVisibilityFromSerialization")],e.prototype,"processTextVisibilityFromSerialization",null),zr([_t("TextVisibilityTracker.processTextVisibilityFromMutation")],e.prototype,"processTextVisibilityFromMutation",null),zr([_t("TextVisibilityTracker.processTextVisibilityFromIntersection")],e.prototype,"processTextVisibilityFromIntersection",null),zr([_t("TextVisibilityTracker.handleMutations")],e.prototype,"handleMutations",null),zr([_t("TextVisibilityTracker.handleIntersection")],e.prototype,"handleIntersection",null),e}(xe),Br=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},Hr=function(){function t(){this.seenGloballyBuffer=[],this.seenInViewPortBuffer=[]}return t.prototype.isFull=function(){return this.seenGloballyBuffer.length>=t.BATCH_SIZE||this.seenInViewPortBuffer.length>=t.BATCH_SIZE},t.prototype.isEmpty=function(){return 0===this.seenGloballyBuffer.length&&0===this.seenInViewPortBuffer.length},t.prototype.addIdInGlobally=function(t){csArray.prototype.push.call(this.seenGloballyBuffer,t)},t.prototype.addIdInViewPort=function(t){csArray.prototype.push.call(this.seenInViewPortBuffer,t)},t.prototype.clear=function(){this.seenGloballyBuffer=[],this.seenInViewPortBuffer=[]},t.prototype.flushIdsSeenGlobally=function(){var t=Br(this.seenGloballyBuffer);return this.seenGloballyBuffer=[],t},t.prototype.flushIdsSeenInViewport=function(){var t=Br(this.seenInViewPortBuffer);return this.seenInViewPortBuffer=[],t},t.BATCH_SIZE=20,t}();function Fr(t){for(var e=new Uint8Array(t),r="",n=0;n<e.byteLength;n+=1)r+=csString.fromCodePoint(e[n]);return r}function Gr(t){return function(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0,i=t.length;n<i;n+=1)r[n]=csString.prototype.charCodeAt.call(t,n);return e}(window.atob(t))}var Wr=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Xr=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Kr=function(){function t(t){this.crypto=t,this.isEncryptionSupported=!1}return t.prototype.init=function(){this.isEncryptionSupported=this.canSupportEncryption(),this.isEncryptionSupported&&(this.textEncoder=new TextEncoder)},t.prototype.isSupported=function(){return this.isEncryptionSupported},t.prototype.importKey=function(t){return Wr(this,void 0,void 0,(function(){return Xr(this,(function(e){if(!this.isEncryptionSupported)return[2,null];try{return[2,this.crypto.subtle.importKey("spki",Gr(t),{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"])]}catch(t){return[2,null]}return[2]}))}))},t.prototype.encrypt=function(t,e){return Wr(this,void 0,void 0,(function(){var r;return Xr(this,(function(n){switch(n.label){case 0:if(!this.isEncryptionSupported)return[2,null];r=this.truncateAndEncode(e,190),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.crypto.subtle.encrypt({name:"RSA-OAEP"},t,r)];case 2:return[2,Fr(n.sent())];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.canSupportEncryption=function(){return!!this.crypto&&!!this.crypto.subtle&&!!this.crypto.subtle.importKey&&!!this.crypto.subtle.encrypt&&"CryptoKey"in window&&"TextEncoder"in window&&!!csString.fromCodePoint},t.prototype.truncateAndEncode=function(t,e){for(var r=csString.prototype.slice.call(t,0,e),n=this.textEncoder.encode(r);n.byteLength>e;){var i=csString.prototype.slice.call(r,-1),o=this.textEncoder.encode(i).byteLength;n=n.slice(0,-o),r=csString.prototype.slice.call(r,0,-1)}return n},t}(),Yr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jr=function(t){function e(e){var r=t.call(this)||this;return r.encryptionService=e,r}return Yr(e,t),e.prototype.serializeTextNode=function(t,e){var r;return(null===(r=t.parentElement)||void 0===r?void 0:r.hasAttribute("data-cs-encrypt"))&&(e.data=Re(t.data),this.encryptionService.registerTextNodeToEncrypt({textNode:t,serializedTextData:e.data})),e},e}(xe),Qr=function(){function t(){this.nodesToEncryptBuffer=[]}return t.prototype.onSerializeNode=function(t){this.onSerializeNodeCallback=t},t.prototype.addNewNode=function(t){csArray.prototype.push.call(this.nodesToEncryptBuffer,t)},t.prototype.serializeNodesFromBuffer=function(){for(;this.nodesToEncryptBuffer.length>0;){var t=csArray.prototype.shift.call(this.nodesToEncryptBuffer);this.onSerializeNodeCallback(t)}},t.prototype.clear=function(){this.nodesToEncryptBuffer=[]},t}(),Zr=function(){function t(t,e,r,n,i,o,s,a,c,u,p,l,h,f,d,y,v,g){this.sessionService=t,this.configuration=e,this.compressor=r,this.selector=n,this.consentService=i,this.basicParameters=o,this.commandsService=s,this.pii=a,this.sessionRenewer=c,this.urlService=u,this.piiMaskingService=p,this.javaScriptErrorsTracker=l,this.javaScriptErrorsAnonymizer=h,this.apiErrorsTracker=f,this.apiErrorsAnonymizer=d,this.debugService=y,this.lifeCycleEventsEmitter=v,this.customEventEmitter=g}return t.prototype.init=function(){var t=this,e=new Vr,r=new Ve,n=new ze(this.piiMaskingService);this.anonymizationService=new Fe(this.pii,this.configuration),this.anonymizationService.init();var i=new ar,o=new hr(e,r),s=new Kr(window.crypto);s.init();var a=new Qr,c=new Qr,u=new Qr,p=new ue(r,this.configuration,s,a,c,u);p.init();var l=new Jr(p),h=[n,this.anonymizationService,l,i],f=new jr(this.configuration,r,new Hr,1e3);this.configuration.textVisibilityEnabled&&csArray.prototype.push.call(h,f);var d=new _r(r,h);this.recordingBatch=new ye;var y=new ve,v=new Xe(y,this.basicParameters);this.configuration.useMalkaPipeline&&v.addProvider({getRequestParameters:function(){return{rt:csArray.prototype.join.call(t.sessionService.getRecordingStates())}}});var g=this.createRecordingPostRequest(this.compressor);this.mutationSerializer=new _e(this.consentService,d,r,n,this.anonymizationService,p,this.configuration,this.urlService),this.mutationSerializer.init(),this.recordingPageEventsTracker=new he(this.selector,r,n,p),this.recordingPageEventsTracker.init();var m=new fe(this.mutationSerializer,o,i,this.lifeCycleEventsEmitter,this.configuration);this.recordingService=new be(this.configuration,g,this.recordingBatch,v,y,new Ne(e,r,i),m,this.recordingPageEventsTracker,new Ze(window.location,this.pii),this.sessionRenewer,i,new ur(window),this.javaScriptErrorsTracker,this.javaScriptErrorsAnonymizer,this.apiErrorsTracker,f,this.apiErrorsAnonymizer,p),this.customEventEmitter.addListeners(this.recordingService),this.recordingInactivityService=new tr(this.recordingPageEventsTracker,m,new Ke(new Je),g,this.mutationSerializer);var S=new Ge("csPersisted"),E=this.createRecordingPostRequest(this.compressor);this.recordingRecoveryService=new Ce(E,this.recordingBatch,S,this.configuration),o.init(),this.recordingInactivityService.init(),this.recordingService.init(),this.commandsService.register(["isRecording"],(function(){return t.sessionService.isReplayRecorded()})),this.commandsService.register(["setCapturedElementsSelector"],(function(e){t.anonymizationService.setWhitelistedElementsSelector(e)})),this.commandsService.register(["setPIISelectors"],(function(e){t.piiMaskingService.setPIISelectors(e)}))},t.prototype.onStartTracking=function(){this.recordingRecoveryService.recover(),this.sessionService.isReplayRecorded()&&(this.configuration.useMalkaPipeline&&this.sessionService.isTemporarilyRecorded()&&this.recordingService.blockSendingEvents(),this.recordingInactivityService.start(),this.recordingService.start(),this.recordingRecoveryService.start())},t.prototype.onAfterArtificialPageView=function(){this.recordingService.clearStates(),this.mutationSerializer.resetAnonymization(),this.sessionService.isReplayRecorded()?(this.recordingInactivityService.restart(),this.recordingService.restart(),this.recordingRecoveryService.restart()):(this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop())},t.prototype.onBeforeSessionRenewal=function(){this.recordingService.clearStates(),this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()},t.prototype.onOptout=function(){this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()},t.prototype.onConsentGranted=function(){this.mutationSerializer.resetAnonymization(),this.recordingService.triggerConsentGranted()},t.prototype.onConsentWithdrawn=function(){this.mutationSerializer.resetAnonymization(),this.recordingService.triggerConsentWithdrawn()},t.prototype.onRecordingStateChange=function(t,e){var r=this;this.configuration.useMalkaPipeline&&(t===Dt.NOT_RECORDED&&e===Vt.ETR_OFF?(this.recordingService.clearEvents(),this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()):(this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){return{rt:csArray.prototype.join.call(r.sessionService.getRecordingStates())}}}),this.recordingService.allowSendingEvents(),this.mutationSerializer.isSerializationInProgress()||this.recordingService.pushEvents()))},t.prototype.onInitialDomDone=function(){this.recordingPageEventsTracker.start()},t.prototype.createRecordingPostRequest=function(t){var e=this.configuration.useMalkaPipeline?"v2/recording":"recording",r=this.configuration.useMalkaPipeline?"byteArray":"base64",n=new ne(this.configuration.getRecordingUri(),e);return this.debugService.isCompressionDisabled()||n.setCompressionOptions(t,r),n},t.isSupported=function(){return"MutationObserver"in window&&"visibilityState"in document},t}(),$r=function(){function t(t,e){this.visitorService=t,this.sessionService=e,this.naturalPageViewSent=!1}return t.prototype.isNaturalPageViewSent=function(){return this.naturalPageViewSent},t.prototype.setNaturalPageViewSent=function(t){this.naturalPageViewSent=t},t.prototype.getTrackingContext=function(){var t=this.getSessionKey(),e=this.getPageNumber();return t&&e?{sessionKey:t,pageNumber:e}:null},t.prototype.getSessionKey=function(){var t=this.visitorService.getVisitor();return t?t.id+"."+t.visitsCount:null},t.prototype.getPageNumber=function(){return this.sessionService.doesSessionExist()?this.sessionService.getSession().pageNumber:null},t}(),tn=function(){function t(t){this.trackingContextService=t,this.registeredCallbacks=[]}return t.prototype.handleCommand=function(t){if(Ct(t)&&(this.registerCallback(t),this.trackingContextService.isNaturalPageViewSent())){var e=this.trackingContextService.getTrackingContext();null!==e&&this.executeAsync(t,e)}},t.prototype.registerCallback=function(t){csArray.prototype.push.call(this.registeredCallbacks,t)},t.prototype.executeRegisteredCallbacks=function(){var t=this,e=this.trackingContextService.getTrackingContext();null!==e&&csArray.prototype.map.call(this.registeredCallbacks,(function(r){return t.executeAsync(r,e)}))},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),en=function(){function t(t){this.trackingContextService=t,this.pendingCallbacks=[]}return t.prototype.handleCommand=function(t){return this.trackingContextService.isNaturalPageViewSent()?this.applyGetSessionKey(t):void this.addPendingCallback(t)},t.prototype.applyGetSessionKey=function(t){var e=this.trackingContextService.getSessionKey();return this.hasCallback(t)&&null!==e&&this.executeAsync(t.callback,e),e},t.prototype.addPendingCallback=function(t){this.hasCallback(t)&&csArray.prototype.push.call(this.pendingCallbacks,t.callback)},t.prototype.flushPendingCallbacks=function(){var t=this,e=this.trackingContextService.getSessionKey();null!==e&&csArray.prototype.forEach.call(this.pendingCallbacks,(function(r){t.executeAsync(r,e)})),this.pendingCallbacks=[]},t.prototype.hasCallback=function(t){return t&&"function"==typeof t.callback},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),rn=function(){function t(t,e){this.iframeParentToChildrenCommunicationService=t,this.trackingContextService=e}return t.prototype.onIframeIntegrationCallback=function(t){if(this.trackingContextService.isNaturalPageViewSent()){var e=this.trackingContextService.getTrackingContext();null!==e&&(t.trackingContext=e,this.iframeParentToChildrenCommunicationService.sendToChildren(ht.IntegrationCallback,t))}},t.prototype.sendAfterPageViewCallbackToChildren=function(){var t=this.trackingContextService.getTrackingContext();if(null!==t){var e={trackingContext:t,initiator:pt.AfterPageView};this.iframeParentToChildrenCommunicationService.sendToChildren(ht.IntegrationCallback,e)}},t}(),nn=["afterPageView"],on=["getSessionKey"],sn=function(){function t(t,e,r,n,i){this.visitorService=t,this.sessionService=e,this.commandsService=r,this.iframeEventsEmitter=n,this.iframeParentToChildrenCommunicationService=i}return t.prototype.init=function(){var t=this;this.trackingContextService=new $r(this.visitorService,this.sessionService),this.afterPageViewService=new tn(this.trackingContextService),this.getSessionKeyService=new en(this.trackingContextService),this.parentToChildrenIntegrationService=new rn(this.iframeParentToChildrenCommunicationService,this.trackingContextService),this.iframeEventsEmitter.addListeners(this.parentToChildrenIntegrationService),this.commandsService.register(on,(function(e){return t.getSessionKeyService.handleCommand(e)})),this.commandsService.register(nn,(function(e){t.afterPageViewService.handleCommand(e)}))},t.prototype.onAfterNaturalPageView=function(){this.trackingContextService.setNaturalPageViewSent(!0),this.getSessionKeyService.flushPendingCallbacks(),this.afterPageViewService.executeRegisteredCallbacks(),this.parentToChildrenIntegrationService.sendAfterPageViewCallbackToChildren()},t.prototype.onAfterArtificialPageView=function(){this.afterPageViewService.executeRegisteredCallbacks(),this.parentToChildrenIntegrationService.sendAfterPageViewCallbackToChildren()},t}(),an=function(){function t(t,e){this.key=csString.prototype.slice.call(t,0,50),this.value=St(e)?csString.prototype.slice.call(e,0,255):e}return t.isValid=function(t,e){return St(t)&&(St(e)||mt(e))},t}(),cn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),un=function(t){function e(e,r){var n=t.call(this)||this;return n.batch=e,n.pii=r,n.dynamicVariablesQueue=[],n}return cn(e,t),e.prototype.onStart=function(){var t=this;csArray.prototype.forEach.call(this.dynamicVariablesQueue,(function(e){return t.trackDynamicVariable(e.key,e.value)})),this.dynamicVariablesQueue=[]},e.prototype.onStop=function(){},e.prototype.trackDynamicVariable=function(t,e){this.isStarted?an.isValid(t,e)&&this.batch.add(new an(this.pii.anonymize(t),this.pii.anonymize(e))):csArray.prototype.push.call(this.dynamicVariablesQueue,{key:t,value:e})},e}(me),pn=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};var ln,hn,fn,dn=function(t){return void 0===t&&(t=0),function(e,r,n){var i=n.value,o=!1;n.value=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];o||(o=!0,setTimeout((function(){i.apply(e,r),o=!1}),t))}}},yn=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},vn=function(){function t(t){this.compressor=t,this.batch=[]}return t.prototype.add=function(t){csArray.prototype.push.call(this.batch,t),this.setBatchReadyCall()},t.prototype.clear=function(){this.batch=[]},t.prototype.onBatchReady=function(t){this.batchReadyCallback=t},t.prototype.getRequestParameters=function(){for(var t={},e=0,r=this.batch;e<r.length;e++){var n=r[e];t[n.key]=n.value}return{dv:this.compressor.compressSync(csJSON.stringify(t))}},t.prototype.setBatchReadyCall=function(){this.batchReadyCallback()},yn([dn(),_t("dynamicVariablesBatchReady")],t.prototype,"setBatchReadyCall",null),t}(),gn=["trackDynamicVariable"],mn=function(){function t(t,e,r,n,i,o){this.commandsService=t,this.sessionService=e,this.configuration=r,this.basicParameters=n,this.compressor=i,this.pii=o,this.request=new Y(this.configuration.getTrackerUri(),"dvar"),this.batch=new vn(this.compressor),this.service=new un(this.batch,this.pii)}return t.prototype.init=function(){var t=this;this.request.setRequestParametersProviders(this.basicParameters,this.batch),this.sessionService.setDynamicVariablesService(this.service),this.batch.onBatchReady((function(){return t.request.send()})),this.request.after((function(){return t.batch.clear()})),this.commandsService.register(gn,(function(e){var r=void 0===e?{}:e,n=r.key,i=r.value;t.service.trackDynamicVariable(n,i)}))},t.prototype.onStartTracking=function(){this.service.start()},t}(),Sn=function(){function t(t,e){this.id=t,this.revenue=e}return t.from=function(e){var r=new t(e.id,parseFloat(e.revenue));return isNaN(parseFloat(e.tax))||(r.tax=parseFloat(e.tax)),isNaN(parseFloat(e.shipping))||(r.shipping=parseFloat(e.shipping)),St(e.currency)&&e.currency.length<=10&&(r.currency=e.currency),r},t.prototype.hasValidRevenue=function(){return!isNaN(this.revenue)&&this.revenue>=0},t}(),En=function(){function t(t,e,r,n){this.id=t,this.name=e,this.price=r,this.quantity=n}return t.from=function(e){if(!t.isValid(e))return null;var r=new t(e.id,e.name,parseFloat(e.price),parseInt(e.quantity,10));return bt(e.sku)&&(r.sku=e.sku),bt(e.category)&&(r.category=e.category),r},t.isValid=function(t){return St(t.id)&&St(t.name)&&gt(parseFloat(t.price))&&mt(parseInt(t.quantity,10))&&(!bt(t.sku)||St(t.sku))&&(!bt(t.category)||St(t.category))},t}(),bn=function(){function t(t,e,r){this.pii=t,this.transactionRequest=e,this.sessionRenewer=r,this.clear()}return t.prototype.addTransaction=function(t){var e=this.pii.anonymizeFields(t,["id"]);this.transaction=Sn.from(e)},t.prototype.getTransaction=function(){return this.transaction},t.prototype.sendTransaction=function(){this.sessionRenewer.isSessionValid()&&(this.transaction.hasValidRevenue()?this.transactionRequest.send():Pt.warn("Transaction Service: unable to send transaction with invalid parameters"))},t.prototype.addItem=function(t){if(!Ct(t)){var e=this.pii.anonymizeFields(t,["id","name","sku","category"]),r=En.from(e);null!==r&&csArray.prototype.push.call(this.transactionItems,r)}},t.prototype.getItems=function(){return this.transactionItems},t.prototype.clear=function(){this.transaction=Sn.from({revenue:NaN}),this.transactionItems=[]},t.prototype.getRequestParameters=function(){var t={id:this.transaction.id?""+this.transaction.id:"",revenue:""+this.transaction.revenue};return bt(this.transaction.tax)&&(t.tax=""+this.transaction.tax),bt(this.transaction.shipping)&&(t.shipping=""+this.transaction.shipping),bt(this.transaction.currency)&&(t.cu=""+this.transaction.currency),t.items=window.JSON.stringify(this.transactionItems),t},t}(),wn=function(){function t(t){this.skuItem=csString.prototype.slice.call(t,0,100)}return Object.defineProperty(t.prototype,"sku",{get:function(){return this.skuItem},enumerable:!1,configurable:!0}),t}(),Cn=function(){function t(t,e){this.cartItemRequest=t,this.sessionRenewer=e,this.cartItem=null}return t.prototype.addToCart=function(t){this.isValidSku(t.sku)&&(this.cartItem=new wn(t.sku),this.sendCartItem())},t.prototype.isValidSku=function(t){return St(t)&&t.length>0},t.prototype.getCartItem=function(){return this.cartItem},t.prototype.sendCartItem=function(){this.sessionRenewer.isSessionValid()&&this.cartItemRequest.send()},t.prototype.clear=function(){this.cartItem=null},t.prototype.getRequestParameters=function(){return this.cartItem?{sku:""+this.cartItem.sku}:{}},t}(),Tn=["ecommerce:addToCart","ec:cart:add"],Rn=["ecommerce:addTransaction","ec:transaction:create"],An=["ecommerce:addItem","ec:transaction:items:add"],kn=["ecommerce:send","ec:transaction:send"],In=function(){function t(t,e,r,n,i,o,s){this.configuration=t,this.visitorService=e,this.sessionService=r,this.commandsService=n,this.pii=i,this.sessionRenewer=o,this.urlService=s}return t.prototype.init=function(){var t=new Y(this.configuration.getTrackerUri(),"transaction"),e=new Y(this.configuration.getTrackerUri(),"addtocart"),r=new bn(this.pii,t,this.sessionRenewer),i=new Cn(e,this.sessionRenewer);t.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,this.urlService,r,n),t.after((function(){r.clear()})),e.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,this.urlService,i,n),e.after((function(){i.clear()})),this.commandsService.register(Rn,(function(t){r.addTransaction(t)})),this.commandsService.register(An,(function(t){return r.addItem(t)})),this.commandsService.register(kn,(function(){return r.sendTransaction()})),this.commandsService.register(Tn,(function(t){i.addToCart(t)}))},t}(),Pn=function(){function t(t){this.windowPerformance=t.performance}return t.prototype.getRequestParameters=function(){if(this.areTimingsUnavailable())return{};var t=this.compute();return{str:t.startRender,di:t.domInteractive,dc:t.domComplete,fl:t.fullyLoaded}},t.prototype.compute=function(){var t=this.windowPerformance.timing;return{startRender:""+(t.domLoading-t.requestStart),domInteractive:""+(t.domInteractive-t.requestStart),domComplete:""+(t.domComplete-t.requestStart),fullyLoaded:""+(t.loadEventEnd-t.requestStart)}},t.prototype.areTimingsUnavailable=function(){return!(this.windowPerformance&&this.windowPerformance.timing&&this.windowPerformance.timing.loadEventEnd>0)},t}();function _n(t){return void 0!==t.tgt}!function(t){t[t.TAP=0]="TAP",t[t.LONG_PRESS=1]="LONG_PRESS",t[t.DRAG=2]="DRAG",t[t.FLICK=3]="FLICK"}(ln||(ln={})),function(t){t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT"}(hn||(hn={})),function(t){t[t.RESIZE=0]="RESIZE",t[t.SCROLL=1]="SCROLL",t[t.MOUSEMOVE=2]="MOUSEMOVE",t[t.MOUSEDOWN=3]="MOUSEDOWN",t[t.MOUSEUP=4]="MOUSEUP",t[t.CLICK=5]="CLICK",t[t.MOUSEOVER=6]="MOUSEOVER",t[t.MOUSEOUT=7]="MOUSEOUT",t[t.CHANGE=10]="CHANGE",t[t.FOCUSIN=11]="FOCUSIN",t[t.FOCUSOUT=12]="FOCUSOUT",t[t.TAP=14]="TAP"}(fn||(fn={}));var On=function(){function t(){}return t.prototype.isEventTypeSupported=function(t){return-1!==csArray.prototype.indexOf.call(this.supportedEventTypes,t)},t.prototype.enhanceAnalysisEvent=function(t,e){return this.isEventTypeSupported(e.type)?this.baseEnhanceAnalysisEvent(t,e):e},t}(),Nn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xn=function(t){function e(e,r){var n=t.call(this)||this;return n.projectConfiguration=e,n.pathComputation=r,n.supportedEventTypes=[fn.MOUSEDOWN,fn.MOUSEUP,fn.CLICK,fn.MOUSEOVER,fn.TAP],n}return Nn(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){if(this.projectConfiguration.eMerchandisingEnabled){var r=this.pathComputation.getTargetPathAndTargetLink(t),n=r.path,i=r.targetLink;e.tgt=n,e.tgtLk=i}else e.tgt=this.pathComputation.getTargetPath(t);return e},e}(On),Mn=function(){function t(){}return t.build=function(t,e,r){return csArray.prototype.reduce.call(r,(function(e,r){return r.enhanceAnalysisEvent(t,e)}),e)},t}(),Ln=function(){function t(t,e,r){var n=this;this.configuration=t,this.pathComputation=e,this.gestureTracker=r,this.analysisEventsEnhancers=[new xn(this.configuration,this.pathComputation)],this.gestureTracker.onEvent((function(t,e){return n.onTap(t,e)}))}return t.prototype.onTap=function(t,e){if(t.type===ln.TAP){var r={type:fn.TAP,ts:0,x:0,y:0,tgt:""},n=Mn.build(e,r,this.analysisEventsEnhancers);n.tgt!==O.INVALID_ELEMENT&&this.onEventCallback(n)}},t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.gestureTracker.start()},t.prototype.stop=function(){this.gestureTracker.stop()},t}(),Dn=function(){function t(){}return t.prototype.compute=function(t,e){var r=this.convertPixelsToDPs(e.x)-this.convertPixelsToDPs(t.x),n=this.convertPixelsToDPs(e.y)-this.convertPixelsToDPs(t.y),i=e.time-t.time;return{duration:i,distance:this.computeGestureDistance(r,n),direction:this.computeGestureDirection(r,n),velocity:this.computeGestureVelocity(r,n,i)}},t.prototype.convertPixelsToDPs=function(t){return t/window.devicePixelRatio},t.prototype.computeGestureDistance=function(t,e){return Math.round(Math.sqrt(t*t+e*e))},t.prototype.computeGestureVelocity=function(t,e,r){var n=r/1e3,i=t/n,o=e/n;return Math.round(Math.abs(i)+Math.abs(o))},t.prototype.computeGestureDirection=function(t,e){return Math.abs(t)>Math.abs(e)?t>0?hn.RIGHT:hn.LEFT:e>0?hn.DOWN:hn.UP},t}(),Vn=function(t){return null!==csEventtarget.apply(t)&&Ae.getShadowRoot(csEventtarget.apply(t))&&t.composedPath?t.__csOriginalTarget||t.composedPath()[0]:csEventtarget.apply(t)},qn=function(){function t(){this.metricsComputer=new Dn,this.reset()}return t.prototype.onGesture=function(t){this.onGestureCallback=t},t.prototype.isValidTouchEvent=function(t){return"touches"in t&&"changedTouches"in t},t.prototype.processActionDown=function(t){this.isGestureStart(t)&&this.reset(),csArray.prototype.push.call(this.pendingInputs,{x:t.touches[0].pageX,y:t.touches[0].pageY,time:csDate.now()}),this.target=Vn(t)},t.prototype.processActionMove=function(){this.hasMove=!0},t.prototype.processActionUp=function(t){csArray.prototype.push.call(this.pendingInputs,{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY,time:csDate.now()}),this.isValidSingleTouchGesture()&&this.runDetection(t)},t.prototype.reset=function(){this.pendingInputs=[],this.target=null,this.hasMove=!1},t.prototype.runDetection=function(t){var e=this.metricsComputer.compute(this.pendingInputs[0],this.pendingInputs[1]),r=this.hasMove?this.computeSwipeGesture(e):this.computePressGesture(e);this.onGestureCallback(r,t)},t.prototype.computeSwipeGesture=function(t){return{type:t.velocity<100?ln.DRAG:ln.FLICK,target:this.target,velocity:t.velocity,distance:t.distance,direction:t.direction}},t.prototype.computePressGesture=function(t){return{type:t.duration<1e3?ln.TAP:ln.LONG_PRESS,target:this.target}},t.prototype.isGestureStart=function(t){return 1===t.touches.length},t.prototype.isValidSingleTouchGesture=function(){return 2===this.pendingInputs.length},t}(),Un=function(){function t(t){var e=this;this.logger=t,this.eventHandlers=[{boundElement:document,type:"touchstart",listener:function(t){return e.processEvent(t)}},{boundElement:document,type:"touchmove",listener:function(t){return e.processEvent(t)}},{boundElement:document,type:"touchend",listener:function(t){return e.processEvent(t)}}],this.detector=new qn}return t.prototype.onEvent=function(t){this.detector.onGesture(t)},t.prototype.start=function(){this.canDetectGesture()&&csArray.prototype.forEach.call(this.eventHandlers,(function(t){return ie(t)}))},t.prototype.stop=function(){this.canDetectGesture()&&csArray.prototype.forEach.call(this.eventHandlers,(function(t){return oe(t)}))},t.prototype.canDetectGesture=function(){return void 0!==window.devicePixelRatio},t.prototype.processEvent=function(t){var e=this;this.logger.tryToExecute("process gesture event",(function(){if(e.detector.isValidTouchEvent(t))switch(t.type){case"touchstart":e.detector.processActionDown(t);break;case"touchmove":e.detector.processActionMove();break;case"touchend":e.detector.processActionUp(t)}}))()},t.isSwipe=function(t){return t.type===ln.FLICK||t.type===ln.DRAG},t}(),zn=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n};function jn(t,e){var r,n,i,o,s=function(){n=null;var e=B.now()-i;o=t.apply(void 0,zn([e],r)),i=null};return function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return i||(i=B.now()),n&&window.clearTimeout(n),r=zn(t),n=window.setTimeout(s,e),o}}var Bn,Hn;(Hn=Bn||(Bn={})).isEventOnScrollContainer=function(t){return!!(wt(t)&&function(t){try{if(wt(csEventtarget.apply(t)))return!0}catch(t){}return!1}(t)&&Tt(csEventtarget.apply(t))&&null!==csEventtarget.apply(t).getAttribute("data-cs-scroll-container"))},Hn.getScrollContainer=function(){return document.querySelector("[data-cs-scroll-container]")};var Fn;(Fn||(Fn={})).getRelativePosition=function(t){var e=Vn(t);if(!(e&&Tt(e)&&Ct(e.getBoundingClientRect)&&wt(t.pageX)&&wt(t.pageY)))return{xRel:-1,yRel:-1,valid:!1};var r=e.getBoundingClientRect(),n=t.pageX-r.left-Le.windowOffsetX(),i=t.pageY-r.top-Le.windowOffsetY();e!==document.documentElement&&(n+=e.scrollLeft,i+=e.scrollTop);var o=Math.max(e.scrollWidth,r.width),s=Math.max(e.scrollHeight,r.height);return{xRel:Math.round(n/o*65535),yRel:Math.round(i/s*65535),valid:!0}};var Gn,Wn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xn=function(t){function e(e,r){var n=t.call(this)||this;return n.projectConfiguration=e,n.pathComputation=r,n.supportedEventTypes=[fn.MOUSEMOVE],n.currentMouseMovePath="",n}return Wn(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){if(!this.projectConfiguration.mouseMoveHeatmapEnabled)return e;var r=Fn.getRelativePosition(t),n=r.valid,i=r.xRel,o=r.yRel;if(n){var s=this.pathComputation.getTargetPath(t);s!==O.INVALID_ELEMENT&&(e.xRel=i,e.yRel=o,s!==this.currentMouseMovePath||this.projectConfiguration.iframesTracking?(this.currentMouseMovePath=s,e.tgtHM=s):e.tgtHM="")}else this.currentMouseMovePath="";return e},e}(On),Kn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.supportedEventTypes=[fn.CHANGE],e.validInputTypes=["text","email","number","search","tel","url","password"],e}return Kn(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){var r=Vn(t);return m(r)&&csArray.prototype.indexOf.call(this.validInputTypes,r.type)>=0&&(e.isBlank=""===r.value),e},e}(On),Jn=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Qn=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},Zn=function(){function t(t,e,r){var n,i,o,s,a,c,u,p=this;this.projectConfiguration=t,this.pathComputation=e,this.selector=r,this.FOCUSABLE_ELEMENTS_SELECTOR="select, select *, input, textarea",this.CHANGEABLE_ELEMENTS_SELECTOR="select, select *, input, textarea",this.HOVERABLE_ELEMENTS_SELECTOR="a, a *, button, button *, select, select *, input, textarea",this.DEBOUNCE_DURATION=150,this.THROTTLE_DURATION=400,this.scrollContainerDimensionSent=!1,this.debouncedScrollEventCallback=jn((function(t,e){return p.scrollListener(t,e)}),this.DEBOUNCE_DURATION),this.debouncedResizeEventCallback=jn((function(t){return p.resizeListener(t)}),this.DEBOUNCE_DURATION),this.throttledMouseMoveCallback=(n=function(t){return p.mouseMoveListener(t)},i=this.THROTTLE_DURATION,s=[],a=null,c=0,u=function(){c=B.now(),a=null,o=n.apply(void 0,s)},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=B.now();c||(c=r);var p=i-(r-c);return s=pn(t),p<=0||p>i?(c=r,o=n.apply(void 0,s),a?(window.clearTimeout(a),a=null):s=[]):a||(a=window.setTimeout(u,p)),o}),this.globalHandlers=[{boundElement:window,type:"resize",listener:function(){return p.debouncedResizeEventCallback()}},{boundElement:document,type:"scroll",listener:function(t){return p.debouncedScrollEventCallback(t)}},{boundElement:window,type:"mousemove",listener:function(t){p.throttledMouseMoveCallback(p.preserveEventForAsyncUse(t))}},{boundElement:document,type:"mousedown",listener:function(t){return p.mouseDownListener(t)}},{boundElement:document,type:"mouseup",listener:function(t){return p.mouseUpListener(t)}},{boundElement:document,type:"click",listener:function(t){return p.clickListener(t)}}],this.onSelectorHandlers=[{boundElement:document,type:"mouseover",listener:this.selector.on(this.HOVERABLE_ELEMENTS_SELECTOR,(function(t){return p.mouseOverListener(t)}))},{boundElement:document,type:"mouseout",listener:this.selector.on(this.HOVERABLE_ELEMENTS_SELECTOR,(function(t){return p.mouseOutListener(t)}))},{boundElement:document,type:"focusin",listener:this.selector.on(this.FOCUSABLE_ELEMENTS_SELECTOR,(function(t){return p.focusInListener(t)}))},{boundElement:document,type:"focusout",listener:this.selector.on(this.FOCUSABLE_ELEMENTS_SELECTOR,(function(t){return p.focusOutListener(t)}))},{boundElement:document,type:"change",listener:this.selector.on(this.CHANGEABLE_ELEMENTS_SELECTOR,(function(t){return p.changeListener(t)}))}],this.analysisEventsEnhancers=[new xn(this.projectConfiguration,this.pathComputation),new Xn(this.projectConfiguration,this.pathComputation),new Yn]}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){var t=this.getSupportedHandlers();csArray.prototype.forEach.call(t,(function(t){return ie(t)})),this.resizeListener()},t.prototype.stop=function(){var t=this.getSupportedHandlers();csArray.prototype.forEach.call(t,(function(t){return oe(t)}))},t.prototype.getSupportedHandlers=function(){return this.selector.isMatchesSelectorSupported()?Qn(this.globalHandlers,this.onSelectorHandlers):(Pt.warn("Element.matches is not implemented yet"),this.globalHandlers)},t.prototype.resizeListener=function(t){var e=Bn.getScrollContainer(),r=Tt(e);r&&(this.scrollContainerDimensionSent=!0);var n={type:fn.RESIZE,ts:0,x:r?e.clientWidth:Le.windowWidth(),y:r?e.clientHeight:Le.windowHeight()};t&&(n.d=t),this.onEventCallback(n)},t.prototype.scrollListener=function(t,e){var r=Bn.isEventOnScrollContainer(e);!this.scrollContainerDimensionSent&&r&&this.resizeListener();var n={type:fn.SCROLL,ts:0,x:r?csEventtarget.apply(e).scrollLeft:Le.windowOffsetX(),y:r?csEventtarget.apply(e).scrollTop:Le.windowOffsetY(),d:t},i=Mn.build(e,n,this.analysisEventsEnhancers);this.onEventCallback(i)},t.prototype.mouseMoveListener=function(t){var e={type:fn.MOUSEMOVE,ts:0,x:t.pageX,y:t.pageY},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallback(r)},t.prototype.mouseDownListener=function(t){var e={type:fn.MOUSEDOWN,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseUpListener=function(t){var e={type:fn.MOUSEUP,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.clickListener=function(t){var e={type:fn.CLICK,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseOverListener=function(t){var e={type:fn.MOUSEOVER,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseOutListener=function(t){var e={type:fn.MOUSEOUT,ts:0,x:t.pageX,y:t.pageY,tgt:this.pathComputation.getTargetPath(t)},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.focusInListener=function(t){var e={type:fn.FOCUSIN,ts:0,tgt:this.pathComputation.getTargetPath(t)},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.focusOutListener=function(t){var e={type:fn.FOCUSOUT,ts:0,tgt:this.pathComputation.getTargetPath(t)},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.changeListener=function(t){var e={type:fn.CHANGE,ts:0,tgt:this.pathComputation.getTargetPath(t)},r=Mn.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.onEventCallbackIfValidTarget=function(t){_n(t)&&t.tgt!==O.INVALID_ELEMENT&&this.onEventCallback(t)},t.prototype.preserveEventForAsyncUse=function(t){return t.composedPath&&Object.defineProperty(t,"__csOriginalTarget",{value:t.composedPath()[0],writable:!1,enumerable:!1}),t},Jn([_t("Event handler type: resize")],t.prototype,"resizeListener",null),Jn([_t("Event handler type: scroll")],t.prototype,"scrollListener",null),Jn([_t("Event handler type: mouseMove")],t.prototype,"mouseMoveListener",null),Jn([_t("Event handler type: mouseDown")],t.prototype,"mouseDownListener",null),Jn([_t("Event handler type: mouseUp")],t.prototype,"mouseUpListener",null),Jn([_t("Event handler type: click")],t.prototype,"clickListener",null),Jn([_t("Event handler type: mouseOver")],t.prototype,"mouseOverListener",null),Jn([_t("Event handler type: mouseOut")],t.prototype,"mouseOutListener",null),Jn([_t("Event handler type: focusIn")],t.prototype,"focusInListener",null),Jn([_t("Event handler type: focusOut")],t.prototype,"focusOutListener",null),Jn([_t("Event handler type: change")],t.prototype,"changeListener",null),t}(),$n=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},ti=function(){function t(){var t=this;this.MAX_SCROLL_RATE_THRESHOLD=100,this.maxScrollRate=0,this.maxDocumentHeight=Le.documentHeight(),this.maxScrollRateHandler={boundElement:document,type:"scroll",listener:function(e){return t.maxScrollRateListener(e)}}}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){ie(this.maxScrollRateHandler),this.reset()},t.prototype.stop=function(){oe(this.maxScrollRateHandler)},t.prototype.reset=function(){var t=Bn.getScrollContainer();if(null===t)this.maxScrollRate=this.currentScrollRate(Le.documentHeight());else{var e=this.computePaddingTop(t);this.maxScrollRate=this.currentScrollRateWithScrollContainer(t,e)}this.onEventCallback()},t.prototype.maxScrollRateListener=function(t){var e,r;if(Bn.isEventOnScrollContainer(t)){var n=csEventtarget.apply(t),i=this.computePaddingTop(n);e=this.documentHeightWithScrollContainer(n,i),r=this.currentScrollRateWithScrollContainer(n,i)}else e=Le.documentHeight(),r=this.currentScrollRate(e);(r>this.maxScrollRate||e>this.maxDocumentHeight)&&(this.maxScrollRate=r,e>this.maxDocumentHeight&&(this.maxDocumentHeight=e),this.onEventCallback())},t.prototype.currentScrollRate=function(t){var e=Math.round(this.lastPixelLine()/t*100);return Math.min(e,this.MAX_SCROLL_RATE_THRESHOLD)},t.prototype.lastPixelLine=function(){var t=Le.windowHeight();return Le.windowOffsetY()+t},t.prototype.currentScrollRateWithScrollContainer=function(t,e){var r=t.scrollTop+t.clientHeight+t.getBoundingClientRect().top+e,n=this.documentHeightWithScrollContainer(t,e),i=Math.round(r/n*100);return Math.min(i,this.MAX_SCROLL_RATE_THRESHOLD)},t.prototype.computePaddingTop=function(t){var e=window.getComputedStyle(t).paddingTop||"0px";return parseInt(e,10)},t.prototype.documentHeightWithScrollContainer=function(t,e){return t.scrollHeight+t.getBoundingClientRect().top+e},t.prototype.getRequestParameters=function(){return{sr:""+this.maxScrollRate,mdh:""+this.maxDocumentHeight}},$n([_t("MaxScrollRate handler")],t.prototype,"maxScrollRateListener",null),t}(),ei=function(){return(ei=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ri=function(){function t(t,e,r,n,i,o,s,a,c,u,p){var l=this;this.configuration=t,this.analysisEventsTracker=e,this.gestureTracker=r,this.maxScrollRateTracker=n,this.performanceTimingMetrics=i,this.analysisEventsBatch=o,this.analysisEventsRequest=s,this.analysisLastEventsRequest=a,this.analysisEventRequestParameters=c,this.sessionRenewer=u,this.recoveryStorage=p,this.eventEmitter=new ge,this.visibilityChangeListener=function(){"hidden"===document.visibilityState&&l.sendLastEvents()},this.sendLastEvents=function(){l.analysisEventsBatch.isEmpty()||l.analysisLastEventsRequest.send()}}return t.prototype.init=function(){var t=this;this.analysisEventsTracker.onEvent((function(e){return t.processEvent(e)})),this.gestureTracker.onEvent((function(e){return t.processEvent(e)})),this.maxScrollRateTracker.onEvent((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.maxScrollRateTracker)})),this.bindRequests()},t.prototype.bindRequests=function(){var t=this;this.analysisEventsRequest.setRequestParametersProviders(this.analysisEventsBatch),this.analysisEventsRequest.before((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.performanceTimingMetrics),t.analysisEventsBatch.enableCompression()})),this.analysisEventsRequest.after((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.analysisEventRequestParameters)})),this.analysisEventsRequest.setRequestPayloadProvider(this.analysisEventsBatch),this.analysisEventsRequest.afterProvidersCalled((function(){return t.analysisEventsBatch.clearEvents()})),this.analysisLastEventsRequest.setRequestParametersProviders(this.analysisEventsBatch),this.analysisLastEventsRequest.setRequestPayloadProvider(this.analysisEventsBatch),this.analysisLastEventsRequest.before((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.performanceTimingMetrics),t.analysisEventsBatch.disableCompression()})),this.analysisLastEventsRequest.onBeaconSuccess((function(){t.analysisEventsBatch.clearEvents(),t.analysisEventsBatch.setRequestParametersFromProvider(t.analysisEventRequestParameters)})),this.analysisLastEventsRequest.onBeaconFailure((function(){t.saveLastEvents()}))},t.prototype.initStates=function(){this.analysisEventsBatch.setRequestParametersFromProvider(this.analysisEventRequestParameters),this.resetStartTime()},t.prototype.start=function(){this.addLastEventsListeners(),this.analysisEventsTracker.start(),this.maxScrollRateTracker.start(),this.gestureTracker.start()},t.prototype.onIframeAnalysisEvent=function(t){this.processEvent(t)},t.prototype.processEvent=function(t){this.sessionRenewer.isSessionValid()&&(this.analysisEventsBatch.addEvent(this.addTimestamp(t)),this.analysisEventsBatch.isFull()&&this.sendEvents(),this.configuration.emitDebugEvents&&this.eventEmitter.emit("analysisEvent",ei(ei({},t),{typeName:fn[t.type]})))},t.prototype.addTimestamp=function(t){return t.ts=this.getRelativeTime(),t},t.prototype.sendEvents=function(){this.analysisEventsBatch.isEmpty()||this.analysisEventsRequest.send()},t.prototype.stop=function(){this.removeLastEventsListeners(),this.analysisEventsTracker.stop(),this.maxScrollRateTracker.stop(),this.gestureTracker.stop(),this.analysisEventsBatch.empty()},t.prototype.clearStates=function(){this.sendEvents(),this.maxScrollRateTracker.reset()},t.prototype.resetStartTime=function(){this.startTime=B.now()},t.prototype.getRelativeTime=function(){return B.now()-this.startTime},t.prototype.addLastEventsListeners=function(){this.addVisibilityChangeListener(),this.addPageHideListener(),this.addBlurListener()},t.prototype.removeLastEventsListeners=function(){this.removeVisibilityChangeListener(),this.removePageHideListener(),this.removeBlurListener()},t.prototype.addVisibilityChangeListener=function(){document.addEventListener("visibilitychange",this.visibilityChangeListener)},t.prototype.removeVisibilityChangeListener=function(){document.removeEventListener("visibilitychange",this.visibilityChangeListener)},t.prototype.addPageHideListener=function(){window.addEventListener("pagehide",this.sendLastEvents)},t.prototype.removePageHideListener=function(){window.removeEventListener("pagehide",this.sendLastEvents)},t.prototype.addBlurListener=function(){window.addEventListener("blur",this.sendLastEvents)},t.prototype.removeBlurListener=function(){window.removeEventListener("blur",this.sendLastEvents)},t.prototype.saveLastEvents=function(){try{this.analysisEventsBatch.isEmpty()||this.recoveryStorage.save({events:this.analysisEventsBatch.getEvents(),metadata:this.analysisEventsBatch.getMetadata()})}catch(t){}},t}();!function(t){t.UNCOMPRESSED="0",t.BASE64="1"}(Gn||(Gn={}));var ni=oi.toString(),ii=oi();function oi(){var t={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var r,n,i,o,s,a,c,u="",p=0;for(e=t.compress(e);p<2*e.length;)p%2==0?(r=e.charCodeAt(p/2)>>8,n=255&e.charCodeAt(p/2),i=p/2+1<e.length?e.charCodeAt(p/2+1)>>8:NaN):(r=255&e.charCodeAt((p-1)/2),(p+1)/2<e.length?(n=e.charCodeAt((p+1)/2)>>8,i=255&e.charCodeAt((p+1)/2)):n=i=NaN),p+=3,o=r>>2,s=(3&r)<<4|n>>4,a=(15&n)<<2|i>>6,c=63&i,isNaN(n)?a=c=64:isNaN(i)&&(c=64),u=u+t._keyStr.charAt(o)+t._keyStr.charAt(s)+t._keyStr.charAt(a)+t._keyStr.charAt(c);return u},decompressFromBase64:function(e){if(null==e)return"";var r,n,i,o,s,a,c,u="",p=0,l=0,h=t._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)n=t._keyStr.indexOf(e.charAt(l++))<<2|(s=t._keyStr.indexOf(e.charAt(l++)))>>4,i=(15&s)<<4|(a=t._keyStr.indexOf(e.charAt(l++)))>>2,o=(3&a)<<6|(c=t._keyStr.indexOf(e.charAt(l++))),p%2==0?(r=n<<8,64!=a&&(u+=h(r|i)),64!=c&&(r=o<<8)):(u+=h(r|n),64!=a&&(r=i<<8),64!=c&&(u+=h(r|o))),p+=3;return t.decompress(u)},compressToUTF16:function(e){if(null==e)return"";var r,n,i,o="",s=0,a=t._f;for(e=t.compress(e),r=0;r<e.length;r++)switch(n=e.charCodeAt(r),s++){case 0:o+=a(32+(n>>1)),i=(1&n)<<14;break;case 1:o+=a(i+(n>>2)+32),i=(3&n)<<13;break;case 2:o+=a(i+(n>>3)+32),i=(7&n)<<12;break;case 3:o+=a(i+(n>>4)+32),i=(15&n)<<11;break;case 4:o+=a(i+(n>>5)+32),i=(31&n)<<10;break;case 5:o+=a(i+(n>>6)+32),i=(63&n)<<9;break;case 6:o+=a(i+(n>>7)+32),i=(127&n)<<8;break;case 7:o+=a(i+(n>>8)+32),i=(255&n)<<7;break;case 8:o+=a(i+(n>>9)+32),i=(511&n)<<6;break;case 9:o+=a(i+(n>>10)+32),i=(1023&n)<<5;break;case 10:o+=a(i+(n>>11)+32),i=(2047&n)<<4;break;case 11:o+=a(i+(n>>12)+32),i=(4095&n)<<3;break;case 12:o+=a(i+(n>>13)+32),i=(8191&n)<<2;break;case 13:o+=a(i+(n>>14)+32),i=(16383&n)<<1;break;case 14:o+=a(i+(n>>15)+32,32+(32767&n)),s=0}return o+a(i+32)},decompressFromUTF16:function(e){if(null==e)return"";for(var r,n,i="",o=0,s=0,a=t._f;s<e.length;){switch(n=e.charCodeAt(s)-32,o++){case 0:r=n<<1;break;case 1:i+=a(r|n>>14),r=(16383&n)<<2;break;case 2:i+=a(r|n>>13),r=(8191&n)<<3;break;case 3:i+=a(r|n>>12),r=(4095&n)<<4;break;case 4:i+=a(r|n>>11),r=(2047&n)<<5;break;case 5:i+=a(r|n>>10),r=(1023&n)<<6;break;case 6:i+=a(r|n>>9),r=(511&n)<<7;break;case 7:i+=a(r|n>>8),r=(255&n)<<8;break;case 8:i+=a(r|n>>7),r=(127&n)<<9;break;case 9:i+=a(r|n>>6),r=(63&n)<<10;break;case 10:i+=a(r|n>>5),r=(31&n)<<11;break;case 11:i+=a(r|n>>4),r=(15&n)<<12;break;case 12:i+=a(r|n>>3),r=(7&n)<<13;break;case 13:i+=a(r|n>>2),r=(3&n)<<14;break;case 14:i+=a(r|n>>1),r=(1&n)<<15;break;case 15:i+=a(r|n),o=0}s++}return t.decompress(i)},compressToUint8Array:function(e){for(var r=t.compress(e),n=new Uint8Array(2*r.length),i=0,o=r.length;i<o;i++){var s=r.charCodeAt(i);n[2*i]=s>>>8,n[2*i+1]=s%256}return n},decompressFromUint8Array:function(e){if(null==e)return t.decompress(e);for(var r=new Array(e.length/2),n=0,i=r.length;n<i;n++)r[n]=256*e[2*n]+e[2*n+1];return t.decompress(String.fromCharCode.apply(null,r))},compressToEncodedURIComponent:function(e){return t.compressToBase64(e).replace("=","$").replace("/","-")},decompressFromEncodedURIComponent:function(e){return e&&(e=e.replace("$","=").replace("-","/")),t.decompressFromBase64(e)},compress:function(e){if(null==e)return"";var r,n,i,o={},s={},a="",c="",u="",p=2,l=3,h=2,f="",d=0,y=0,v=t._f;for(i=0;i<e.length;i+=1)if(a=e.charAt(i),Object.prototype.hasOwnProperty.call(o,a)||(o[a]=l++,s[a]=!0),c=u+a,Object.prototype.hasOwnProperty.call(o,c))u=c;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<h;r++)d<<=1,15==y?(y=0,f+=v(d),d=0):y++;for(n=u.charCodeAt(0),r=0;r<8;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1}else{for(n=1,r=0;r<h;r++)d=d<<1|n,15==y?(y=0,f+=v(d),d=0):y++,n=0;for(n=u.charCodeAt(0),r=0;r<16;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1}0==--p&&(p=Math.pow(2,h),h++),delete s[u]}else for(n=o[u],r=0;r<h;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1;0==--p&&(p=Math.pow(2,h),h++),o[c]=l++,u=String(a)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<h;r++)d<<=1,15==y?(y=0,f+=v(d),d=0):y++;for(n=u.charCodeAt(0),r=0;r<8;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1}else{for(n=1,r=0;r<h;r++)d=d<<1|n,15==y?(y=0,f+=v(d),d=0):y++,n=0;for(n=u.charCodeAt(0),r=0;r<16;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1}0==--p&&(p=Math.pow(2,h),h++),delete s[u]}else for(n=o[u],r=0;r<h;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1;0==--p&&(p=Math.pow(2,h),h++)}for(n=2,r=0;r<h;r++)d=d<<1|1&n,15==y?(y=0,f+=v(d),d=0):y++,n>>=1;for(;;){if(d<<=1,15==y){f+=v(d);break}y++}return f},decompress:function(e){if(null==e)return"";if(""==e)return null;var r,n,i,o,s,a,c,u=[],p=4,l=4,h=3,f="",d="",y=t._f,v={string:e,val:e.charCodeAt(0),position:32768,index:1};for(r=0;r<3;r+=1)u[r]=r;for(i=0,s=Math.pow(2,2),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;switch(i){case 0:for(i=0,s=Math.pow(2,8),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;c=y(i);break;case 1:for(i=0,s=Math.pow(2,16),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;c=y(i);break;case 2:return""}for(u[3]=c,n=d=c;;){if(v.index>v.string.length)return"";for(i=0,s=Math.pow(2,h),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;switch(c=i){case 0:for(i=0,s=Math.pow(2,8),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;u[l++]=y(i),c=l-1,p--;break;case 1:for(i=0,s=Math.pow(2,16),a=1;a!=s;)o=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),i|=(o>0?1:0)*a,a<<=1;u[l++]=y(i),c=l-1,p--;break;case 2:return d}if(0==p&&(p=Math.pow(2,h),h++),u[c])f=u[c];else{if(c!==l)return null;f=n+n.charAt(0)}d+=f,u[l++]=n+f.charAt(0),n=f,0==--p&&(p=Math.pow(2,h),h++)}}};return t}var si=function(){return(si=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ai=function(){function t(t){var e=t.events,r=void 0===e?[]:e,n=t.requestParameters,i=void 0===n?{}:n,o=t.debugService;this.compressed=!0,this.events=[],this.requestParameters={},this.events=r,this.requestParameters=i,this.debugService=o}return t.prototype.getRequestPayload=function(){return this.isCompressed()?ii.compressToBase64(csJSON.stringify(this.events)):csJSON.stringify(this.events)},t.prototype.addEvent=function(t){csArray.prototype.push.call(this.events,t)},t.prototype.setRequestParametersFromProvider=function(t){var e=t.getRequestParameters();for(var r in e)e.hasOwnProperty(r)&&(this.requestParameters[r]=e[r])},t.prototype.eventsCount=function(){return this.events.length},t.prototype.clearEvents=function(){this.events=[]},t.prototype.empty=function(){this.clearEvents()},t.prototype.isFull=function(){return this.eventsCount()>=50},t.prototype.isEmpty=function(){return 0===this.events.length},t.prototype.getEvents=function(){return this.events},t.prototype.getMetadata=function(){return this.requestParameters},t.prototype.getRequestParameters=function(){return si(si({},this.requestParameters),{ct:this.isCompressed()?Gn.BASE64:Gn.UNCOMPRESSED})},t.prototype.enableCompression=function(){this.compressed=!0},t.prototype.disableCompression=function(){this.compressed=!1},t.prototype.isCompressed=function(){return this.compressed&&!this.debugService.isCompressionDisabled()},t}(),ci=function(){function t(t,e,r){var n=this;this.analysisEventsRecoveryRequest=t,this.recoveryStorage=e,this.debugService=r,this.visibilityChangeHandler=function(){"visible"===document.visibilityState&&n.sendPersistedRecordings()}}return t.prototype.start=function(){this.sendPersistedRecordings(),this.addVisibilityChangeListener()},t.prototype.stop=function(){this.removeVisibilityChangeListener()},t.prototype.getRecoveryStorage=function(){return this.recoveryStorage},t.prototype.sendPersistedRecordings=function(){var t=this.recoveryStorage.recover();if(null!==t){var e=t,r=e.metadata,n=e.events,i=new ai({events:n,requestParameters:r,debugService:this.debugService});this.analysisEventsRecoveryRequest.setRequestParametersProviders(i),this.analysisEventsRecoveryRequest.before((function(){i.enableCompression()})),this.analysisEventsRecoveryRequest.setRequestPayloadProvider(i),this.analysisEventsRecoveryRequest.afterProvidersCalled((function(){return i.clearEvents()})),this.analysisEventsRecoveryRequest.send()}},t.prototype.addVisibilityChangeListener=function(){document.addEventListener("visibilitychange",this.visibilityChangeHandler)},t.prototype.removeVisibilityChangeListener=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},t}();var ui=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pi=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.onBeaconSuccessCallbacks=[],n.onBeaconFailureCallbacks=[],n}return ui(e,t),e.prototype.setRequestPayloadProvider=function(t){this.requestPayloadProvider=t},e.prototype.onBeaconSuccess=function(t){csArray.prototype.push.call(this.onBeaconSuccessCallbacks,t)},e.prototype.onBeaconFailure=function(t){csArray.prototype.push.call(this.onBeaconFailureCallbacks,t)},e.prototype.send=function(){csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var t=this.retrieveParameters(),e=z.toQuery(t),r=this.retrievePayload();this.sendBeacon(e,r)?csArray.prototype.forEach.call(this.onBeaconSuccessCallbacks,(function(t){return t()})):csArray.prototype.forEach.call(this.onBeaconFailureCallbacks,(function(t){return t()})),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(t){return t()}))},e.prototype.retrievePayload=function(){return this.requestPayloadProvider?this.requestPayloadProvider.getRequestPayload():""},e.prototype.sendBeacon=function(t,e){return void 0!==navigator.sendBeacon&&navigator.sendBeacon(this.domainUri+"/"+this.path+"?"+t,e)},e}(X),li=function(){function t(t){this.storageName=t}return t.prototype.save=function(t){localStorage.setItem(this.storageName,csJSON.stringify(t))},t.prototype.clear=function(){localStorage.removeItem(this.storageName)},t.prototype.recover=function(){var t=localStorage.getItem(this.storageName);if(null===t)return null;var e=null;try{e=csJSON.parse(t)}catch(e){Pt.error("Invalid item in localStorage.\n         (key:"+this.storageName+"; value:"+t+")")}finally{this.clear()}return e},t}(),hi=function(){function t(t,e,r,n,i,o,s,a,c){this.configuration=t,this.visitorService=e,this.sessionService=r,this.eventPathComputation=n,this.selector=i,this.commandsService=o,this.sessionRenewer=s,this.iframeEventsEmitter=a,this.debugService=c}return t.prototype.init=function(){!function(){localStorage.removeItem("csLegacyRecovered");for(var t=[],e=0;e<localStorage.length;e+=1){var r=localStorage.key(e);0===csString.prototype.indexOf.call(r,"CSStorageData")&&csArray.prototype.push.call(t,r)}csArray.prototype.forEach.call(t,(function(t){return localStorage.removeItem(t)}))}();var t=new ai({debugService:this.debugService});this.analysisEventsRecovery=this.createRecovery(),this.analysisEventsService=this.createService(t,this.analysisEventsRecovery.getRecoveryStorage()),this.analysisEventsService.init(),this.iframeEventsEmitter.addListeners(this.analysisEventsService)},t.prototype.onStartTracking=function(){this.analysisEventsRecovery.start(),this.analysisEventsService.start()},t.prototype.onAfterNaturalPageView=function(){this.analysisEventsService.initStates()},t.prototype.onAfterArtificialPageView=function(){this.analysisEventsService.initStates()},t.prototype.onBeforeArtificialPageView=function(){this.analysisEventsService.clearStates()},t.prototype.onBeforeSessionRenewal=function(){this.analysisEventsService.clearStates(),this.analysisEventsService.stop(),this.analysisEventsRecovery.stop()},t.prototype.onOptout=function(){this.analysisEventsService.stop(),this.analysisEventsRecovery.stop()},t.prototype.createService=function(t,e){var r=new Pn(window),i=new ti,o=new Zn(this.configuration,this.eventPathComputation,this.selector),s=new Ln(this.configuration,this.eventPathComputation,new Un(Pt)),a=new ne(this.configuration.getTrackerUri(),"v2/events"),c=new pi(this.configuration.getTrackerUri(),"v2/events"),u=new Xe(this.configuration,this.visitorService,this.sessionService,i,r,n);return new ri(this.configuration,o,s,i,r,t,a,c,u,this.sessionRenewer,e)},t.prototype.createRecovery=function(){var t=new ne(this.configuration.getTrackerUri(),"v2/events");return new ci(t,new li("csAnalysisEventsPersisted"),this.debugService)},t}(),fi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),di=function(t){function e(e,r,n){var i=t.call(this)||this;return i.lifeCycleEventsEmitter=e,i.pageViewRequest=r,i.urlService=n,i}return fi(e,t),e.prototype.onStart=function(){this.sendNaturalPageView()},e.prototype.onStop=function(){},e.prototype.triggerArtificialPageView=function(t){this.urlService.overridePath(t),this.isStarted&&this.sendArtificialPageView()},e.prototype.sendNaturalPageView=function(){this.lifeCycleEventsEmitter.emitBeforeNaturalPageView(),this.pageViewRequest.send(),this.lifeCycleEventsEmitter.emitAfterNaturalPageView()},e.prototype.sendArtificialPageView=function(){this.lifeCycleEventsEmitter.emitBeforeArtificialPageView(),this.pageViewRequest.send(),this.lifeCycleEventsEmitter.emitAfterArtificialPageView()},e}(me),yi=window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage||window.navigator.systemLanguage||"unknown";function vi(){return{la:yi}}var gi=function(){function t(t){this.pii=t}return t.prototype.getRequestParameters=function(){return{dr:this.get()}},t.prototype.get=function(){return this.pii.anonymize(this.getReferrer())},t.prototype.getReferrer=function(){var t="";try{t=window.top.document.referrer}catch(e){if(window.parent)try{t=window.parent.document.referrer}catch(e){t=""}}return""===t&&(t=document.referrer),t},t}(),mi=["trackPageview"],Si=["setPath"],Ei=["setQuery"],bi=function(){function t(t,e,r,n,i,o,s,a,c){this.configuration=t,this.commandsService=e,this.lifeCycleEventsEmitter=r,this.visitorService=n,this.sessionService=i,this.consentService=o,this.customVariablesService=s,this.pii=a,this.urlService=c}return t.prototype.init=function(){var t=this,e=new Y(this.configuration.getTrackerUri(),"pageview");this.pageViewService=new di(this.lifeCycleEventsEmitter,e,this.urlService),e.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,Le,new gi(this.pii),this.urlService,this.consentService,i,this.customVariablesService,n),this.commandsService.register(mi,(function(e){return t.pageViewService.triggerArtificialPageView(e)})),this.commandsService.register(Si,(function(e){return t.urlService.overridePath(e)})),this.commandsService.register(Ei,(function(e){return t.urlService.overrideQuery(e)}))},t.prototype.start=function(){this.pageViewService.start()},t.prototype.onBeforeSessionRenewal=function(){this.pageViewService.stop()},t}(),wi=function(){function t(t,e){this.pathComputation=t,this.configuration=e}return t.prototype.getTargetPath=function(t){var e,r=Vn(t);return this.pathComputation.getElementPath(r,{dynamicIdRegex:this.configuration.dynamicIdRegex,reliableSelectors:null===(e=this.configuration.experimental.pathComputation)||void 0===e?void 0:e.reliableSelectors})},t.prototype.getTargetPathAndTargetLink=function(t){var e,r=Vn(t),n=this.pathComputation.getElementPathAndFirstAnchorParent(r,{dynamicIdRegex:this.configuration.dynamicIdRegex,reliableSelectors:null===(e=this.configuration.experimental.pathComputation)||void 0===e?void 0:e.reliableSelectors}),i=n.path,o=n.firstAnchorParent;return{path:i,targetLink:this.hasValidTargetLink(o)?o.href:""}},t.prototype.hasValidTarget=function(t){var e=Vn(t);return this.pathComputation.isValidElement(e)},t.prototype.hasValidTargetLink=function(t){return null!==t&&t.hasAttribute("href")&&!V(t.getAttribute("href"),"#")},t}(),Ci=function(){function t(t){this.pathComputation=t}return t.prototype.on=function(t,e){var r=this;return function(n){r.pathComputation.hasValidTarget(n)&&r.targetMatchesSelector(n,t)&&e(n)}},t.prototype.targetMatchesSelector=function(t,e){var r=Vn(t);return T().call(r,e)},t.prototype.isMatchesSelectorSupported=function(){return!!T()},t}(),Ti=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Ri=function(){function t(){}return t.prototype.onLoad=function(t){this.onLoadCallback=t},t.prototype.onLoadCallbackExecute=function(){this.onLoadCallback()},t.prototype.start=function(){var t=this.onLoadCallbackExecute.bind(this);this.onDocumentLoaded(t)},t.prototype.onDocumentLoaded=function(t){function e(){document.removeEventListener("DOMContentLoaded",e),window.removeEventListener("load",e),t()}"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?setTimeout(t):(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e))},Ti([_t("onLoad")],t.prototype,"onLoadCallbackExecute",null),t}(),Ai=["clearSession"],ki=["extendSession"],Ii=function(){function t(t,e,r){this.visitorService=t,this.sessionService=e,this.commandsService=r}return t.prototype.init=function(){var t=this;this.commandsService.register(Ai,(function(){return t.sessionService.removeSession()})),this.commandsService.register(ki,(function(){return t.sessionService.extendSessionPeriodically()}))},t.prototype.onBeforeNaturalPageView=function(){this.visitorService.createOrUpdateVisitor(),this.sessionService.createOrUpdateSession()},t.prototype.onBeforeArtificialPageView=function(){this.visitorService.createOrUpdateVisitor(),this.sessionService.createOrUpdateSession()},t.prototype.onOptout=function(){this.visitorService.removeVisitor(),this.sessionService.removeSession()},t.prototype.onRecordingStateChange=function(t,e){this.sessionService.updateRecordingState(t,e)},t}(),Pi=function(){function t(t){this.sessionService=t}return t.prototype.onSessionExpired=function(t){this.onSessionExpiredCallback=t},t.prototype.isSessionValid=function(){var t=this.sessionService.hasValidSession();return!t&&this.canRenewSession()?(this.lastSessionRenewalTime=B.now(),this.onSessionExpiredCallback(),this.sessionService.hasValidSession()):t},t.prototype.canRenewSession=function(){return!bt(this.lastSessionRenewalTime)||B.now()-this.lastSessionRenewalTime>6e4},t}(),_i=function(){function t(t,e,r){this.eMerchandisingRequest=t,this.urlService=e,this.eMerchandisingTracker=r,this.requestPayload={targetUrl:"",windowWidth:0,windowHeight:0,products:[]}}return t.prototype.init=function(){var t=this;this.eMerchandisingRequest.afterProvidersCalled((function(){t.requestPayload.products=[]})),this.eMerchandisingRequest.setRequestPayloadProvider({getRequestPayload:function(){return csJSON.stringify(t.requestPayload)}})},t.prototype.collect=function(){this.requestPayload={targetUrl:this.urlService.getUrl(),windowWidth:Le.windowWidth(),windowHeight:Le.windowHeight(),products:this.eMerchandisingTracker.collectProducts()},this.sendEMerchandisingData()},t.prototype.onIframeEmerchandisingMessage=function(t){this.requestPayload=t,this.sendEMerchandisingData()},t.prototype.sendEMerchandisingData=function(){this.eMerchandisingRequest.send()},t}(),Oi=function(){function t(t){this.configuration=t}return t.prototype.collectProducts=function(){for(var t=[],e=0,r=this.getAllValidAnchors(this.configuration.hostnames);e<r.length;e++){var n=r[e],i=O.getElementPath(n,{dynamicIdRegex:this.configuration.dynamicIdRegex});csArray.prototype.push.call(t,{targetPath:i,href:n.href})}return t},t.prototype.getAllValidAnchors=function(t){var e=this;return csArray.prototype.filter.call(xr.findAllElements("a"),(function(r){return e.isAnchorValid(r,t)}))},t.prototype.isAnchorValid=function(t,e){var r=ct(t.href);return t.offsetWidth>0&&t.offsetHeight>0&&""!==r&&ut(r,e)},t}(),Ni=["emerch:collect"],xi=function(){function t(t,e,r,n,i,o,s){this.configuration=t,this.compressor=e,this.basicRequestParameters=r,this.customVariablesService=n,this.urlService=i,this.iframeEventsEmitter=o,this.commandsService=s}return t.prototype.init=function(){var t=this.createEMerchandisingPostRequest(this.compressor),e=new Oi(this.configuration);this.eMerchandisingService=new _i(t,this.urlService,e),this.eMerchandisingService.init(),this.iframeEventsEmitter.addListeners(this.eMerchandisingService)},t.prototype.registerCommands=function(){var t=this;this.commandsService.register(Ni,(function(){t.eMerchandisingService.collect()}))},t.prototype.onStartTracking=function(){this.eMerchandisingService.collect(),this.registerCommands()},t.prototype.onAfterArtificialPageView=function(){this.eMerchandisingService.collect()},t.prototype.createEMerchandisingPostRequest=function(t){var e=new ne(this.configuration.getTrackerUri(),"display");return e.setCompressionOptions(t,"base64"),e.setRequestParametersProviders(this.basicRequestParameters,this.customVariablesService),e.setRequestHeader({name:"Access-Control-Expose-Headers",value:"Content-compression"}),e.setRequestHeader({name:"Content-type",value:"text/plain; charset=UTF-8"}),e.setRequestHeader({name:"Content-compression",value:"LZString"}),e},t}(),Mi=r(0);function Li(t){return t.tagDeploymentMode===Mi.TagDeploymentMode.DualCollectionReview||t.tagDeploymentMode===Mi.TagDeploymentMode.DualCollection}var Di,Vi=function(){function t(t,e,r,n){this.configuration=t,this.visitorService=e,this.sessionService=r,this.piiMaskingService=n}return t.prototype.init=function(){this.isClicktalePtcLoaded=!1,this.isContentSquareDataCollectionStarted=!1},t.prototype.loadClicktalePtc=function(){!this.isClicktalePtcLoaded&&this.configuration.ptcDomain&&this.configuration.ptcGuid&&this.doLoadClicktalePtc()},t.prototype.getSessionData=function(){var t=this.configuration.projectId,e=this.visitorService.getVisitor();return{projectId:t,userId:e.id,sessionNumber:e.visitsCount,pageNumber:this.sessionService.getSession().pageNumber}},t.prototype.startDataCollection=function(t){this.isContentSquareDataCollectionStarted||(this.configuration.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc&&this.isReplayRecordedInMalka()&&this.piiMaskingService.initCTPII(),Li(this.configuration)&&(this.piiMaskingService.initCTPII(),t(),this.isContentSquareDataCollectionStarted=!0))},t.prototype.isReplayRecordedInMalka=function(){return this.configuration.useMalkaPipeline&&this.sessionService.isReplayRecorded()},t.prototype.doLoadClicktalePtc=function(){this.isClicktalePtcLoaded=!0;var t=this.buildScriptElement();document.getElementsByTagName("head")[0].appendChild(t)},t.prototype.buildScriptElement=function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","script");return t.async=!0,t.crossOrigin="anonymous",t.type="text/javascript",this.configuration.ptcSha512&&this.configuration.ptcSnapshotPath?(t.integrity="sha512-"+this.configuration.ptcSha512,t.src="https://"+this.configuration.ptcDomain+"/"+this.configuration.ptcSnapshotPath+"/ptc.js"):t.src="https://"+this.configuration.ptcDomain+"/ptc/"+this.configuration.ptcGuid+".js",t},t}();!function(t){t.isRecording=function(){return window.ClickTaleIsRecording&&window.ClickTaleIsRecording()},t.stopRecording=function(){window.ClickTaleStop&&window.ClickTaleStop()},t.triggerLogicalPageView=function(t){window.ClickTaleLogicalWithUploadPage&&window.ClickTaleLogicalWithUploadPage(t)},t.sendPageEvent=function(t){window.ClickTaleEvent&&window.ClickTaleEvent(t)},t.sendEventTriggerRecording=function(t){window.ClickTaleEventTrigger&&window.ClickTaleEventTrigger(t)}}(Di||(Di={}));var qi,Ui=function(){function t(t,e,r,n,i,o,s){this.configuration=t,this.visitorService=e,this.sessionService=r,this.urlService=n,this.commandsService=i,this.startDataCollectionCallback=o,this.piiMaskingService=s}return t.prototype.init=function(){var t=this;this.clicktaleIntegrationService=new Vi(this.configuration,this.visitorService,this.sessionService,this.piiMaskingService),this.clicktaleIntegrationService.init(),this.loadPtcForDualCollection(),this.commandsService.register(["getSessionData"],(function(){return t.clicktaleIntegrationService.getSessionData()})),this.commandsService.register(["startDataCollection"],(function(){t.clicktaleIntegrationService.startDataCollection(t.startDataCollectionCallback)}))},t.prototype.loadPtcForDualCollection=function(){Li(this.configuration)&&this.clicktaleIntegrationService.loadClicktalePtc()},t.prototype.onAfterNaturalPageView=function(){this.configuration.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc&&(!this.configuration.useMalkaPipeline&&this.sessionService.isReplayRecorded()||this.clicktaleIntegrationService.loadClicktalePtc())},t.prototype.onAfterArtificialPageView=function(){!this.sessionService.isReplayRecorded()&&Di.isRecording()&&this.configuration.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc&&Di.triggerLogicalPageView(this.urlService.getUrl())},t.prototype.onAfterSessionRenewal=function(){!this.sessionService.isReplayRecorded()&&Di.isRecording()&&Di.triggerLogicalPageView(this.urlService.getUrl())},t.prototype.onOptout=function(){Di.isRecording()&&Di.stopRecording()},t}(),zi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ji=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Bi=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Hi=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.configuration=e,s.pageEventRequest=r,s.compressor=n,s.customEventsEmitter=i,s.hashHelper=o,s.pageEventsQueue=[],s.etrQueue=[],s}return zi(e,t),e.prototype.onStart=function(){var t=this;csArray.prototype.forEach.call(this.pageEventsQueue,(function(e){return t.trackPageEvent(e)})),this.pageEventsQueue=[],csArray.prototype.forEach.call(this.etrQueue,(function(e){return t.trackEventTriggerRecording(e)})),this.etrQueue=[]},e.prototype.onStop=function(){},e.prototype.trackPageEvent=function(t){this.isStarted?e.isValidEventName(t)&&(this.isCustomHashIdEvent(t)?this.hashHelper.isSupported()&&this.trackEventWithCustomHashId(t):this.trackEvent(t)):csArray.prototype.push.call(this.pageEventsQueue,t)},e.prototype.isCustomHashIdEvent=function(t){return V(t,"@user-identifier@")},e.prototype.trackEventWithCustomHashId=function(t){return ji(this,void 0,void 0,(function(){var e,r;return Bi(this,(function(n){switch(n.label){case 0:return this.configuration.customHashIdEnabled?(e=csString.prototype.slice.call(t,"@user-identifier@".length),this.hashHelper.isValidInput(e)?[4,this.hashHelper.digest(e,this.configuration.projectId)]:(Pt.warn("Page event: invalid user identifier"),[2])):(Pt.warn("Page event: customHashId feature disabled"),[2]);case 1:return(r=n.sent())?(this.pageEventRequestParameter={eventName:r,isETR:!1,isCustomHashId:!0},this.sendPageEvent()):Pt.warn("Page event: unable to compute customHashId"),[2]}}))}))},e.prototype.trackEvent=function(t){this.customEventsEmitter.emitPageEvent(t),this.pageEventRequestParameter={eventName:t,isETR:!1,isCustomHashId:!1},this.sendPageEvent(),this.configuration.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc&&Di.sendPageEvent(t)},e.prototype.trackEventTriggerRecording=function(t){this.isStarted?e.isValidEventName(t)&&(this.configuration.useMalkaPipeline&&this.configuration.malkaEtrEnabled?this.trackMalkaEventTriggerRecording(t):this.trackLegacyEventTriggerRecording(t)):csArray.prototype.push.call(this.etrQueue,t)},e.prototype.trackMalkaEventTriggerRecording=function(t){V(t,"@ETP@")?this.customEventsEmitter.emitEventTriggerRecording(t,qt.ETR_PAGE):this.customEventsEmitter.emitEventTriggerRecording(t,qt.ETR_SESSION),this.pageEventRequestParameter={eventName:t,isETR:!0,isCustomHashId:!1},this.sendPageEvent()},e.prototype.trackLegacyEventTriggerRecording=function(t){var e;(Li(e=this.configuration)||e.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc)&&(this.customEventsEmitter.emitEventTriggerRecording(t,qt.ETR_LEGACY),this.pageEventRequestParameter={eventName:t,isETR:!0,isCustomHashId:!1},this.sendPageEvent(),this.configuration.tagDeploymentMode===Mi.TagDeploymentMode.LoadClicktalePtc&&Di.sendEventTriggerRecording(t))},e.prototype.getRequestParameters=function(){return{value:this.compressor.compressSync(this.pageEventRequestParameter.eventName),isETR:""+this.pageEventRequestParameter.isETR,isCustomHashId:""+this.pageEventRequestParameter.isCustomHashId}},e.prototype.sendPageEvent=function(){this.pageEventRequest.send()},e.isValidEventName=function(t){return St(t)&&!!csString.prototype.trim.call(t)},e}(me),Fi=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Gi=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Wi=function(){function t(t){this.crypto=t,this.isHashingSupported=!1}return t.prototype.init=function(){this.isHashingSupported=this.canSupportHashing(),this.isHashingSupported&&(this.textEncoder=new TextEncoder)},t.prototype.canSupportHashing=function(){return!!this.crypto&&!!this.crypto.subtle&&!!this.crypto.subtle.digest&&"TextEncoder"in window&&!!csArray.from},t.prototype.isSupported=function(){return this.isHashingSupported},t.prototype.isValidInput=function(t){return!!t&&t.length<=100},t.prototype.formatInput=function(t,e){return csString.prototype.toLowerCase.call(csString.prototype.trim.call(t))+":"+e},t.prototype.digest=function(t,e){return Fi(this,void 0,void 0,(function(){var r,n,i;return Gi(this,(function(o){switch(o.label){case 0:if(!this.isHashingSupported)return[2,null];r=this.formatInput(t,e),n=this.textEncoder.encode(r),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,crypto.subtle.digest("SHA-1",n)];case 2:return i=o.sent(),[2,(s=i,a=csArray.from(new Uint8Array(s)),csArray.prototype.join.call(csArray.prototype.map.call(a,(function(t){return csString.prototype.padStart.call(t.toString(16),2,"0")})),""))];case 3:return o.sent(),[2,null];case 4:return[2]}var s,a}))}))},t}(),Xi=["trackPageEvent"],Ki=["trackEventTriggerRecording"],Yi=function(){function t(t,e,r,n,i){this.configuration=t,this.commandsService=e,this.compressor=r,this.basicParameters=n,this.customEventsEmitter=i}return t.prototype.init=function(){var t=this,e=new Y(this.configuration.getTrackerUri(),"pageEvent"),r=new Wi(window.crypto);r.init(),this.pageEventService=new Hi(this.configuration,e,this.compressor,this.customEventsEmitter,r),e.setRequestParametersProviders(this.pageEventService,this.basicParameters),this.commandsService.register(Xi,(function(e){t.pageEventService.trackPageEvent(e)})),this.commandsService.register(Ki,(function(e){t.pageEventService.trackEventTriggerRecording(e)}))},t.prototype.onStartTracking=function(){this.pageEventService.start()},t}(),Ji=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},Qi=[".ctHidden, textarea"],Zi=function(){function t(t){this.configuration=t,this.piiMaskSelectors={PIISelectors:[],Attributes:[]},Li(this.configuration)||csArray.prototype.push.call(this.piiMaskSelectors.PIISelectors,"[data-cs-mask]")}return t.prototype.setPIISelectors=function(t){var e;!Li(this.configuration)&&t&&((null===(e=t.PIISelectors)||void 0===e?void 0:e.length)&&(this.piiMaskSelectors.PIISelectors=Ji(this.piiMaskSelectors.PIISelectors,t.PIISelectors)),this.piiMaskSelectors.Attributes=t.Attributes instanceof Array?Ji(t.Attributes):[])},t.prototype.initCTPII=function(){var t,e,r=this;(null===(e=null===(t=null===window||void 0===window?void 0:window.ClickTaleSettings)||void 0===t?void 0:t.DOM)||void 0===e?void 0:e.PII)&&(this.piiMaskSelectors.PIISelectors=Ji(Qi,window.ClickTaleSettings.DOM.PII.Text),csArray.prototype.map.call(window.ClickTaleSettings.DOM.PII.Attributes,(function(t){csArray.prototype.push.call(r.piiMaskSelectors.Attributes,{selector:t.rule,attrName:t.attr})})))},t.prototype.isElementMatchingSelectors=function(t,e){return csArray.prototype.some.call(e,(function(e){return R.call(t,e)}))},t.prototype.isElementMatchingAttributes=function(t,e,r){return csArray.prototype.some.call(r,(function(r){return t.hasAttribute(e)&&csString.prototype.indexOf.call(r.attrName,e)>-1&&R.call(t,r.selector)}))},t.prototype.checkAttributeMatch=function(t,e){return 0!==this.piiMaskSelectors.Attributes.length&&this.isElementMatchingAttributes(t,e,this.piiMaskSelectors.Attributes)},t.prototype.checkNodeMatch=function(t){return this.isElementMatchingSelectors(t,this.piiMaskSelectors.PIISelectors)},t}(),$i=function(){function t(t){this.commandsService=t}return t.prototype.init=function(){this.commandsService.register(["logSnippetError"],(function(t,e){St(t)&&St(e)&&Pt.error(e,"snippet-"+t)}))},t}(),to=function(){function t(t,e,r){this.configuration=t,this.iframeParentToChildrenCommunicationService=e,this.iframeEventsEmitter=r}return t.prototype.init=function(){var t=this;this.iframeParentToChildrenCommunicationService.onChildMessage((function(e,r,n,i){return t.iframeEventsEmitter.emitIframeEvent(e,r,n,i)}))},t.prototype.onStartTracking=function(){this.configuration.iframesTracking&&this.iframeParentToChildrenCommunicationService.start()},t.prototype.onOptout=function(){this.configuration.iframesTracking&&this.iframeParentToChildrenCommunicationService.stop()},t}(),eo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ro=function(t){function e(e){var r=t.call(this)||this;return r.configuration=e,r.iframes=[],r.messageHandler={boundElement:window,type:"message",listener:function(t){return r.messagesListener(t)}},r}return eo(e,t),e.prototype.onChildMessage=function(t){this.onChildMessageCallback=t},e.prototype.sendToChildren=function(t,e){var r=ft.buildBaseMessage(t,lt.Parent,this.configuration.projectId);r.content=e,this.sendMessageToChildren(r)},e.prototype.onStart=function(){ie(this.messageHandler,!1),this.discoverValidIframes()},e.prototype.onStop=function(){this.sendStopMessages(),oe(this.messageHandler,!1)},e.prototype.discoverValidIframes=function(){this.iframes=this.getAllValidIframes(),this.sendDiscoveryMessages()},e.prototype.getAllValidIframes=function(){var t=this;return csArray.prototype.filter.call(xr.findAllElements("iframe"),(function(e){return t.isIframeValid(e)}))},e.prototype.isIframeValid=function(t){return"cs-native-frame"!==t.id&&(!t.src||ut(ct(t.src),this.configuration.hostnames))},e.prototype.sendMessageToChildren=function(t){csArray.prototype.forEach.call(this.iframes,(function(e){e.contentWindow&&ft.sendMessage(e.contentWindow,"*",t)}))},e.prototype.sendDiscoveryMessages=function(){var t=this;csArray.prototype.forEach.call(this.iframes,(function(e,r){e.contentWindow&&ft.sendMessage(e.contentWindow,"*",t.buildDiscoveryMessage(r))}))},e.prototype.sendStopMessages=function(){this.sendMessageToChildren(this.buildStopMessage())},e.prototype.buildDiscoveryMessage=function(t){return ft.buildBaseMessage(ht.Discovery,lt.Parent,this.configuration.projectId,t)},e.prototype.buildStopMessage=function(){return ft.buildBaseMessage(ht.Stop,lt.Parent,this.configuration.projectId)},e.prototype.messagesListener=function(t){if(ft.isMessageValid(t,lt.Child,this.configuration.projectId,this.configuration.hostnames))if(void 0!==t.data.id||t.data.type!==ht.Discovery)if(mt(t.data.id)&&void 0!==this.iframes[t.data.id]||t.data.type===ht.ChildLogMessage){var e=this.iframes[t.data.id],r=O.getElementPath(e,{dynamicIdRegex:this.configuration.dynamicIdRegex}),n=t.data.type,i=t.data.content;this.onChildMessageCallback(e,r,n,i)}else Pt.error("Parent received data from unknown iframe : "+csJSON.stringify(t.data));else this.discoverValidIframes()},e}(me),no=function(){function t(t,e,r,n,i,o,s,a,c,u,p,l,h,f,d,y,v,g,m,S,E,b,w,C){var T=this;this.basicRequestParameters=t,this.compressor=e,this.visitorService=r,this.sessionService=n,this.lifeCycleEventsEmitter=i,this.commandsService=o,this.commandsModule=s,this.configuration=a,this.optoutModule=c,this.optoutService=u,this.consentModule=p,this.consentService=l,this.pii=h,this.urlService=f,this.projectConfigurationModule=d,this.customEventsEmitter=y,this.javaScriptErrorsTracker=v,this.javaScriptErrorsAnonymizer=g,this.apiErrorsTracker=m,this.apiErrorsAnonymizer=S,this.iframeEventsEmitter=E,this.debugService=b,this.customVariablesService=w,this.customVariablesModule=C,this.startDataCollection=function(){T.pageViewModule.start(),T.loadTracker.start()}}return t.prototype.start=function(){var t=this;if(this.optoutModule.init(),this.optoutService.init(),!this.optoutService.isActive()){var e=new Pi(this.sessionService),r=new wi(O,this.configuration),n=new Ci(r),i=new hi(this.configuration,this.visitorService,this.sessionService,r,n,this.commandsService,e,this.iframeEventsEmitter,this.debugService),o=new mn(this.commandsService,this.sessionService,this.configuration,this.basicRequestParameters,this.compressor,this.pii),s=new ro(this.configuration),a=new to(this.configuration,s,this.iframeEventsEmitter);a.init();var c=new sn(this.visitorService,this.sessionService,this.commandsService,this.iframeEventsEmitter,s),u=new In(this.configuration,this.visitorService,this.sessionService,this.commandsService,this.pii,e,this.urlService);this.pageViewModule=new bi(this.configuration,this.commandsService,this.lifeCycleEventsEmitter,this.visitorService,this.sessionService,this.consentService,this.customVariablesService,this.pii,this.urlService);var p=new Ii(this.visitorService,this.sessionService,this.commandsService),l=new Zi(this.configuration),h=new Ui(this.configuration,this.visitorService,this.sessionService,this.urlService,this.commandsService,this.startDataCollection,l),f=new Yi(this.configuration,this.commandsService,this.compressor,this.basicRequestParameters,this.customEventsEmitter),d=new $i(this.commandsService);if(this.loadTracker=new Ri,this.consentModule.init(),c.init(),o.init(),u.init(),this.customVariablesModule.init(),this.pageViewModule.init(),p.init(),h.init(),f.init(),this.projectConfigurationModule.init(),d.init(),this.lifeCycleEventsEmitter.addListeners(p,this.commandsModule,i,this.consentModule,c,this.customVariablesModule,this.pageViewModule,h,f,o,a),Zr.isSupported()&&this.compressor.isSupported()){var y=new Zr(this.sessionService,this.configuration,this.compressor,n,this.consentService,this.basicRequestParameters,this.commandsService,this.pii,e,this.urlService,l,this.javaScriptErrorsTracker,this.javaScriptErrorsAnonymizer,this.apiErrorsTracker,this.apiErrorsAnonymizer,this.debugService,this.lifeCycleEventsEmitter,this.customEventsEmitter);y.init(),this.lifeCycleEventsEmitter.addListeners(y)}if(this.configuration.eMerchandisingEnabled){var v=new xi(this.configuration,this.compressor,this.basicRequestParameters,this.customVariablesService,this.urlService,this.iframeEventsEmitter,this.commandsService);v.init(),this.lifeCycleEventsEmitter.addListeners(v)}i.init(),e.onSessionExpired((function(){t.lifeCycleEventsEmitter.emitBeforeSessionRenewal(),t.doStart(!0),t.lifeCycleEventsEmitter.emitAfterSessionRenewal()})),this.doStart()}},t.prototype.doStart=function(t){var e=this;void 0===t&&(t=!1),this.commandsService.start(),this.loadTracker.onLoad((function(){e.lifeCycleEventsEmitter.emitStartTracking()})),Li(this.configuration)&&!t||this.startDataCollection()},t}(),io=function(){function t(t,e,r,n,i,o,s,a){this.configuration=t,this.visitorService=e,this.exclusionService=r,this.outdatedState=n,this.allowSubdomainsChange=i,this.crossDomainService=o,this.crossDomainSingleIframeService=s,this.forceInclusionService=a}return t.prototype.compute=function(t){var e=this;this.configuration.crossDomainTracking&&!this.configuration.cookielessTrackingEnabled?this.configuration.crossDomainSingleIframeTracking?this.crossDomainSingleIframeService.start((function(){return e.computeState(t)})):this.crossDomainService.applyUpToDate((function(){return e.computeState(t)})):this.computeState(t)},t.prototype.computeState=function(t){this.allowSubdomainsChange.handle(),this.outdatedState.clear(),this.isIncluded()?(this.outdatedState.restoreClearedVisitor(),t(!0)):(this.exclusionService.exclude(this.configuration),t(!1))},t.prototype.isIncluded=function(){var t=j.boolean(this.configuration.sampleRate);return this.forceInclusionService.isForceIncluded()||!this.exclusionService.isExcluded()&&this.visitorService.doesVisitorExist()||!this.exclusionService.isExcluded()&&t},t}();!function(t){t.generate=function(){var t=navigator.userAgent+navigator.language+navigator.platform,e=csString.prototype.slice.call(function(t){for(var e=0,r=0;r<t.length;r+=1)e=csString.prototype.charCodeAt.call(t,r)+(e<<6)+(e<<16)-e;return Math.abs(e)}(t).toString(16),-4),r=(new csDate).getTime(),n=csString.prototype.replace.call("xxxxxxxx-hhhh-axxx-yxxx-xxxxxxxxxxxx",/[xy]/g,(function(t){var e=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===t?e:7&e|8).toString(16)}));return csString.prototype.replace.call(n,"hhhh",e)}}(qi||(qi={}));var oo,so=function(){function t(t,e,r){this.configuration=t,this.storage=e,this.sessionService=r}return t.prototype.createOrUpdateVisitor=function(){var t=this.getVisitor();null===t&&(t=this.createVisitor(),this.sessionService.removeSession()),this.updateVisitor(t),this.setVisitor(t)},t.prototype.createVisitor=function(){return{id:qi.generate(),visitsCount:0,appliedTrackingDraw:this.configuration.lastTrackingDraw,creationTimestamp:L(),lastVisitTimestamp:0,hitTimestamp:0,expires:B.now()+this.configuration.visitorCookieTimeout}},t.prototype.updateVisitor=function(t){var e=L();this.sessionService.doesSessionExist()||(t.visitsCount+=1,t.lastVisitTimestamp=e),t.hitTimestamp=e,t.appliedTrackingDraw=this.configuration.lastTrackingDraw},t.prototype.getRequestParameters=function(){var t=this.getVisitor();return t?{uu:t.id,sn:""+t.visitsCount,lv:""+t.lastVisitTimestamp,lhd:""+t.lastVisitTimestamp,hd:""+t.hitTimestamp}:{}},t.prototype.getVisitor=function(){return this.storage.get()},t.prototype.setVisitor=function(t){this.storage.set(t)},t.prototype.doesVisitorExist=function(){return null!==this.storage.get()},t.prototype.removeVisitor=function(){this.storage.remove()},t.prototype.handleSubdomainChange=function(){this.storage.handleSubdomainChange()},t}(),ao=function(){function t(t,e){this.configuration=t,this.compressor=e}return t.prototype.isCompressionSupported=function(){return this.compressor.isSupported()},t}(),co=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),uo=function(t){function e(e,r,n,i){var o=t.call(this,e,r)||this;return o.configuration=e,o.compressor=r,o.forceInclusionService=n,o.urlService=i,o}return co(e,t),e.prototype.sanitizeSessionRecordingState=function(t){return t},e.prototype.computeInitialRecordingState=function(t){return this.isCompressionSupported()&&(this.forceInclusionService.isForceLegacyReplayRecorded()||j.percentage()<this.configuration.replayRecordingRate&&Zr.isSupported())?Lt.REPLAY_RECORDING_ENABLED:Lt.REPLAY_RECORDING_DISABLED},e.prototype.updateRecordingState=function(t){return t.recordingState},e.prototype.isReplayRecorded=function(t){return t.recordingState===Lt.REPLAY_RECORDING_ENABLED||this.computeTriggerSessionReplayStatus(t)},e.prototype.computeTriggerSessionReplayStatus=function(t){if(this.configuration.triggerSessionReplayEnabled&&this.configuration.triggerSessionReplayRegex&&t.recordingState!==Lt.REPLAY_RECORDING_ENABLED){var e=this.urlService.getUrl();return this.configuration.triggerSessionReplayRegex.test(e)}return!1},e.prototype.getDisabledRecordingState=function(){return Lt.REPLAY_RECORDING_DISABLED},e.prototype.setVisitorService=function(t){},e}(ao),po=function(){function t(t,e){this.sessionStorage=t,this.recordingStateStrategy=e,this.triggerSessionReplayOngoing=!1,this.extendedSessionTimeoutId=null,this.sessionExtensionCount=0}return t.prototype.setDynamicVariablesService=function(t){this.dynamicVariablesService=t},t.prototype.createOrUpdateSession=function(){this.stopSessionExtension(),this.beginSession=B.now(),this.sessionExtensionCount=0;var t=this.getSessionWithoutCache();null===t?(t=this.buildSessionObject(),this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.computeInitialRecordingState(t)):(t=this.recordingStateStrategy.sanitizeSessionRecordingState(t),this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.updateRecordingState(t)),this.setSession(t),this.setTriggerSessionReplayStatus(t)},t.prototype.buildSessionObject=function(){return{pageNumber:0,recordingState:this.recordingStateStrategy.getDisabledRecordingState(),etrState:Vt.ETR_OFF}},t.prototype.setTriggerSessionReplayStatus=function(t){this.recordingStateStrategy instanceof uo?this.triggerSessionReplayOngoing=this.recordingStateStrategy.computeTriggerSessionReplayStatus(t):this.triggerSessionReplayOngoing=!1},t.prototype.createExtendedSession=function(){var t=this.buildSessionObject();return this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.computeInitialRecordingState(t),this.setTriggerSessionReplayStatus(t),t},t.prototype.incrementSessionPageNumber=function(t){t.pageNumber+=1},t.prototype.isReplayRecorded=function(){var t=this.getSession();return!!t&&this.recordingStateStrategy.isReplayRecorded(t)},t.prototype.isTemporarilyRecorded=function(){var t=this.getSession();return(null==t?void 0:t.recordingState)===Dt.TEMPORARILY_RECORDED},t.prototype.getRequestParameters=function(){var t={},e=this.getSession();return null!==e&&(t.pn=""+e.pageNumber,this.recordingStateStrategy instanceof uo&&(t.re=this.triggerSessionReplayOngoing?Lt.TRIGGER_REPLAY_RECORDING_ENABLED:e.recordingState)),t},t.prototype.getSession=function(){return this.sessionStorage.get()},t.prototype.getSessionWithoutCache=function(){return this.sessionStorage.get(!0)},t.prototype.doesSessionExist=function(){return null!==this.sessionStorage.get()},t.prototype.setSession=function(t){this.sessionStorage.set(t)},t.prototype.removeSession=function(){this.sessionStorage.remove()},t.prototype.getRecordingStates=function(){var t=this.getSession(),e=[];return t&&(t.recordingState!==Dt.NOT_RECORDED&&csArray.prototype.push.call(e,parseInt(t.recordingState,10)),t.etrState===Vt.ETR_ON&&csArray.prototype.push.call(e,parseInt(Dt.ETR_SAMPLING,10))),e},t.prototype.updateRecordingState=function(t,e){var r=this.getSession();null!==r&&(r.recordingState=t,r.etrState=e,this.setSession(r))},t.prototype.hasValidSession=function(){var t=this.sessionStorage.getRawSession();return this.sessionStorage.isValid(t)},t.prototype.handleSubdomainChange=function(){this.sessionStorage.handleSubdomainChange()},t.prototype.extendSessionPeriodically=function(){this.extendedSessionTimeoutId||this.extendSession()},t.prototype.extendSession=function(){if(this.hasReachedMaxDuration())this.stopSessionExtension();else{var t=this.getSession();null===t&&(t=this.createExtendedSession()),this.sessionStorage.set(t,174e4),this.sendDynamicVar(),this.scheduleNextSessionUpdate()}},t.prototype.scheduleNextSessionUpdate=function(){var t=this;this.extendedSessionTimeoutId=window.setTimeout((function(){t.extendSession()}),174e4)},t.prototype.hasReachedMaxDuration=function(){return 1434e4-(B.now()+18e5-this.beginSession)<0},t.prototype.stopSessionExtension=function(){this.extendedSessionTimeoutId&&(window.clearTimeout(this.extendedSessionTimeoutId),this.extendedSessionTimeoutId=null)},t.prototype.sendDynamicVar=function(){this.sessionExtensionCount+=1,this.dynamicVariablesService.trackDynamicVariable("session_expiry_update",this.sessionExtensionCount)},t}(),lo=function(){function t(t,e,r){this.configuration=t,this.visitorService=e,this.exclusionService=r}return t.prototype.clear=function(){this.isVisitorOutdated()&&(this.savedVisitor=this.visitorService.getVisitor(),this.visitorService.removeVisitor()),this.isExclusionOutdated()&&this.exclusionService.removeExclusion()},t.prototype.isVisitorOutdated=function(){return this.visitorService.doesVisitorExist()&&this.visitorService.getVisitor().appliedTrackingDraw!==this.configuration.lastTrackingDraw},t.prototype.isExclusionOutdated=function(){return this.exclusionService.getAppliedTrackingDraw()!==this.configuration.lastTrackingDraw},t.prototype.restoreClearedVisitor=function(){this.savedVisitor&&this.visitorService.setVisitor(this.savedVisitor)},t}(),ho=function(){function t(t,e){this.visitorService=t,this.sessionService=e}return t.prototype.handle=function(){this.handleVisitor(),this.handleSession()},t.prototype.handleVisitor=function(){this.visitorService.handleSubdomainChange()},t.prototype.handleSession=function(){this.sessionService.handleSubdomainChange()},t}(),fo=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},yo=function(){function t(){this.listeners=[]}return t.prototype.addListeners=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=csArray.prototype.push).call.apply(t,fo([this.listeners],e))},t}(),vo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),go=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return vo(e,t),e.prototype.emitBeforeNaturalPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeNaturalPageView&&r.onBeforeNaturalPageView()}},e.prototype.emitAfterNaturalPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterNaturalPageView&&r.onAfterNaturalPageView()}},e.prototype.emitInitTracking=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onInitTracking&&r.onInitTracking()}},e.prototype.emitStartTracking=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onStartTracking&&r.onStartTracking()}},e.prototype.emitBeforeArtificialPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeArtificialPageView&&r.onBeforeArtificialPageView()}},e.prototype.emitAfterArtificialPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterArtificialPageView&&r.onAfterArtificialPageView()}},e.prototype.emitBeforeSessionRenewal=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeSessionRenewal&&r.onBeforeSessionRenewal()}},e.prototype.emitAfterSessionRenewal=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterSessionRenewal&&r.onAfterSessionRenewal()}},e.prototype.emitOptout=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onOptout&&r.onOptout()}},e.prototype.emitConsentGranted=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onConsentGranted&&r.onConsentGranted()}},e.prototype.emitConsentWithdrawn=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onConsentWithdrawn&&r.onConsentWithdrawn()}},e.prototype.emitRecordingStateChange=function(t,e){for(var r=0,n=this.listeners;r<n.length;r++){var i=n[r];i.onRecordingStateChange&&i.onRecordingStateChange(t,e)}},e.prototype.emitInitialDomDone=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onInitialDomDone&&n.onInitialDomDone(t)}},e}(yo);!function(t){t[t.NOT_REQUIRED=0]="NOT_REQUIRED",t[t.NOT_EXPRESSED=1]="NOT_EXPRESSED",t[t.GRANTED=2]="GRANTED",t[t.WITHDRAWN=3]="WITHDRAWN"}(oo||(oo={}));var mo,So=function(){function t(t,e,r){this.configuration=t,this.cookieService=e,this.browserLocalStorage=r}return t.prototype.get=function(){var t;return null===(t=this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.getItem("_cs_c"):this.cookieService.get("_cs_c"))?t:Number(t)},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.setItem("_cs_c",csString(t)):this.cookieService.set("_cs_c",csString(t),34164e6)},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.removeItem("_cs_c"):this.cookieService.delete("_cs_c")},t.prototype.handleSubdomainChange=function(){this.configuration.cookielessTrackingEnabled||(this.configuration.allowSubdomains?this.cookieService.delete("_cs_c",Ot.CURRENT_DOMAIN):this.cookieService.delete("_cs_c",this.cookieService.getRootDomain()))},t}(),Eo=["trackConsentGranted"],bo=["trackConsentWithdrawn"],wo=function(){function t(t,e){this.commandsService=t,this.service=e}return t.prototype.init=function(){this.service.handleSubdomainChange(),this.service.setInitialConsent(),this.registerCommands()},t.prototype.registerCommands=function(){var t=this;this.commandsService.register(Eo,(function(){t.service.grantConsent()})),this.commandsService.register(bo,(function(){t.service.withdrawConsent()}))},t.prototype.onOptout=function(){this.service.removeConsent()},t}(),Co=function(){function t(t,e,r){this.configuration=t,this.storage=e,this.lifeCycleEventsEmitter=r}return t.prototype.setInitialConsent=function(){var t=this.storage.get();(null===t||this.hasConsentRequiredChanged(t))&&this.setDefault()},t.prototype.hasConsentRequiredChanged=function(t){var e=this.configuration.consentRequired;return e&&t===oo.NOT_REQUIRED||!e&&t!==oo.NOT_REQUIRED},t.prototype.handleSubdomainChange=function(){this.storage.handleSubdomainChange()},t.prototype.setDefault=function(){var t=this.configuration.consentRequired?oo.NOT_EXPRESSED:oo.NOT_REQUIRED;this.storage.set(t)},t.prototype.grantConsent=function(){this.configuration.consentRequired&&(this.storage.set(oo.GRANTED),this.lifeCycleEventsEmitter.emitConsentGranted())},t.prototype.withdrawConsent=function(){this.configuration.consentRequired&&(this.storage.set(oo.WITHDRAWN),this.lifeCycleEventsEmitter.emitConsentWithdrawn())},t.prototype.removeConsent=function(){this.storage.remove()},t.prototype.isAllowedByConsent=function(){return!this.configuration.consentRequired||this.storage.get()===oo.GRANTED},t.prototype.getRequestParameters=function(){return{uc:""+this.storage.get()}},t}(),To=function(){function t(t,e,r,n,i,o,s){this.lifeCycleEventsEmitter=t,this.commandsService=e,this.commandsModule=r,this.optoutModule=n,this.optoutService=i,this.exclusionModule=o,this.consentModule=s}return t.prototype.start=function(){this.lifeCycleEventsEmitter.addListeners(this.exclusionModule,this.consentModule,this.commandsModule),this.consentModule.init(),this.optoutModule.init(),this.optoutService.init(),this.optoutService.isActive()||this.commandsService.start()},t}(),Ro=function(){function t(t,e){this.location=t,this.storage=e}return t.prototype.exclude=function(t){this.storage.set(csString(t.lastTrackingDraw))},t.prototype.removeExclusion=function(){this.storage.remove()},t.prototype.isExcluded=function(){return this.hasExclusionInStorage()||this.hasExclusionInURL()},t.prototype.hasExclusionInStorage=function(){return 0!==this.getAppliedTrackingDraw()},t.prototype.getAppliedTrackingDraw=function(){return this.storage.get()},t.prototype.hasExclusionInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_ex")>0},t}(),Ao=function(){function t(t){this.service=t}return t.prototype.onOptout=function(){this.service.removeExclusion()},t}(),ko=function(){function t(t,e){this.location=t,this.cookieService=e}return t.prototype.isForceIncluded=function(){return this.hasForceInclusionCookie()||this.hasForceInclusionInURL()},t.prototype.isForceLegacyReplayRecorded=function(){return this.hasForceInclusionCookieValue(Lt.REPLAY_RECORDING_ENABLED)||this.hasForceInclusionValueInURL(Lt.REPLAY_RECORDING_ENABLED)},t.prototype.isForceMalkaReplayRecorded=function(){return this.hasForceInclusionCookieValue(Dt.GLOBAL_SAMPLING)},t.prototype.hasForceInclusionCookie=function(){return null!==this.cookieService.get("_cs_inc")},t.prototype.hasForceInclusionCookieValue=function(t){return this.cookieService.get("_cs_inc")===t},t.prototype.hasForceInclusionInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_inc")>0},t.prototype.hasForceInclusionValueInURL=function(t){return csString.prototype.indexOf.call(this.location.href,"_cs_inc="+t)>0},t}(),Io=function(){return(Io=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Po=function(){function t(){this.metrics={}}return t.prototype.start=function(t,e){void 0===e&&(e=B.now());var r=this.metrics[t];this.metrics[t]=r&&r.startedAt?r:Io(Io({},r),{startedAt:e})},t.prototype.stop=function(t,e){void 0===e&&(e=B.now());var r=this.metrics[t];this.metrics[t]=r&&r.stoppedAt?r:Io(Io({},r),{stoppedAt:e}),this.onStopCallback(t,this.metrics[t])},t.prototype.onStop=function(t){this.onStopCallback=t},t}(),_o=function(){function t(){}return t.prototype.getRequestParameters=function(){var t=window.location;return{pr:t.protocol,ho:t.hostname,pa:t.pathname,qu:t.search,ha:t.hash}},t}(),Oo=function(){function t(t,e){this.configuration=t,this.request=e,this.isLoggingActive=!1}return t.prototype.init=function(){this.isLoggingActive=j.boolean(this.configuration.metricRate)},t.prototype.getRequestParameters=function(){return{a:"uxam",mk:this.metricKey,mv:""+this.metricValue}},t.prototype.logMetric=function(t,e){this.metricKey=t,this.metricValue=e.stoppedAt-e.startedAt,this.sendLog()},t.prototype.sendLog=function(){this.isLoggingActive&&this.request.send()},t}();!function(t){t.TIME_BEFORE_EXECUTION="TimeBeforeExecution",t.PAGE_LOAD="PageLoad"}(mo||(mo={}));var No,xo=function(){function t(t,e,r){this.service=e,this.pii=r,this.locationRequestParameters=new _o,this.basicLogRequestParameters=new it(t,this.pii),this.request=new Y(t.getLoggerUri()),this.logger=new Oo(t,this.request)}return t.prototype.init=function(){var t=this;this.request.setRequestParametersProviders(this.basicLogRequestParameters,this.locationRequestParameters),this.logger.init(),this.service.onStop((function(e,r){t.logger.logMetric(e,r)})),this.recordInitialMetrics()},t.prototype.recordInitialMetrics=function(){this.isSupported()&&(this.service.start(mo.PAGE_LOAD,window.performance.timing.navigationStart),this.service.stop(mo.PAGE_LOAD,window.performance.timing.domContentLoadedEventEnd),this.service.start(mo.TIME_BEFORE_EXECUTION,window.performance.timing.domContentLoadedEventEnd),this.service.stop(mo.TIME_BEFORE_EXECUTION))},t.prototype.isSupported=function(){return window.performance&&window.performance.timing},t}(),Mo=function(){function t(t,e,r){this.configuration=t,this.cookieService=e,this.browserLocalStorage=r}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.getItem("_cs_optout"):this.cookieService.get("_cs_optout")},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.setItem("_cs_optout",t):this.cookieService.set("_cs_optout",t,34164e6)},t}(),Lo=function(){function t(t,e,r){this.lifeCycleEventsEmitter=t,this.location=e,this.storage=r}return t.prototype.init=function(){!this.isActive()&&this.hasOptoutInURL()&&this.activate()},t.prototype.isActive=function(){return"1"===this.storage.get()},t.prototype.activate=function(){this.lifeCycleEventsEmitter.emitOptout(),this.storage.set("1")},t.prototype.hasOptoutInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_optout")>0},t}(),Do=["optout"],Vo=function(){function t(t,e){this.commandsService=t,this.optoutService=e}return t.prototype.init=function(){var t=this;this.commandsService.register(Do,(function(){t.optoutService.activate()}))},t}();function qo(t,e){return e.visitor.visitsCount!==t.visitor.visitsCount?e.visitor.visitsCount-t.visitor.visitsCount:t.session?e.session?e.session.pageNumber-t.session.pageNumber:-1:1}!function(t){t.select=function(t,e){var r=function(t,e){return csArray.prototype.filter.call(t,(function(t){return t.exclusion===e}))[0]}(t,e),n=function(t,e){return csArray.prototype.sort.call(csArray.prototype.filter.call(t,(function(t){return function(t,e){return t.visitor&&t.visitor.appliedTrackingDraw===e}(t,e)})),qo)[0]}(t,e);return r||n}}(No||(No={}));var Uo=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},zo=function(){function t(t,e,r){this.configuration=t,this.currentDomainState=e,this.otherDomainStates=r}return t.prototype.applyUpToDate=function(t){var e=this;this.otherDomainStates.retrieve(this.configuration.hostnames,(function(r){var n=Uo([e.currentDomainState.get()],r),i=No.select(n,e.configuration.lastTrackingDraw);e.currentDomainState.apply(i),t()}))},t}(),jo=function(){function t(t,e){this.commandsService=t,this.iframeEventsEmitter=e}return t.prototype.init=function(){this.iframeEventsEmitter.addListeners(this.commandsService)},t.prototype.onOptout=function(){this.commandsService.stop()},t.prototype.onBeforeSessionRenewal=function(){this.commandsService.stop()},t}();var Bo,Ho=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fo=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Go=function(t){function e(){var e=t.call(this)||this;return e.registry={},e}return Ho(e,t),e.prototype.register=function(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r];this.registry[i]=e,this.registry}},e.prototype.onStart=function(){this.applyPending(),this.enableImmediateApplication()},e.prototype.onStop=function(){window._uxa=[]},e.prototype.onIframeCommands=function(t){for(var e=0,r=t.commands;e<r.length;e++){var n=r[e];this.applyFromIframe(n.name,n.params,t.iframePath)}},e.prototype.applyFromIframe=function(t,e,r){var n=this;Pt.tryToExecute("Commands.apply.from.iframe: "+r,(function(){var r;if(n.registry[t])return(r=n.registry)[t].apply(r,e)}))()},e.prototype.applyPending=function(){var t=this;window._uxa.forEach((function(e){var r=e[0],n=e.slice(1);return t.apply(r,n)}))},e.prototype.enableImmediateApplication=function(){var t=this;window._uxa={push:function(e){var r=e[0],n=e.slice(1);return t.apply(r,n)}}},e.prototype.apply=function(t,e){var r;if(this.registry[t])return(r=this.registry)[t].apply(r,e)},Fo([_t("Commands.apply")],e.prototype,"apply",null),e}(me),Wo=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Xo=function(){function t(){var t=this;this.eventHandler={boundElement:document,type:"securitypolicyviolation",listener:function(e){return t.securityPolicyViolationListener(e)}}}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){ie(this.eventHandler)},t.prototype.stop=function(){oe(this.eventHandler)},t.prototype.isSecurityErrorRelevant=function(e){if(!e)return!1;var r=e.disposition;return St(e.sourceFile)&&csArray.prototype.some.call(t.whilelistDomains,(function(t){return csString.prototype.indexOf.call(e.sourceFile,t)>0}))&&"report"!==r},t.prototype.securityPolicyViolationListener=function(t){this.isSecurityErrorRelevant(t)&&this.onEventCallback({violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})},t.whilelistDomains=["contentsquare","localhost","website.com/build/e2e"],Wo([_t("Event handler type: securitypolicyviolation")],t.prototype,"securityPolicyViolationListener",null),t}(),Ko=function(){function t(t){this.contentSecurityPolicyErrorsTracker=t}return t.prototype.init=function(){var t=this;this.contentSecurityPolicyErrorsTracker.onEvent((function(e){return t.processEvent(e)}))},t.prototype.start=function(){this.contentSecurityPolicyErrorsTracker.start()},t.prototype.stop=function(){this.contentSecurityPolicyErrorsTracker.stop()},t.prototype.processEvent=function(t){var e="Content Security Policy error. Violated directive: "+t.violatedDirective+" - Source file: "+t.sourceFile;Pt.warn(e)},t}(),Yo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jo=function(t){function e(e,r,n,i,o){var s=t.call(this)||this;return s.javaScriptErrorsTracker=e,s.javaScriptErrorsRequest=r,s.basicRequestParameters=n,s.javaScriptErrorsAnonymizer=i,s.customEventEmitter=o,s.javaScriptErrorsBatch=[],s.javaScriptErrorsCount=0,s.customErrorsBuffer=[],s}return Yo(e,t),e.prototype.init=function(){var t=this;this.javaScriptErrorsTracker.onEvent((function(e){return t.processEvent(e)})),this.bindRequest()},e.prototype.initStates=function(){this.startTime=B.now(),this.javaScriptErrorsBatch=[],this.javaScriptErrorsCount=0},e.prototype.onStart=function(){this.javaScriptErrorsTracker.start(),this.processCustomErrorsInBuffer()},e.prototype.onStop=function(){this.javaScriptErrorsTracker.stop()},e.prototype.getRequestPayload=function(){return csJSON.stringify({errors:this.javaScriptErrorsBatch})},e.prototype.onIframeJavascriptError=function(t){this.processEvent(t)},e.prototype.trackCustomError=function(t){var e={errorType:"jsError",message:"Custom Error: "+t,lineno:1,colno:1,filename:"https://cserror.com/texterror.js"};this.processCustomErrorEvent(e)},e.prototype.processCustomErrorEvent=function(t){this.isStarted?(this.processEvent(t),this.customEventEmitter.emitCustomErrorEvent(t)):csArray.prototype.push.call(this.customErrorsBuffer,t)},e.prototype.processCustomErrorsInBuffer=function(){var t=this;this.isStarted&&(csArray.prototype.forEach.call(this.customErrorsBuffer,(function(e){return t.processCustomErrorEvent(e)})),this.customErrorsBuffer=[])},e.prototype.processEvent=function(t){this.isStarted&&this.javaScriptErrorsCount<20&&(this.javaScriptErrorsAnonymizer.anonymize(t),t.rt=this.getRelativeTime(),csArray.prototype.push.call(this.javaScriptErrorsBatch,t),this.sendErrors())},e.prototype.bindRequest=function(){var t=this;this.javaScriptErrorsRequest.setRequestParametersProviders(this.basicRequestParameters),this.javaScriptErrorsRequest.setRequestPayloadProvider(this),this.javaScriptErrorsRequest.after((function(){t.javaScriptErrorsBatch=[],t.javaScriptErrorsCount+=1}))},e.prototype.getRelativeTime=function(){return B.now()-this.startTime},e.prototype.sendErrors=function(){this.javaScriptErrorsRequest.send()},e}(me),Qo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zo=function(t){function e(e,r,n,i){var o=t.call(this)||this;return o.apiErrorsTracker=e,o.apiErrorsRequest=r,o.basicRequestParameters=n,o.apiErrorsAnonymizer=i,o.apiErrorsBatch=[],o.apiErrorsCount=0,o}return Qo(e,t),e.prototype.init=function(){var t=this;this.apiErrorsTracker.init(),this.apiErrorsTracker.onEvent((function(e){return t.processEvent(e)})),this.bindRequest()},e.prototype.initStates=function(){this.apiErrorsBatch=[],this.apiErrorsCount=0},e.prototype.onStart=function(){this.apiErrorsTracker.start()},e.prototype.onStop=function(){this.apiErrorsTracker.stop()},e.prototype.getRequestPayload=function(){return csJSON.stringify({errors:this.apiErrorsBatch})},e.prototype.onIframeApiError=function(t){this.processEvent(t)},e.prototype.processEvent=function(t){this.isStarted&&this.apiErrorsCount<e.MAX_ERRORS&&(csArray.prototype.push.call(this.apiErrorsBatch,this.apiErrorsAnonymizer.anonymize(t)),this.sendErrors())},e.prototype.bindRequest=function(){var t=this;this.apiErrorsRequest.setRequestParametersProviders(this.basicRequestParameters),this.apiErrorsRequest.setRequestPayloadProvider(this),this.apiErrorsRequest.after((function(){t.apiErrorsBatch=[],t.apiErrorsCount+=1}))},e.prototype.sendErrors=function(){this.apiErrorsRequest.send()},e.MAX_ERRORS=20,e}(me);!function(t){t.CONTENTSQUARE="contentsquare.net",t.CLICKTALE="clicktale.net",t.FAKE_TRACKER="fake-tracker.content-square.fr"}(Bo||(Bo={}));var $o,ts=["trackError"],es=["api-errors:maskUrl"],rs=function(){function t(t,e,r,n,i,o,s,a,c){this.javaScriptErrorsTracker=t,this.javaScriptErrorsAnonymizer=e,this.apiErrorsTracker=r,this.apiErrorsAnonymizer=n,this.configuration=i,this.basicRequestParameters=o,this.iframeEventsEmitter=s,this.commandsService=a,this.customEventEmitter=c}return t.prototype.init=function(){this.contentSecurityPolicyErrorsService=new Ko(new Xo),this.contentSecurityPolicyErrorsService.init();var t=new ne(this.configuration.getTrackerUri(),"errors");this.javaScriptErrorsService=new Jo(this.javaScriptErrorsTracker,t,this.basicRequestParameters,this.javaScriptErrorsAnonymizer,this.customEventEmitter),this.javaScriptErrorsService.init(),this.iframeEventsEmitter.addListeners(this.javaScriptErrorsService);var e=new ne(this.configuration.getTrackerUri(),"api-errors");this.apiErrorsTracker.excludeDomains([Bo.CONTENTSQUARE,Bo.CLICKTALE,Bo.FAKE_TRACKER]),this.apiErrorsService=new Zo(this.apiErrorsTracker,e,this.basicRequestParameters,this.apiErrorsAnonymizer),this.apiErrorsService.init(),this.iframeEventsEmitter.addListeners(this.apiErrorsService),this.registerCommands()},t.prototype.registerCommands=function(){var t=this;this.commandsService.register(es,(function(e){return t.apiErrorsAnonymizer.addUrlMaskingPattern(e)})),this.commandsService.register(ts,(function(e){return t.javaScriptErrorsService.trackCustomError(e)}))},t.prototype.onInitTracking=function(){this.contentSecurityPolicyErrorsService.start()},t.prototype.onStartTracking=function(){this.configuration.jsErrorsEnabled&&this.javaScriptErrorsService.start(),this.configuration.apiErrorsEnabled&&this.apiErrorsService.start()},t.prototype.onAfterNaturalPageView=function(){this.javaScriptErrorsService.initStates(),this.apiErrorsService.initStates()},t.prototype.onAfterArtificialPageView=function(){this.javaScriptErrorsService.initStates(),this.apiErrorsService.initStates()},t.prototype.onBeforeSessionRenewal=function(){this.javaScriptErrorsService.stop(),this.apiErrorsService.stop()},t.prototype.onOptout=function(){this.contentSecurityPolicyErrorsService.stop(),this.javaScriptErrorsService.stop(),this.apiErrorsService.stop()},t}(),ns=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s};!function(t){t.Set="set",t.Remove="remove"}($o||($o={}));var is=function(){function t(t,e){this.configuration=t,this.cookieService=e,this.sameSite=kt.None,this.isActivated=!1,this.setCookieBatch=[],this.removeCookieBatch=[]}return t.prototype.init=function(){this.sameSite=this.cookieService.isSameSiteSupported()?kt.None:kt.NotSet},t.prototype.setStates=function(t,e){this.currentDomainState=t,this.iframeDomainState=e},t.prototype.start=function(t){var e=this;this.iframeDomainState.init(this.getIframeDomain(),(function(r,n){var i=[e.currentDomainState.get()];n&&csArray.prototype.push.call(i,r);var o=No.select(i,e.configuration.lastTrackingDraw);e.isActivated=!0,e.currentDomainState.apply(o),t()})),this.iframe=this.iframeDomainState.openIframe()},t.prototype.setCookie=function(t,e,r){if(this.isActivated){var n={name:t,value:e,samesite:this.sameSite,secure:It.Yes};r&&(n.expires=Rt.toExpireDate(r).getTime()),this.addToSetCookieBatch(n)}},t.prototype.removeCookie=function(t){this.isActivated&&this.addToRemoveCookieBatch(t)},t.prototype.addToRemoveCookieBatch=function(t){this.removeCookieBatch=csArray.prototype.filter.call(this.removeCookieBatch,(function(e){return e!==t})),this.setCookieBatch=csArray.prototype.filter.call(this.setCookieBatch,(function(e){return e.name!==t})),csArray.prototype.push.call(this.removeCookieBatch,t),this.setBatchReadyCall()},t.prototype.addToSetCookieBatch=function(t){this.removeCookieBatch=csArray.prototype.filter.call(this.removeCookieBatch,(function(e){return e!==t.name})),this.setCookieBatch=csArray.prototype.filter.call(this.setCookieBatch,(function(e){return e.name!==t.name})),csArray.prototype.push.call(this.setCookieBatch,t),this.setBatchReadyCall()},t.prototype.setBatchReadyCall=function(){this.sendMessagesBatchs()},t.prototype.sendMessagesBatchs=function(){if(this.setCookieBatch.length>0){var t=this.buildMessage($o.Set,this.setCookieBatch);this.sendMessage(t),this.setCookieBatch=[]}if(this.removeCookieBatch.length>0){var e=this.buildMessage($o.Remove,this.removeCookieBatch);this.sendMessage(e),this.removeCookieBatch=[]}},t.prototype.buildMessage=function(t,e){return{command:t,cookies:e,domain:null,pid:this.configuration.projectId}},t.prototype.sendMessage=function(t){var e="https://"+this.getIframeDomain();this.iframe.contentWindow&&this.iframe.contentWindow.postMessage(t,e)},t.prototype.getIframeDomain=function(){return this.configuration.dualCollectionTagDomain&&"contentsquare.net"!==this.configuration.dualCollectionTagDomain?"cdnssl."+this.configuration.dualCollectionTagDomain:"csxd.contentsquare.net"},ns([dn(),_t("send xdframe-single-iframe batch")],t.prototype,"setBatchReadyCall",null),t}(),os=["_cs_id","_cs_s","_cs_cvars","_cs_ex"],ss=function(){function t(t,e){this.configuration=t,this.xdframeOpener=e}return t.prototype.init=function(t,e){this.xdframeOrigin="https://"+t,this.callback=e},t.prototype.openIframe=function(){var t=this;this.xdframeOpener.onMessage((function(e){t.handleXdframeMessage(e)})),this.xdframeOpener.onTimeout((function(){t.handleTimeout()})),this.xdframeOpener.start();var e=this.getXdframeUrl(this.xdframeOrigin);return this.xdframeOpener.open(e)},t.prototype.handleXdframeMessage=function(t){if(this.isXdframeMessage(t)){var e=t.data,r=!0;if(this.isXdframeErrorMessage(t))return void Pt.warn("Error xdframe single domain: "+csJSON.stringify(t.data)+" from "+t.origin);if(!Xt.isRawDomainState(e))return void Pt.warn("Unknown message format from xdframe single domain: "+csJSON.stringify(t.data)+" from "+t.origin);Xt.isValid(e)||(Pt.warn("Invalid xdframe single domain state: "+csJSON.stringify(t.data)+" from "+t.origin),r=!1),this.xdframeOpener.stop(),this.callback(r?Gt.fromRaw(e):{},r)}},t.prototype.handleTimeout=function(){Pt.warn("xdframe single domain: all messages not received")},t.prototype.isXdframeMessage=function(t){return t.origin===this.xdframeOrigin&&Et(t.data)},t.prototype.isXdframeErrorMessage=function(t){return!!t.data.error},t.prototype.getXdframeUrl=function(t){var e=csArray.prototype.join.call(os,",");return t+"/uxa/xdframe-single-domain-1.1.0.html?pid="+this.configuration.projectId+"&cookieNames="+e},t}(),as=function(){return(as=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},cs=function(){function t(t,e,r){this.configuration=t,this.visitorService=e,this.sessionService=r}return t.prototype.getRequestParameters=function(){if(!this.visitorService.doesVisitorExist()||!this.sessionService.doesSessionExist())return{};var t=this.visitorService.getVisitor();return as(as(as({},{v:"11.3.0"}),this.configuration.getRequestParameters()),{uu:t.id,sn:""+t.visitsCount,pn:""+this.sessionService.getSession().pageNumber})},t}(),us=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},ps=function(){function t(){var t=this;this.isStarted=!1,this.onEventCallbacks=[],this.useCapture=!1,this.eventHandler={boundElement:window,type:"error",listener:function(e){return t.errorListener(e)}}}return t.prototype.onEvent=function(t){csArray.prototype.push.call(this.onEventCallbacks,t)},t.prototype.start=function(){this.isStarted||(ie(this.eventHandler,this.useCapture),this.isStarted=!0)},t.prototype.stop=function(){this.isStarted&&(oe(this.eventHandler,this.useCapture),this.isStarted=!1)},t.prototype.errorListener=function(t){var e=this.buildJavaScriptError(t);csArray.prototype.forEach.call(this.onEventCallbacks,(function(t){return t(e)}))},t.prototype.decorateErrorMessage=function(e){return e.length<=t.MAX_ERROR_MESSAGE_LENGTH?e:csString.prototype.slice.call(e,0,t.MAX_ERROR_MESSAGE_LENGTH-t.truncatedErrorMessageMarker.length)+t.truncatedErrorMessageMarker},t.prototype.buildJavaScriptError=function(t){return{errorType:"jsError",message:this.decorateErrorMessage(t.message),filename:t.filename,lineno:t.lineno,colno:t.colno}},t.truncatedErrorMessageMarker="",t.MAX_ERROR_MESSAGE_LENGTH=1024,us([_t("Event handler type: error")],t.prototype,"errorListener",null),t}(),ls=function(){function t(t,e){this.commandsService=t,this.projectConfiguration=e}return t.prototype.init=function(){var t=this;this.commandsService.register(["debugEvents"],(function(e){"boolean"==typeof e&&t.projectConfiguration.updateDynamicFields("emitDebugEvents",e)}))},t}();function hs(t,e,r){if(!bt(e)&&!bt(r))return t.href;var n=bt(e)?function(t){return V(t,"/")?t:"/"+t}(e):t.pathname,i=bt(r)?function(t){return V(t,"?")||""===t?t:"?"+t}(r):t.search;return t.protocol+"//"+t.host+n+i}var fs,ds,ys=function(){function t(t,e){this.location=t,this.pii=e}return t.prototype.overridePath=function(t){bt(t)&&St(t)&&(this.path=""===t?void 0:t)},t.prototype.overrideQuery=function(t){bt(t)&&St(t)&&(this.query=t)},t.prototype.computeOverriddenUrl=function(t){return this.isCurrentPageUrl(t)?this.getUrl():t},t.prototype.isCurrentPageUrl=function(t){var e=this.normalizeUrl(this.location.href);return this.normalizeUrl(t)===e},t.prototype.normalizeUrl=function(t){return q(t,"/")?csString.prototype.slice.call(t,0,-1):t},t.prototype.getUrl=function(){return hs(this.location,this.path,this.query)},t.prototype.getUrlProtocol=function(){return this.location.protocol},t.prototype.getRequestParameters=function(){var t=this.getUrl();return{url:this.pii.anonymize(t)}},t}(),vs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return vs(e,t),e.prototype.emitPageEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onPageEvent&&n.onPageEvent(t)}},e.prototype.emitEventTriggerRecording=function(t,e){for(var r=0,n=this.listeners;r<n.length;r++){var i=n[r];i.onEventTriggerRecording&&i.onEventTriggerRecording(t,e)}},e.prototype.emitCustomErrorEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onCustomErrorEvent&&n.onCustomErrorEvent(t)}},e}(yo),ms=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ss=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Es=function(t){function e(e,r,n,i,o,s){var a=t.call(this,e,r)||this;return a.configuration=e,a.compressor=r,a.quotaServiceRequest=n,a.lifeCycleEventsEmitter=i,a.forceInclusionService=o,a.urlService=s,a.requestedRecordingTypes=[],a}return ms(e,t),e.prototype.init=function(){this.bindQuotaServiceRequest()},e.prototype.sanitizeSessionRecordingState=function(t){return t.recordingState===Dt.TEMPORARILY_RECORDED&&(t.recordingState=Dt.NOT_RECORDED),t},e.prototype.computeInitialRecordingState=function(t){return this.isCompressionSupported()&&Zr.isSupported()?(this.requestedRecordingTypes=[],j.percentage()<this.configuration.replayRecordingRate||this.forceInclusionService.isForceMalkaReplayRecorded()?csArray.prototype.push.call(this.requestedRecordingTypes,parseInt(Dt.GLOBAL_SAMPLING,10)):this.configuration.malkaUrlEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,parseInt(Dt.URL_SAMPLING,10)),this.configuration.malkaEtrEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,parseInt(Dt.ETR_SAMPLING,10)),this.requestedRecordingTypes.length>0?(this.sendSamplingRequest(t),Dt.TEMPORARILY_RECORDED):Dt.NOT_RECORDED):Dt.NOT_RECORDED},e.prototype.updateRecordingState=function(t){return this.isCompressionSupported()&&Zr.isSupported()?t.recordingState===Dt.GLOBAL_SAMPLING?Dt.GLOBAL_SAMPLING:(this.requestedRecordingTypes=[],this.configuration.malkaUrlEnabled&&(csArray.prototype.push.call(this.requestedRecordingTypes,parseInt(Dt.URL_SAMPLING,10)),this.configuration.malkaEtrEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,parseInt(Dt.ETR_SAMPLING,10))),this.requestedRecordingTypes.length>0?(this.sendSamplingRequest(t),Dt.TEMPORARILY_RECORDED):Dt.NOT_RECORDED):Dt.NOT_RECORDED},e.prototype.sendSamplingRequest=function(t){var e,r=this,n=null===(e=this.visitorService)||void 0===e?void 0:e.getVisitor();this.quotaServiceRequest.setRequestPayloadProvider({getRequestPayload:function(){return csJSON.stringify({recordingTypes:r.requestedRecordingTypes,url:r.urlService.getUrl(),projectId:r.configuration.projectId,uu:(null==n?void 0:n.id)||"",sn:(null==n?void 0:n.visitsCount)||"",pn:(null==t?void 0:t.pageNumber)||""})}}),this.quotaServiceRequest.send()},e.prototype.isReplayRecorded=function(t){return t.recordingState===Dt.TEMPORARILY_RECORDED||t.recordingState===Dt.GLOBAL_SAMPLING||t.recordingState===Dt.URL_SAMPLING||t.etrState===Vt.ETR_ON},e.prototype.bindQuotaServiceRequest=function(){var t=this;this.quotaServiceRequest.setRequestHeader({name:"Content-Type",value:"application/json"}),this.quotaServiceRequest.onError((function(){return t.quotaServiceErrorHandler("NetworkError")})),this.quotaServiceRequest.onTimeout(3e3,(function(){return t.quotaServiceTimeoutHandler()})),this.quotaServiceRequest.onLoad((function(e){return t.quotaServiceLoadHandler(e)}))},e.prototype.quotaServiceErrorHandler=function(t){this.emitRecordingStateOnError(),Pt.warn("Quota Service: request error - "+t)},e.prototype.quotaServiceTimeoutHandler=function(){this.emitRecordingStateOnError(),Pt.warn("Quota Service: request timeout")},e.prototype.emitRecordingStateOnError=function(){var t=Dt.NOT_RECORDED;this.isGlobalSamplingAllowed(this.requestedRecordingTypes)&&(t=Dt.GLOBAL_SAMPLING),this.lifeCycleEventsEmitter.emitRecordingStateChange(t,Vt.ETR_OFF)},e.prototype.quotaServiceLoadHandler=function(t){if(200===t.status){var e;try{e=csJSON.parse(t.responseText)}catch(e){return void this.quotaServiceErrorHandler("Unable to parse the quota service response: "+t.responseText)}var r=e.allowedRecordingTypes;if(r){var n=Vt.ETR_OFF,i=Dt.NOT_RECORDED;this.isGlobalSamplingAllowed(r)?i=Dt.GLOBAL_SAMPLING:this.isUrlSamplingAllowed(r)&&(i=Dt.URL_SAMPLING),this.isEtrSamplingAllowed(r)&&(n=Vt.ETR_ON),this.lifeCycleEventsEmitter.emitRecordingStateChange(i,n)}else this.quotaServiceErrorHandler("recording types missing from quota service response")}else this.quotaServiceErrorHandler("Status code: "+t.status)},e.prototype.isGlobalSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===parseInt(Dt.GLOBAL_SAMPLING,10)}))},e.prototype.isUrlSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===parseInt(Dt.URL_SAMPLING,10)}))},e.prototype.isEtrSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===parseInt(Dt.ETR_SAMPLING,10)}))},e.prototype.setVisitorService=function(t){this.visitorService=t},e.prototype.getDisabledRecordingState=function(){return Dt.NOT_RECORDED},Ss([_t("Quota Service: onerror")],e.prototype,"quotaServiceErrorHandler",null),Ss([_t("Quota Service: ontimeout")],e.prototype,"quotaServiceTimeoutHandler",null),Ss([_t("Quota Service: onload")],e.prototype,"quotaServiceLoadHandler",null),e}(ao),bs=function(){this.isStarted=!1},ws=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cs=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},Ts=function(t){function e(e,r){var n=t.call(this)||this;return n.xhrRequestTracker=e,n.fetchRequestTracker=r,n.onEventCallbacks=[],n.excludedDomains=[],n}return ws(e,t),e.prototype.init=function(){var t=this;this.xhrRequestTracker.onEvent((function(e){return t.apiErrorListener(e)})),this.fetchRequestTracker.onEvent((function(e){return t.apiErrorListener(e)}))},e.prototype.onEvent=function(t){csArray.prototype.push.call(this.onEventCallbacks,t)},e.prototype.start=function(){this.isStarted||(this.xhrRequestTracker.start(),this.fetchRequestTracker.start(),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(this.xhrRequestTracker.stop(),this.fetchRequestTracker.stop(),this.isStarted=!1)},e.prototype.apiErrorListener=function(t){if(t.url&&t.statusCode){if(t.url=at(t.url),csArray.prototype.some.call(this.excludedDomains,(function(e){return-1!==csString.prototype.indexOf.call(t.url,e)})))return;if(t.statusCode>=400){var e=this.buildApiError(t);csArray.prototype.forEach.call(this.onEventCallbacks,(function(t){return t(e)}))}}},e.prototype.buildApiError=function(t){return{errorType:"apiError",url:t.url,method:t.method,requestTime:t.requestTime,responseTime:t.responseTime,statusCode:t.statusCode,library:t.library}},e.prototype.excludeDomains=function(t){var e;(e=csArray.prototype.push).call.apply(e,Cs([this.excludedDomains],t))},e.truncatedErrorMessageMarker="",e}(bs),Rs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),As=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},ks=function(t){function e(e){var r=t.call(this)||this;return r.monkeyPatcher=e,r.callbacks=[],r.openHook=function(t){var e=t.context,n=t.args,i=t.callerName;return r.interceptOpen(e,n,i)},r}return Rs(e,t),e.prototype.onEvent=function(t){csArray.prototype.push.call(this.callbacks,t)},e.prototype.start=function(){this.isStarted||(this.createInterceptors(),this.openInterceptor&&this.openInterceptor.activate(),this.isStarted=!0)},e.prototype.createInterceptors=function(){this.openInterceptor||(this.openInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:XMLHttpRequest.prototype,methodName:"open",hook:this.openHook,options:{withCallerName:!0}}))},e.prototype.stop=function(){this.isStarted&&(this.openInterceptor&&this.openInterceptor.deactivate(),this.isStarted=!1)},e.prototype.interceptOpen=function(t,e,r){var n=this;t.apiCall={url:e[1],method:e[0],requestTime:B.now(),responseTime:0,statusCode:0},t.apiCall.library=r,t.addEventListener("readystatechange",(function(){return n.readyStateChangeListener(t)}))},e.prototype.readyStateChangeListener=function(t){t.readyState===XMLHttpRequest.DONE&&(t.apiCall.responseTime=B.now(),t.apiCall.statusCode=t.status,csArray.prototype.forEach.call(this.callbacks,(function(e){return e(t.apiCall)})))},As([_t("XhrRequestTracker.interceptOpen")],e.prototype,"interceptOpen",null),As([_t("XhrRequestTracker.readyStateChangeListener")],e.prototype,"readyStateChangeListener",null),e}(bs),Is=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ps=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},_s=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},Os=function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Ns=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)n[i]=o[s];return n},xs=function(t){function e(e){var r=t.call(this)||this;return r.monkeyPatcher=e,r.callbacks=[],r.hook=function(t){var e=t.result,n=t.args,i=t.callerName;r.interceptFetch(e,n,i)},r}return Is(e,t),e.prototype.onEvent=function(t){csArray.prototype.push.call(this.callbacks,t)},e.prototype.start=function(){this.canTrackFetch()&&!this.isStarted&&(this.createFetchInterceptor(),this.fetchInterceptor&&this.fetchInterceptor.activate(),this.isStarted=!0)},e.prototype.canTrackFetch=function(){return!!window.fetch&&"function"==typeof window.fetch},e.prototype.prepareArgs=function(t,e){var r=Ns(e);return r[0]&&"function"==typeof r[0].clone&&(r[0]=e[0].clone()),{context:t,args:r}},e.prototype.createFetchInterceptor=function(){this.fetchInterceptor||(this.fetchInterceptor=this.monkeyPatcher.createAsyncFunctionInterceptor({target:window,methodName:"fetch",hook:this.hook,hookPrepareArgs:this.prepareArgs,options:{withCallerName:!0}}))},e.prototype.stop=function(){this.isStarted&&(this.fetchInterceptor&&this.fetchInterceptor.deactivate(),this.isStarted=!1)},e.prototype.interceptFetch=function(t,e,r){return _s(this,void 0,void 0,(function(){var n,i,o,s,a,c;return Os(this,(function(u){switch(u.label){case 0:n=e[0],i=e[1],o=new Request(n,i),(s={url:o.url,method:o.method,requestTime:B.now(),responseTime:0,statusCode:0}).library=r,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,t];case 2:return a=u.sent(),[3,4];case 3:if((c=u.sent())instanceof TypeError||c instanceof DOMException&&"AbortError"===c.name)return[2];throw c;case 4:return s.responseTime=B.now(),a.type.indexOf("opaque")>-1?s.statusCode=-1:s.statusCode=a.status,csArray.prototype.forEach.call(this.callbacks,(function(t){return t(s)})),[2]}}))}))},Ps([_t("FetchRequestTracker.interceptFetch")],e.prototype,"interceptFetch",null),e}(bs);(fs||(fs={})).transformEvent=function(t,e,r){return function(t,e){return _n(e)&&(e.tgt=""+t+qs+e.tgt),void 0!==e.tgtHM&&(e.tgtHM=""+t+qs+e.tgtHM),function(t){return void 0!==t.tgtLk}(e)&&(e.tgtLk=""+t+qs+e.tgtLk),e}(e,function(t,e){if(void 0!==(n=e).x&&void 0!==n.y){var r=t.getBoundingClientRect();e.x=Math.round(r.left+e.x+Le.windowOffsetX()),e.y=Math.round(r.top+e.y+Le.windowOffsetY())}var n;return e}(t,r))},(ds||(ds={})).transformCommandsBatch=function(t,e){return{iframePath:e.iframePath?""+t+qs+e.iframePath:t,commands:e.commands}};var Ms,Ls=function(){return(Ls=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};(Ms||(Ms={})).transformEmerchandisingMessage=function(t,e){if(0===e.products.length)return e;var r=csArray.prototype.map.call(e.products,(function(e){return Ls(Ls({},e),{targetPath:""+t+qs+e.targetPath})}));return Ls(Ls({},e),{products:r})};var Ds,Vs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qs="|iframe|",Us=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vs(e,t),e.prototype.emitIframeEvent=function(t,e,r,n){switch(r){case ht.ChildLogMessage:this.logMessage(n);break;case ht.AnalysisEvent:var i=fs.transformEvent(t,e,n);this.emitIframeAnalysisEvent(i);break;case ht.JavascriptError:this.emitIframeJavascriptError(n);break;case ht.ApiError:this.emitIframeApiError(n);break;case ht.EmerchandisingMessage:var o=Ms.transformEmerchandisingMessage(e,n);this.emitIframeEmerchandisingMessage(o);break;case ht.Commands:var s=ds.transformCommandsBatch(e,n);this.emitIframeCommands(s);break;case ht.IntegrationCallback:this.emitIframeIntegrationCallback(n);break;default:Pt.error("Parent received unknown data type from iframe : "+csJSON.stringify(n))}},e.prototype.logMessage=function(t){var e=t.message,r=t.errorCode;switch(t.level){case U.debug:Pt.debug(e,r);break;case U.warn:Pt.warn(e,r);break;case U.error:Pt.error(e,r);break;case U.critical:Pt.critical(e,r)}},e.prototype.emitIframeAnalysisEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeAnalysisEvent&&n.onIframeAnalysisEvent(t)}},e.prototype.emitIframeJavascriptError=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeJavascriptError&&n.onIframeJavascriptError(t)}},e.prototype.emitIframeApiError=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeApiError&&n.onIframeApiError(t)}},e.prototype.emitIframeEmerchandisingMessage=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeEmerchandisingMessage&&n.onIframeEmerchandisingMessage(t)}},e.prototype.emitIframeCommands=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeCommands&&n.onIframeCommands(t)}},e.prototype.emitIframeIntegrationCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIframeIntegrationCallback&&n.onIframeIntegrationCallback(t)}},e}(yo);!function(t){t.COMPRESSION_DISABLED="compressionDisabled"}(Ds||(Ds={}));var zs,js,Bs=function(){function t(t,e,r){this.configuration=t,this.cookieService=e,this.browserSessionStorage=r,this.debugFlags=[]}return t.prototype.init=function(){var t=this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.getItem("_cs_debug"):this.cookieService.get("_cs_debug");t&&(this.debugFlags=csString.prototype.split.call(t,"."))},t.prototype.isCompressionDisabled=function(){return-1!==csArray.prototype.indexOf.call(this.debugFlags,Ds.COMPRESSION_DISABLED)},t}(),Hs=function(){function t(t){this.onError=t,this.worker=this.tryCreateCompressionWorker(),this.callbacks={},this.callbackId=0}return t.prototype.isSupported=function(){return null!==this.worker},t.prototype.compress=function(t,e,r){if(this.isSupported()){var n=this.getNewCallbackId();this.callbacks[n]=r,this.worker.postMessage([t,e,n])}},t.prototype.compressSync=function(t){return ii.compressToBase64(t)},t.prototype.terminateWorker=function(){null!==this.worker&&this.worker.terminate()},t.prototype.tryCreateCompressionWorker=function(){try{var t=csString.prototype.replace.call(this.compressionScript.toString(),"GET_LZ_STRING_SOURCE",ni);return this.createWorker("("+t+")();")}catch(t){return null}},t.prototype.createWorker=function(t){var e=this,r=window.csURL||window.webkitURL,n=window.Blob,i=window.Worker;if(!r||!n||!i)return null;var o=new n([t],{type:"application/javascript"}),s=new i(r.createObjectURL(o));return s.onerror=function(t){return e.handleWorkerError(t)},s.onmessage=function(t){return e.handleWorkerMessage(t)},s},t.prototype.handleWorkerError=function(t){var e="WorkerError: "+(t.message?t.message:"No message");return this.onError(e)},t.prototype.handleWorkerMessage=function(t){var e=t.data,r=e[0],n=e[1];this.callbacks[r](n),delete this.callbacks[r]},t.prototype.compressionScript=function(){var t=GET_LZ_STRING_SOURCE();self.addEventListener("message",(function(e){var r,n=e.data,i=n[0],o=n[1],s=n[2];switch(i){case"base64":r=t.compressToBase64(o);break;case"byteArray":r=t.compressToUint8Array(o).buffer}self.postMessage([s,r])}))},t.prototype.getNewCallbackId=function(){return this.callbackId+=1},t}(),Fs=function(){return(Fs=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Gs=function(){function t(t){this.pii=t,this.urlMaskingPatterns=[]}return t.prototype.addUrlMaskingPattern=function(e){for(var r=[],n=0,i=csString.prototype.split.call(e,"/");n<i.length;n++){var o=i[n];V(o,t.ROUTE_PARAMETER_START)?csArray.prototype.push.call(r,{key:o,value:"CS_ANONYMIZED_"+csString.prototype.toUpperCase.call(csString.prototype.slice.call(o,1))}):csArray.prototype.push.call(r,{key:o,value:null})}csArray.prototype.push.call(this.urlMaskingPatterns,r)},t.prototype.anonymize=function(t){return Fs(Fs({},t),{url:this.anonymizeUrl(t.url)})},t.prototype.anonymizeUrl=function(t){return this.maskUrl(this.pii.anonymize(this.removeQueryString(t)))},t.prototype.maskUrl=function(t){for(var e=csString.prototype.split.call(t,"/"),r=0,n=this.urlMaskingPatterns;r<n.length;r++){var i=n[r],o=this.getAnonymizedUrl(e,i);if(null!==o)return o}return t},t.prototype.getAnonymizedUrl=function(e,r){if(e.length<r.length)return null;for(var n="",i=0;i<e.length;i+=1)if(i>=r.length)n+=e[i]+"/";else if(V(r[i].key,t.ROUTE_PARAMETER_START))n+=r[i].value+"/";else{if(e[i]!==r[i].key)return null;n+=e[i]+"/"}return csString.prototype.slice.call(n,0,-1)},t.prototype.removeQueryString=function(t){var e=csString.prototype.indexOf.call(t,"?");return-1!==e?csString.prototype.slice.call(t,0,e+1):t},t.ROUTE_PARAMETER_START=":",t}(),Ws=function(){function t(t,e){this.pii=t,this.urlService=e}return t.prototype.anonymize=function(t){return bt(t.message)&&(t.message=this.pii.anonymize(t.message)),bt(t.filename)&&(t.filename=this.pii.anonymize(this.urlService.computeOverriddenUrl(t.filename))),t},t}(),Xs=function(){function t(){}return t.prototype.setItem=function(t,e){window.sessionStorage.setItem(t,e)},t.prototype.getItem=function(t){return window.sessionStorage.getItem(t)},t.prototype.removeItem=function(t){window.sessionStorage.removeItem(t)},t}(),Ks=function(){function t(){}return t.prototype.setItem=function(t,e){window.localStorage.setItem(t,e)},t.prototype.getItem=function(t){return window.localStorage.getItem(t)},t.prototype.removeItem=function(t){window.localStorage.removeItem(t)},t}(),Ys=["visit",2],Js=["page",3],Qs=function(){function t(t,e){this.pii=t,this.storage=e,this.customVariablesPage={}}return t.prototype.set=function(t,e,r,n){var i,o;if(t>0&&wt(e)&&wt(r)){var s=this.pii.anonymize(""+(St(e)?e:csString(e))),a=this.pii.anonymize(""+(St(r)?r:csString(r)));if(i=[s.slice(0,20),a.slice(0,255)],o=""!==r,!bt(n)||csArray.prototype.indexOf.call(Ys,n)>=0){var c=this.getCustomVariablesSession();o?c[t]=i:delete c[t],this.setCustomVariableSession(c)}(!bt(n)||csArray.prototype.indexOf.call(Js,n)>=0)&&(o?this.customVariablesPage[t]=i:delete this.customVariablesPage[t])}},t.prototype.getCustomVariablesSession=function(){var t=this.storage.get();if(!t)return{};var e=window.JSON.parse(t);return null!==e&&Et(e)?e:{}},t.prototype.setCustomVariableSession=function(t){this.storage.set(window.JSON.stringify(t))},t.prototype.removeCustomVariablesSession=function(){this.storage.remove()},t.prototype.getRequestParameters=function(){var t=this.getCustomVariablesSession();for(var e in this.customVariablesPage)this.customVariablesPage.hasOwnProperty(e)&&(t[e]=this.customVariablesPage[e]);if(window.JSON.stringify(t).length<=2)return{};var r={cvars:this.getValidCustomVars(t)};return this.customVariablesPage&&window.JSON.stringify(this.customVariablesPage).length>2&&(r.cvarp=this.getValidCustomVars(this.customVariablesPage)),r},t.prototype.getValidCustomVars=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=parseInt(e,10),n=t[e],i=n[0],o=n[1];a=1,c=20,(!(mt(s=r)&&s>=a&&s<=c)||i.length>20||o.length>255)&&delete t[e]}var s,a,c,u=function(t){var e;for(e in t)return!1;return!0}(t)?[]:t;return window.JSON.stringify(u)},t}(),Zs=["setCustomVariable"],$s=function(){function t(t,e){this.commandsService=t,this.customVariablesService=e}return t.prototype.init=function(){var t=this;this.commandsService.register(Zs,(function(e,r,n,i){t.customVariablesService.set(e,r,n,i)}))},t.prototype.onOptout=function(){this.customVariablesService.removeCustomVariablesSession()},t}(),ta=function(){function t(t,e,r){this.configuration=t,this.cookieChecker=e,this.parentLogContext=r}return t.prototype.init=function(){var t=this;performance.mark("cs-start-boot");var e=new go,r=new $,n=new Po,i=new xo(this.configuration,n,r),o=new ys(window.location,r),s=new Ot(this.configuration,o,this.cookieChecker);s.init();var a=new Xs,c=new Ks,u=new ko(window.location,s),p=new Bs(this.configuration,s,a);p.init();var l=new is(this.configuration,s);l.init();var h,f=new Hs((function(t){Pt.warn(t)}));if(this.configuration.useMalkaPipeline){var d=new ne(this.configuration.getQuotaServiceUri(),"quota");(h=new Es(this.configuration,f,d,e,u,o)).init()}else h=new uo(this.configuration,f,u,o);var y=new Wt(this.configuration,s,l,a),v=new po(y,h),g=new Bt(this.configuration,s,l,a),m=new so(this.configuration,g,v);this.parentLogContext.setContext(m,v),h.setVisitorService(m);var S=new ho(m,v),E=new Yt(this.configuration,s,l,a),b=new Ro(window.location,E),w=new Ao(b),C=new lo(this.configuration,m,b),T=new Us,R=new Go,A=new jo(R,T),k=new Jt(this.configuration,s,l,a),I=new Qs(r,k),P=new $s(R,I),_=new zt(m,v,b,I,this.configuration),O=new te,N=new Zt(O,window.location),x=new zo(this.configuration,_,N),M=new ss(this.configuration,O);l.setStates(_,M);var L=new io(this.configuration,m,b,C,S,x,l,u);return i.init(),L.compute((function(n){A.init();var i=new gs,a=new So(t.configuration,s,c),u=new Co(t.configuration,a,e),l=new wo(R,u),h=new Mo(t.configuration,s,c),d=new Lo(e,window.location,h),y=new Vo(R,d),g=new ls(R,t.configuration),S=new cs(t.configuration,m,v),E=new ps,b=new Vr,C=new ks(b),k=new xs(b),_=new Ts(C,k),O=new Gs(r),N=new Ws(r,o),x=new rs(E,N,_,O,t.configuration,S,T,R,i);(x.init(),performance.mark("cs-step2-boot"),e.addListeners(x),n)?(e.emitInitTracking(),new no(S,f,m,v,e,R,A,t.configuration,y,d,l,u,r,o,g,i,E,N,_,O,T,p,I,P).start()):new To(e,R,A,y,d,w,l).start()})),performance.mark("cs-end-boot"),performance.measure("cs-measure-boot","cs-start-boot","cs-end-boot"),{LZString:ii}},t}();!function(t){var e,r={loadBundle:function(t){var s=t.source,a=t.data;if(i(a)){var p=function(){var e,r,i,o=n("{domain}/tag/tag.bundle.js?v={version}",a);e=o,r=function(){return s.postMessage("csBundleLoaded",t.origin)},(i=document.createElement("script")).type="text/javascript",i.async=!0,i.src=e,i.onload=r,i.charset="utf-8",document.head.appendChild(i)};e=a.token,u(r.loadBundle),o(t.origin)?p():function(t,e){var r=function(t){var e=document.createElement("iframe");return e.src=t,e.id="content-square-bridge",e.setAttribute("style","display: none !important; visibility: hidden !important;"),e}(n("{domain}/tag/bridge.html?v={version}#{token}",t)),i=function(t){t.source===r.contentWindow&&"TOKEN_VALID"===t.data&&(u(i),r.remove(),e())};c(i),document.head.appendChild(r)}(a,p)}}};function n(t,e){return csString.prototype.replace.call(csString.prototype.replace.call(csString.prototype.replace.call(t,"{version}",e.version),"{token}",e.token),"{domain}",e.domain)}function i(t){return t&&"csBundleInjection"===t.type&&o(t.domain)&&a(t.version)&&s(t.token)}function o(t){return/^https?:\/\/[a-zA-Z0-9\.\-]+\.(content-square\.fr|contentsquare\.com)$/.test(t)}function s(t){return/^[a-zA-Z0-9]+$/.test(t)}function a(t){return/^[a-zA-Z0-9\.]+$/.test(t)}function c(t){window.addEventListener("message",t,!1)}function u(t){window.removeEventListener("message",t,!1)}t.getToken=function(){return e},t.isAuthorizedIncomingMessage=i,t.isAuthorizedDomain=o,t.isAuthorizedToken=s,t.isAuthorizedTagVersion=a,t.isActivable=function(){var t=window.opener||window.parent;return window!==t&&window.addEventListener},t.waitForBundleInjection=function(){c(r.loadBundle)},t.listen=c,t.removeListener=u}(zs||(zs={})),function(t){var e,r=window.opener||window.parent,n=[/^https:\/\/app\.contentsquare\.com$/,/^https:\/\/dev-app\.contentsquare\.com$/,/^https:\/\/staging-app\.contentsquare\.com$/,/^https:\/\/.*\.test\.contentsquare\.com$/],i={ping:function(t){"ping"===t.data&&o(t.origin)&&(e=t.origin,c(i.ping),a(i.insertMessageScript),s("utils.js"+"?cb="+(new csDate).getTime()))},insertMessageScript:u((function(t){var e=t.data;"string"==typeof e&&"ping"!==e&&(c(i.insertMessageScript),s(e))}))};function o(t){return csArray.prototype.some.call(n,(function(e){return e.test(t)}))}function s(t,r){var n=document.createElement("script");n.type="text/javascript",n.async=!0;var i=csString.prototype.replace.call(e,/^https?:/,"");n.src=i+"/tag/"+t,n.onload=r,n.charset="utf-8",document.getElementsByTagName("head")[0].appendChild(n)}function a(t){window.addEventListener("message",t,!1)}function c(t){window.removeEventListener("message",t,!1)}function u(t){return function(r){r.origin===e&&t(r)}}t.getToken=function(){return zs.getToken()},t.isActivable=function(){return window!==r&&window.addEventListener},t.isAuthorizedDomain=o,t.waitForConnection=function(){a(i.ping),zs.waitForBundleInjection()},t.listen=a,t.removeListener=c,t.secureListener=u,t.post=function(t){e&&r.postMessage(t,e)}}(js||(js={}));var ea=window.CSFrameCommunication||js,ra=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),na=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ra(e,t),e.prototype.emitAfterPageViewCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onAfterPageViewCallback&&n.onAfterPageViewCallback(t)}},e.prototype.emitIntegrationSessionKeyCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onIntegrationSessionKeyCallback&&n.onIntegrationSessionKeyCallback(t)}},e}(yo),ia=function(){function t(t){this.iframeCommandsSenderService=t}return t.prototype.init=function(){this.iframeCommandsSenderService.register(gn),this.iframeCommandsSenderService.register(Zs),this.iframeCommandsSenderService.register(Si),this.iframeCommandsSenderService.register(Ei),this.iframeCommandsSenderService.register(mi),this.iframeCommandsSenderService.register(Tn),this.iframeCommandsSenderService.register(Rn),this.iframeCommandsSenderService.register(An),this.iframeCommandsSenderService.register(kn),this.iframeCommandsSenderService.register(Ai),this.iframeCommandsSenderService.register(ki),this.iframeCommandsSenderService.register(Do),this.iframeCommandsSenderService.register(Xi),this.iframeCommandsSenderService.register(Ki),this.iframeCommandsSenderService.register(Eo),this.iframeCommandsSenderService.register(bo),this.iframeCommandsSenderService.register(es),this.iframeCommandsSenderService.register(ts)},t.prototype.onStartTracking=function(){this.iframeCommandsSenderService.start()},t.prototype.onOptout=function(){this.iframeCommandsSenderService.stop()},t}(),oa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),sa=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},aa=function(t){function e(e,r){var n=t.call(this)||this;return n.commandsService=e,n.iframeChildToParentCommunicationService=r,n.batch=[],n}return oa(e,t),e.prototype.onStart=function(){this.commandsBatchReady()},e.prototype.onStop=function(){this.batch=[]},e.prototype.register=function(t){for(var e=this,r=function(t){n.commandsService.register([t],(function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.send(t,r)}))},n=this,i=0,o=t;i<o.length;i++){r(o[i])}},e.prototype.send=function(t,e){csArray.prototype.push.call(this.batch,{name:t,params:e}),this.isStarted&&this.commandsBatchReady()},e.prototype.commandsBatchReady=function(){if(0!==this.batch.length){var t={commands:this.batch};this.iframeChildToParentCommunicationService.sendToParent(ht.Commands,t),this.batch=[]}},sa([_t("Commands.iframe.commandsBatch.send")],e.prototype,"send",null),sa([dn(),_t("send iframe commands batch")],e.prototype,"commandsBatchReady",null),e}(me),ca=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ua=function(t){function e(e,r,n){var i=t.call(this)||this;return i.configuration=e,i.lifeCycleEventsEmitter=r,i.childLifeCycleEventEmitter=n,i.id=-1,i.parentOrigin="",i.maxMessagesBuffer=25,i.messageBuffer=[],i.messageHandler={boundElement:window,type:"message",listener:function(t){return i.messagesListener(t)}},i}return ca(e,t),e.prototype.onStart=function(){ie(this.messageHandler,!1),this.sendDiscovery()},e.prototype.onStop=function(){oe(this.messageHandler,!1)},e.prototype.sendToParent=function(t,e){var r=this.buildChildBaseMessage(t,e);this.sendMessage(r)},e.prototype.sendDiscovery=function(){var t=this.buildChildBaseMessage(ht.Discovery);ft.sendMessage(window.parent,"*",t)},e.prototype.buildChildBaseMessage=function(t,e){var r=ft.buildBaseMessage(t,lt.Child,this.configuration.projectId,this.id);return e&&(r.content=e),r},e.prototype.sendMessage=function(t){void 0!==t.id?ft.sendMessage(window.parent,this.parentOrigin,t):this.addMessageToBuffer(t)},e.prototype.messagesListener=function(t){if(ft.isMessageValid(t,lt.Parent,this.configuration.projectId,this.configuration.hostnames))switch(t.data.type){case ht.IntegrationCallback:var e=t.data.content;e.initiator===pt.AfterPageView?this.childLifeCycleEventEmitter.emitAfterPageViewCallback(e):e.initiator===pt.GetSessionKey?this.childLifeCycleEventEmitter.emitIntegrationSessionKeyCallback(e):Pt.warn("Iframe child ("+this.id+") received unknown IntegrationCallback type from parent ("+t.origin+") : "+csJSON.stringify(t.data));break;case ht.Stop:this.lifeCycleEventsEmitter.emitOptout();break;case ht.Discovery:if(!mt(t.data.id)||t.data.id<0)return void Pt.warn("Iframe child ("+this.id+") received discovery without valid id from parent ("+t.origin+") : "+csJSON.stringify(t.data));this.id=t.data.id,this.parentOrigin=t.origin,this.sendAllBufferedMessages();break;default:Pt.warn("Iframe child ("+this.id+") received unknown data type from parent ("+t.origin+") : "+csJSON.stringify(t.data))}},e.prototype.addMessageToBuffer=function(t){this.messageBuffer.length<this.maxMessagesBuffer&&csArray.prototype.push.call(this.messageBuffer,t)},e.prototype.sendAllBufferedMessages=function(){for(var t=0,e=this.messageBuffer;t<e.length;t++){var r=e[t];r.id=this.id,ft.sendMessage(window.parent,this.parentOrigin,r)}this.messageBuffer=[]},e}(me),pa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),la=function(t){function e(e,r){var n=t.call(this)||this;return n.apiErrorsTracker=e,n.iframeChildToParentCommunicationService=r,n}return pa(e,t),e.prototype.init=function(){var t=this;this.apiErrorsTracker.init(),this.apiErrorsTracker.onEvent((function(e){return t.processEvent(e)}))},e.prototype.onStart=function(){this.apiErrorsTracker.start()},e.prototype.onStop=function(){this.apiErrorsTracker.stop()},e.prototype.processEvent=function(t){this.isStarted&&this.iframeChildToParentCommunicationService.sendToParent(ht.ApiError,t)},e}(me),ha=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fa=function(t){function e(e,r){var n=t.call(this)||this;return n.javaScriptErrorsTracker=e,n.iframeChildToParentCommunicationService=r,n}return ha(e,t),e.prototype.init=function(){var t=this;this.javaScriptErrorsTracker.onEvent((function(e){return t.processEvent(e)}))},e.prototype.onStart=function(){this.javaScriptErrorsTracker.start()},e.prototype.onStop=function(){this.javaScriptErrorsTracker.stop()},e.prototype.processEvent=function(t){this.isStarted&&this.iframeChildToParentCommunicationService.sendToParent(ht.JavascriptError,t)},e}(me),da=function(){function t(t,e,r,n){this.javaScriptErrorsTracker=t,this.apiErrorsTracker=e,this.configuration=r,this.iframeChildToParentCommunicationService=n}return t.prototype.init=function(){this.iframeJavaScriptErrorsService=new fa(this.javaScriptErrorsTracker,this.iframeChildToParentCommunicationService),this.iframeJavaScriptErrorsService.init(),this.apiErrorsTracker.excludeDomains([Bo.CONTENTSQUARE,Bo.CLICKTALE,Bo.FAKE_TRACKER]),this.iframeApiErrorsService=new la(this.apiErrorsTracker,this.iframeChildToParentCommunicationService),this.iframeApiErrorsService.init()},t.prototype.onStartTracking=function(){this.configuration.jsErrorsEnabled&&this.iframeJavaScriptErrorsService.start(),this.configuration.apiErrorsEnabled&&this.iframeApiErrorsService.start()},t.prototype.onOptout=function(){this.iframeJavaScriptErrorsService.stop(),this.iframeApiErrorsService.stop()},t}(),ya=function(){function t(t){this.iframeChildToParentCommunicationService=t}return t.prototype.onStartTracking=function(){this.iframeChildToParentCommunicationService.start()},t.prototype.onOptout=function(){this.iframeChildToParentCommunicationService.stop()},t}(),va=function(){function t(t,e,r){this.iframeParentToChildrenCommunicationService=t,this.iframeEventsEmitter=e,this.iframeChildToParentCommunicationService=r}return t.prototype.init=function(){var t=this;this.iframeParentToChildrenCommunicationService.onChildMessage((function(e,r,n,i){return t.iframeEventsEmitter.emitIframeEvent(e,r,n,i)}))},t.prototype.onStartTracking=function(){this.iframeParentToChildrenCommunicationService.start()},t.prototype.onOptout=function(){this.iframeParentToChildrenCommunicationService.stop()},t.prototype.onIframeAnalysisEvent=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.AnalysisEvent,t)},t.prototype.onIframeJavascriptError=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.JavascriptError,t)},t.prototype.onIframeApiError=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.ApiError,t)},t.prototype.onIframeEmerchandisingMessage=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.EmerchandisingMessage,t)},t.prototype.onIframeCommands=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.Commands,t)},t.prototype.onIframeIntegrationCallback=function(t){this.iframeChildToParentCommunicationService.sendToParent(ht.IntegrationCallback,t)},t.prototype.onAfterPageViewCallback=function(t){this.iframeParentToChildrenCommunicationService.sendToChildren(ht.IntegrationCallback,t)},t.prototype.onIntegrationSessionKeyCallback=function(t){this.iframeParentToChildrenCommunicationService.sendToChildren(ht.IntegrationCallback,t)},t}(),ga=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ma=function(t){function e(e,r,n){var i=t.call(this)||this;return i.analysisEventsTracker=e,i.gestureTracker=r,i.iframeChildToParentCommunicationService=n,i}return ga(e,t),e.prototype.init=function(){var t=this;this.analysisEventsTracker.onEvent((function(e){return t.processEvent(e)})),this.gestureTracker.onEvent((function(e){return t.processEvent(e)}))},e.prototype.onStart=function(){this.analysisEventsTracker.start(),this.gestureTracker.start()},e.prototype.onStop=function(){this.analysisEventsTracker.stop(),this.gestureTracker.stop()},e.prototype.processEvent=function(t){this.isStarted&&t.type!==fn.RESIZE&&this.iframeChildToParentCommunicationService.sendToParent(ht.AnalysisEvent,t)},e}(me),Sa=function(){function t(t,e,r,n){this.configuration=t,this.eventPathComputation=e,this.selector=r,this.iframeChildToParentCommunicationService=n}return t.prototype.init=function(){var t=new Zn(this.configuration,this.eventPathComputation,this.selector),e=new Ln(this.configuration,this.eventPathComputation,new Un(Pt));this.iframeAnalysisEventsService=new ma(t,e,this.iframeChildToParentCommunicationService),this.iframeAnalysisEventsService.init()},t.prototype.onStartTracking=function(){this.iframeAnalysisEventsService.start()},t.prototype.onOptout=function(){this.iframeAnalysisEventsService.stop()},t}(),Ea=function(){function t(t,e,r){this.urlService=t,this.eMerchandisingTracker=e,this.iframeChildToParentCommunicationService=r,this.products=[]}return t.prototype.collect=function(){this.products=this.eMerchandisingTracker.collectProducts(),this.targetUrl=this.urlService.getUrl(),this.sendEMerchandisingData()},t.prototype.clearProducts=function(){this.products=[]},t.prototype.sendEMerchandisingData=function(){var t={targetUrl:this.targetUrl,windowWidth:Le.windowWidth(),windowHeight:Le.windowHeight(),products:this.products};this.iframeChildToParentCommunicationService.sendToParent(ht.EmerchandisingMessage,t)},t}(),ba=function(){function t(t,e,r){this.configuration=t,this.urlService=e,this.iframeChildToParentCommunicationService=r}return t.prototype.init=function(){var t=new Oi(this.configuration);this.iframeEmerchandisingService=new Ea(this.urlService,t,this.iframeChildToParentCommunicationService)},t.prototype.onStartTracking=function(){this.iframeEmerchandisingService.clearProducts(),this.iframeEmerchandisingService.collect()},t}(),wa=function(){function t(t){this.iframeChildToParentCommunicationService=t,this.registeredCallbacks=new Map}return t.prototype.handleCommand=function(t){Ct(t)&&this.registerCallback(t)},t.prototype.executeRegisteredCallbacks=function(t){var e=this,r=t.trackingContext;if(r)if(t.callbackId){var n=this.registeredCallbacks.get(t.callbackId);n&&this.executeAsync(n,r)}else this.registeredCallbacks.forEach((function(t){e.executeAsync(t,r)}))},t.prototype.registerCallback=function(t){var e=j.integer(),r={callbackId:e,initiator:pt.AfterPageView};this.registeredCallbacks.set(e,t),this.iframeChildToParentCommunicationService.sendToParent(ht.IntegrationCallback,r)},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),Ca=function(){function t(t){this.iframeChildToParentCommunicationService=t,this.pendingCallbacks=new Map}return t.prototype.handleCommand=function(t){Et(t)&&Ct(t.callback)&&this.addPendingCallback(t.callback)},t.prototype.executePendingCallbacks=function(t){var e=t.trackingContext,r=t.callbackId;if(r&&e){var n=this.pendingCallbacks.get(r);n&&(this.pendingCallbacks.delete(r),this.executeAsync(n,e.sessionKey))}},t.prototype.addPendingCallback=function(t){var e=j.integer(),r={callbackId:e,initiator:pt.GetSessionKey};this.pendingCallbacks.set(e,t),this.iframeChildToParentCommunicationService.sendToParent(ht.IntegrationCallback,r)},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),Ta=function(){function t(t,e){this.commandsService=t,this.iframeChildToParentCommunicationService=e}return t.prototype.init=function(){var t=this;this.iframeAfterPageViewService=new wa(this.iframeChildToParentCommunicationService),this.iframeGetSessionKeyService=new Ca(this.iframeChildToParentCommunicationService),this.commandsService.register(nn,(function(e){t.iframeAfterPageViewService.handleCommand(e)})),this.commandsService.register(on,(function(e){return t.iframeGetSessionKeyService.handleCommand(e)}))},t.prototype.onAfterPageViewCallback=function(t){this.iframeAfterPageViewService.executeRegisteredCallbacks(t)},t.prototype.onIntegrationSessionKeyCallback=function(t){this.iframeGetSessionKeyService.executePendingCallbacks(t)},t}(),Ra=function(){function t(t,e,r,n,i){var o=this;this.childLifeCycleEventsEmitter=t,this.lifeCycleEventsEmitter=e,this.configuration=r,this.iframeChildToParentCommunicationService=n,this.commandsService=i,this.startDataCollection=function(){o.commandsService.start(),o.loadTracker.start()}}return t.prototype.start=function(){var t=this,e=new wi(O,this.configuration),r=new Ci(e),n=new Sa(this.configuration,e,r,this.iframeChildToParentCommunicationService),i=new ya(this.iframeChildToParentCommunicationService);if(this.configuration.eMerchandisingEnabled){var o=new $,s=new ys(window.location,o),a=new ba(this.configuration,s,this.iframeChildToParentCommunicationService);this.lifeCycleEventsEmitter.addListeners(a),a.init()}var c=new Ta(this.commandsService,this.iframeChildToParentCommunicationService);this.childLifeCycleEventsEmitter.addListeners(c),c.init();var u=new ro(this.configuration),p=new Us,l=new va(u,p,this.iframeChildToParentCommunicationService);p.addListeners(l),this.childLifeCycleEventsEmitter.addListeners(l),this.lifeCycleEventsEmitter.addListeners(i,l,n),l.init(),n.init(),this.loadTracker=new Ri,this.loadTracker.onLoad((function(){t.lifeCycleEventsEmitter.emitStartTracking()})),this.startDataCollection()},t}(),Aa=function(){function t(t){this.configuration=t}return t.prototype.init=function(){var t=new go,e=new na,r=new ua(this.configuration,t,e),n=new Go,i=new aa(n,r),o=new ia(i);o.init();var s=new ps,a=new Vr,c=new ks(a),u=new xs(a),p=new Ts(c,u),l=new da(s,p,this.configuration,r);return l.init(),t.addListeners(o,l),t.emitInitTracking(),new Ra(e,t,this.configuration,r,n).start(),{LZString:ii}},t}(),ka=function(t,e,r,n){var i,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,r,s):i(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},Ia=function(){function t(t,e,r){this.configuration=t,this.iframeContext=e,this.parentLogContext=r}return t.prototype.start=function(){if(!window.UXAnalytics){var t=new Nt(this.iframeContext,this.configuration);t.init();var e=new Ut(this.configuration,t);if(this.iframeContext.isTopWindowTracker()&&e.canTrack()){window.CSProtectnativeFunctionsErrors&&Pt.warn("protectNativeFunctions failed: "+window.CSProtectnativeFunctionsErrors);var r=new ta(this.configuration,t,this.parentLogContext);window.UXAnalytics=r.init()}else if(!this.iframeContext.isTopWindowTracker()&&e.canTrackInIframe()){var n=new Aa(this.configuration);window.UXAnalytics=n.init()}!window.CSFrameCommunication&&ea.isActivable()&&(window.CSFrameCommunication=ea,ea.waitForConnection())}},ka([_t("main.start")],t.prototype,"start",null),t}();try{performance.mark("cs-start-tag");var Pa=new H(window.CS_CONF);window._uxa=window._uxa||[],Pa.processOptionOverrides(window._uxa);var _a=new F(window,Pa);_a.init();var Oa=new vt;if(_a.isTopWindowTracker()){var Na=new ot(Pa,Oa);Pt.setStrategy(Na)}else{var xa=new yt(Pa);Pt.setStrategy(xa)}new Ia(Pa,_a,Oa).start()}catch(t){}}]);