(()=>{var t={921:(t,e,r)=>{var n=window.metaLayer||window._metaLayer,i="shop/interruptions-manager/dist/client/",o=n?"".concat(n.env_assets,"/").concat(i):i;r.p=o},970:t=>{t.exports={creatorNamespace:"shop",componentId:"interruptions-manager",componentVersion:"",contractVersion:"v1",assetBasePath:"dist/client"}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.p="",(()=>{"use strict";r(921);const t=initializer;var e=r.n(t),n=r(970);const i=JSON.parse('{"name":"@gvpc/interruptions-manager","version":"0.5.10","license":"UNLICENSED","main":"dist/server/server.js","contributors":[{"name":"Pathfinder Atlas","email":"Pathfinder-Atlas@bestbuy.com"}],"scripts":{"analyzeBundle":"../../scripts/analyze-bundle.sh","build":"../../scripts/build.sh","build:stats":"NODE_ENV=production webpack --mode \'production\' --define process.env.NODE_ENV=\'production\' --profile --json > compilation-stats.json","clean":"rm -rf dist coverage","henry":"npx henry","lint":"eslint .","lint:fix":"eslint . --fix","test":"jest --coverage","prepare":"yarn build","start":"node --inspect-port=${INSPECTOR_PORT:-9229} --inspect dev-server"},"dependencies":{"@bby/dry":"4.25.0","@gvp/lib-actions":"4.2.1","@gvp/lib-component-assets":"6.0.1","@gvp/lib-log-utils":"1.1.0"},"files":["dist"],"gitHead":"7d320dfecfcddf0eecfb2c6b3415d829f1519621"}'),o=_;class a{constructor(t,e){this.actionQueue=[],this.duration=e,this.actionHandler=t,this.timeout=null}addAction(t,e){this.actionQueue.push([t,e]),this.timeout||(this.timeout=setTimeout((()=>{this._handleActions(),this.timeout=null}),this.duration))}_handleActions(){this._sortActionsByPriority(),this.actionQueue.forEach((t=>{var[e,r]=t;return this.actionHandler(e,r)})),this.actionQueue=[]}_sortActionsByPriority(){this.actionQueue.sort(((t,e)=>{var[r]=t,[n]=e,i=g((0,o.get)(r,"payload.interruptionType")),a=g((0,o.get)(n,"payload.interruptionType"));return i===a?0:i<a?1:-1}))}}var s="Interruptions-Manager-Request-History-Key",u="Interruptions-Manager-Business-Rules",c={},p=[],d=()=>{},l=["price-change-notification","test-notification","sign-in-toast-notification","email-modal-notification","last-item-viewed-toast-notification","alt-pickup-toast-notification","invalid-store-notification","open-order-toast-notification","custom-card-message-notification"],h=t=>"".concat("Interruptions Manager received an interruption request action without"," ").concat(t,". ").concat(t," ").concat("is a required payload parameter."),m=t=>"".concat("Interruptions Manager received an interruption request action without or with an invalid"," ").concat(t,". ").concat(t," ").concat("is a required and must be a valid payload parameter."),y=()=>new b(c,u).getStoredValue(),g=t=>{var e=(0,o.get)(y(),"priorities");return(0,o.get)(e,t,0)};const v=actionLog;var f,I=t=>{new b(p,s).appendArrayItem(t)},S=(t,e,r)=>{I(t)},w=!1,E=(t,e,r)=>{f||(f=new a(T,(0,o.get)(y(),"batchDuration"))),I(t),f.addAction(t,r)},T=(t,e)=>{var r,n=((t,e)=>{var r={interruptionId:t.payload.interruptionId,interruptionType:t.payload.interruptionType,interruptionDuration:t.payload.requestedInterruptionDuration},n=window.location.pathname;if(e)return r.interruptionDuration=0,r.permissionGranted=!1,r.reason="A request for interruption with higher priority was granted permission.",r;try{(t=>{if(!t.interruptionId)throw new Error(h("interruptionId"));if(!t.interruptionType||!l.includes(t.interruptionType))throw new Error(m("interruptionType"));if(!t.requestedInterruptionDuration)throw new Error(h("requestedInterruptionDuration"));if(!t.placement||!["header","footer"].includes(t.placement))throw new Error(m("placement"))})(t.payload);var i=(0,o.get)(y(),"denylist"),{permissionGranted:a,interruptionDuration:s,reason:u}=((t,e,r)=>{var n=(e[t.interruptionType]||[]).filter((t=>t.url===r)),i=0===n.length,o=i?t.requestedInterruptionDuration:0;return{permissionGranted:i,interruptionDuration:o,reason:n.length>0?n[0].reason:"Interruption permission has been granted. The permitted interruptionDuration is ".concat(o," milliseconds, which should match your request.")}})(t.payload,i,n);r.permissionGranted=a,r.interruptionDuration=s,r.reason=u}catch(t){r.interruptionDuration=0,r.permissionGranted=!1,r.reason="Error: ".concat(t.message)}return r})(t,w);n.permissionGranted&&(w=!0),(0,v.dispatch)({type:"INTERRUPTION_PERMISSION_RESPONSE",payload:{interruptionDuration:(r=n).interruptionDuration,interruptionId:r.interruptionId,interruptionType:r.interruptionType,permissionGranted:r.permissionGranted,reason:r.reason}},e)};class b{constructor(t,e){this._defaultState=t,this._localStorageKey=e}clearStorage(){localStorage.setItem(this._localStorageKey,JSON.stringify(this._defaultState))}getStoredValue(){var t;try{t=JSON.parse(localStorage.getItem(this._localStorageKey))}catch(e){this.clearStorage(),t=this._defaultState}return t}appendArrayItem(t){var e=this.getStoredValue();Array.isArray(e)||(this.clearStorage(),e=this._defaultState),e.push(t),this.setValue(e)}setValue(t){(this._localStorageKey!==s||Array.isArray(t))&&localStorage.setItem(this._localStorageKey,JSON.stringify(t))}}var{version:N}=i,D={componentId:n.componentId,contractVersion:n.contractVersion,creatorNamespace:n.creatorNamespace,componentVersion:N};e().registerComponent(D,((t,e,r)=>{var n,i;n=r.app,i=new b(c,u),n.hasBusinessRulesError?i.setValue({hasBusinessRulesError:n.hasBusinessRulesError}):i.setValue(n.businessRules);var o=()=>{(t=>{(0,v.listen)(((e,r)=>{((t,e)=>{switch(t.type){case"REQUEST_INTERRUPTION_PERMISSION":return E;case"INTERRUPTION_STATUS_UPDATE":return S;default:return d}})(e)(e,r,t)}),t)})(t)};"interactive"===document.readyState?o():document.addEventListener("DOMContentLoaded",o)}))})()})();
//# sourceMappingURL=client-aa67658482e36a783990b86a9331042f.mjs.map